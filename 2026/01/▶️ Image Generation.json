{
  "active": true,
  "activeVersion": {
    "updatedAt": "2026-01-30T07:49:04.571Z",
    "createdAt": "2026-01-30T07:48:57.483Z",
    "versionId": "0471a0e1-cecf-45eb-a0ec-16b0c9078fd0",
    "workflowId": "94cQgMMaleQORL211aZxS",
    "nodes": [
      {
        "parameters": {
          "resource": "databasePage",
          "operation": "get",
          "pageId": {
            "__rl": true,
            "value": "={{ $('Get Initial Article').first().json.body.data.id }}",
            "mode": "id"
          },
          "simple": false
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          -1232,
          80
        ],
        "id": "dcda912a-cd44-42fc-be26-6a10d8e65670",
        "name": "Get Content With Block ID",
        "executeOnce": true,
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "resource": "database",
          "databaseId": {
            "__rl": true,
            "value": "={{ $json.parent.database_id }}",
            "mode": "id"
          },
          "simple": false
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          -1008,
          80
        ],
        "id": "5336a02f-3f26-48c1-8153-97d27c2bcd9f",
        "name": "Get Parent DB ID",
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "090ef065-4cf7-4d81-9bfa-d87425fbe336",
                "name": "content",
                "value": "={{ $json.body }}",
                "type": "string"
              },
              {
                "id": "62cd50ef-4057-4161-878e-c628c8613a5f",
                "name": "prompt_update",
                "value": "={{ $json.prompt_update }}",
                "type": "string"
              },
              {
                "id": "ceb252e3-d45a-46da-92b0-44b447c3d6f7",
                "name": "system_message",
                "value": "={{ $json.system_message }}",
                "type": "string"
              },
              {
                "id": "19101d04-ac65-441d-9614-b46a2a3b733a",
                "name": "user_message",
                "value": "={{ $json.user_message }}",
                "type": "string"
              },
              {
                "id": "af188dd3-0756-4c57-a428-1da2034c50bc",
                "name": "title",
                "value": "={{ $json.title }}",
                "type": "string"
              },
              {
                "id": "5d2e98c0-3f5f-4d52-95dc-286b5a15d3b2",
                "name": "source",
                "value": "={{ $json.source }}",
                "type": "string"
              },
              {
                "id": "0ecb355c-1570-4af1-82d7-604cf108722d",
                "name": "platform",
                "value": "={{ $json.platform }}",
                "type": "string"
              },
              {
                "id": "8c449581-b194-41f1-b7d6-29764cc4c41f",
                "name": "initial_article",
                "value": "={{ $json.initial_article }}",
                "type": "string"
              },
              {
                "id": "b0a17ec1-0f75-40aa-8ce8-a3c0dec0e637",
                "name": "transformed_content_db_id",
                "value": "={{ $json.transformed_content_db_id }}",
                "type": "string"
              },
              {
                "id": "68f9bee7-e35a-44cc-9c48-d8e161f06fe5",
                "name": "image_dimensions",
                "value": "={{ $json.image_dimensions }}",
                "type": "string"
              },
              {
                "id": "3b9f19c8-e8ba-4078-9eb3-021cb5ee34af",
                "name": "image_system_message",
                "value": "={{ $json.image_system_message }}",
                "type": "string"
              },
              {
                "id": "a3aa45a9-6f74-4531-acf2-63e3b3a7d0b1",
                "name": "image_prompts",
                "value": "={{ $json.image_prompts }}",
                "type": "array"
              },
              {
                "id": "b9bf6d87-2969-4afc-95e6-e3c0e2a5c7fb",
                "name": "image_aspect_ratio",
                "value": "={{ $json.image_aspect_ratio }}",
                "type": "string"
              },
              {
                "id": "0b3d0085-a786-4eac-b5d4-9e5b9a8bdcdc",
                "name": "model",
                "value": "={{ $json.model }}",
                "type": "string"
              },
              {
                "id": "0c208a03-0464-4d35-bb22-e7684b33cdb6",
                "name": "temperature",
                "value": "={{ $json.temperature }}",
                "type": "string"
              },
              {
                "id": "6d5fcbf6-ce61-4970-aaab-f030ddb858a6",
                "name": "top_p",
                "value": "={{ $json.top_p }}",
                "type": "string"
              },
              {
                "id": "b04fb168-c9a0-4cc7-a7e9-c7cf8498de00",
                "name": "frequency_penalty",
                "value": "={{ $json.frequency_penalty }}",
                "type": "string"
              },
              {
                "id": "888277fe-ace9-4dd8-8125-a9400dff180e",
                "name": "presence_penalty",
                "value": "={{ $json.presence_penalty }}",
                "type": "string"
              },
              {
                "id": "37690778-bb29-4b6f-bd9d-3d1682f0fde5",
                "name": "max_tokens",
                "value": "={{ $json.max_tokens }}",
                "type": "string"
              },
              {
                "id": "51544bbd-36c4-4e4c-a543-c16cb6ae9cd5",
                "name": "num_variants",
                "value": "={{ $json.num_variants }}",
                "type": "string"
              },
              {
                "id": "c84db0b8-717d-45d4-bd04-91ae0d33dcf9",
                "name": "prompt_source",
                "value": "{{ $json.prompt_source }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1680,
          160
        ],
        "id": "f22d331b-1202-482a-bb34-5963ab7b8d54",
        "name": "Set Input3"
      },
      {
        "parameters": {
          "resource": "block",
          "operation": "getAll",
          "blockId": {
            "__rl": true,
            "value": "={{ $('Get Initial Article').first().json.body.data.id }}",
            "mode": "id"
          },
          "returnAll": true
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          1232,
          80
        ],
        "id": "0a2d06f0-449e-4606-9816-cd900ddd805a",
        "name": "Get Block Content",
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Initialize output variables\nlet bodyParts = [];\nlet images = [];\n\nfor (const item of $input.all()) {\n  const block = item.json;\n\n  if (block.type === 'paragraph') {\n    const content = block.content?.trim();\n    if (content) {\n      bodyParts.push(content);\n    }\n  }\n\n  if (block.type === 'image') {\n    const imageUrl = block.image?.external?.url;\n    if (imageUrl) {\n      images.push(imageUrl);\n    }\n  }\n}\n\nreturn [\n  {\n    json: {\n      body: bodyParts.join('\\n'),\n      images,\n      // initial_input: $('Set Initial Input').item.json.set_initial_input,\n      // system_message: $('Extract Content Type Prompt').item.json.property_system_message,\n      // user_message: $('Extract Content Type Prompt').item.json.property_guidelines,\n      prompt_update: $('Get Initial Article').first().json.body.data.properties[\"Update Prompt\"].rich_text[0] ? $('Get Initial Article').first().json.body.data.properties[\"Update Prompt\"].rich_text[0].plain_text : '',\n      title: `Content - ${$('Get Initial Article').first().json.body.data.properties.Concept.title[0].plain_text} - ${$('Aggregate Image Prompts').first().json.image_prompts[0].name} - Images`,\n      source: $('Get Initial Article').first().json.body.data.id,\n      prompt_source: `${$('Aggregate Image Prompts').first().json.image_prompts[0].name}`,\n      // platform: $('Extract Content Type Prompt').item.json.property_platform[0],\n      transformed_content_db_id: $('Get Images Output DB ID').first().json.id,\n      // image_dimensions: $('Extract Content Type Prompt').item.json.property_image_dimensions,\n      // image_system_message: $('Extract Content Type Prompt').item.json.property_image_system_message,\n      // initial_article: $('Get Initial Article').item.json.body.data.url,\n      image_prompts: $('Aggregate Image Prompts').first().json.image_prompts,\n      image_aspect_ratio: $('Extract Image Prompts').first().json.property_aspect_ratio,\n      num_variants: $('Get Initial Article').first().json.body.data.properties.Variants? $('Get Initial Article').first().json.body.data.properties.Variants.number : 1,\n      // \"model\": $('Extract Content Type Prompt').first().json.property_model,\n      // \"temperature\": $('Extract Content Type Prompt').first().json.property_temperature,\n      // \"top_p\": $('Extract Content Type Prompt').first().json.property_top_p,\n      // \"frequency_penalty\": $('Extract Content Type Prompt').first().json.property_frequency_penalty,\n      // \"presence_penalty\": $('Extract Content Type Prompt').first().json.property_presence_penalty,\n      // \"max_tokens\": $('Extract Content Type Prompt').first().json.property_max_tokens\n    },\n  },\n];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1456,
          80
        ],
        "id": "50ad8db7-4333-4916-b032-4c9e3255ace4",
        "name": "Format Block Content",
        "retryOnFail": false
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -112,
          80
        ],
        "id": "85eb522f-96a8-4e01-af83-5029a5cb86a7",
        "name": "Loop Over Items"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "image-generation",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -1456,
          80
        ],
        "id": "b7d0434e-4435-4696-8092-fb45ec46e500",
        "name": "Get Initial Article",
        "webhookId": "c1f6e721-721d-4ecd-98bc-9dc5a9b847ff"
      },
      {
        "parameters": {
          "resource": "databasePage",
          "operation": "update",
          "pageId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $('Initial Input').item.json.source }}",
            "__regex": "^([0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12})"
          },
          "propertiesUi": {
            "propertyValues": [
              {
                "key": "Status|status",
                "statusValue": "Error"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          6256,
          800
        ],
        "id": "fc84f5e1-3200-442d-b5e4-1fccf34e772b",
        "name": "Set Notion API Error2",
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "resource": "databasePage",
          "operation": "update",
          "pageId": {
            "__rl": true,
            "value": "={{ $('Initial Input').item.json.source }}",
            "mode": "id"
          },
          "propertiesUi": {
            "propertyValues": [
              {
                "key": "Status|status",
                "statusValue": "Done"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          6256,
          608
        ],
        "id": "3a7f3369-fb60-41cf-8a88-2b565ef90520",
        "name": "Set Notion Success2",
        "executeOnce": true,
        "retryOnFail": true,
        "waitBetweenTries": 5000,
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "f6abe9ac-2a7d-4ead-8b3f-93d8aef7fb54",
                "name": "transformed_content_db_id",
                "value": "={{ $('Initial Input').first().json.transformed_content_db_id }}",
                "type": "string"
              },
              {
                "id": "f5a756d3-d95b-4941-99db-7abd73995af5",
                "name": "title",
                "value": "={{ $('Initial Input').first().json.image_prompts[0].name }}",
                "type": "string"
              },
              {
                "id": "b336bc2e-a12e-4936-bebf-ad274495a048",
                "name": "source_database_page",
                "value": "={{ $('Initial Input').first().json.source }}",
                "type": "string"
              },
              {
                "id": "a938dfe9-0069-4a97-82f2-2d22f6606cb6",
                "name": "platform",
                "value": "={{ $('Initial Input').first().json.platform }}",
                "type": "string"
              },
              {
                "id": "bcae6010-8182-40a7-94aa-ac436d2e10b3",
                "name": "images",
                "value": "={{ $json }}",
                "type": "string"
              },
              {
                "id": "ad97a256-fb62-45ef-82d3-dc88a804b2d7",
                "name": "content",
                "value": "={{ $('Initial Input').item.json.content }}",
                "type": "string"
              },
              {
                "id": "a16bb9ae-5755-462e-9764-1d2fa5a006ff",
                "name": "property_aspect_ratio",
                "value": "={{ $('Split Out Duplicate Prompts').first().json.property_aspect_ratio }}",
                "type": "string"
              },
              {
                "id": "832b87dd-1292-4fbd-9ae3-c2b0417c7aa6",
                "name": "chat_model",
                "value": "={{ $('Split Out Chat Modals').all()[$itemIndex].json.property_model }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          5808,
          704
        ],
        "id": "6a23c2ce-c4b6-4021-ada2-7841ae40ca2a",
        "name": "Set Subflow Fields4"
      },
      {
        "parameters": {
          "inputSource": "passthrough"
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -2016,
          784
        ],
        "id": "aa40c5bb-b456-44cf-bad4-e41b700de8f4",
        "name": "Initial Input"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "074bc9ef-54df-4dd5-a617-259349c4a425",
                "name": "set_image_prompts",
                "value": "={{ $('Get Initial Article').first().json.body.data.properties['Image Prompt Template'].relation }}",
                "type": "array"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -560,
          80
        ],
        "id": "b0351679-3fd0-4bcc-a0fa-40df9686d468",
        "name": "Set Image Prompts"
      },
      {
        "parameters": {
          "fieldToSplitOut": "set_image_prompts",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -336,
          80
        ],
        "id": "bbe892ab-7d5d-4f1d-abf6-1907c66b0ebe",
        "name": "Split Image Prompts"
      },
      {
        "parameters": {
          "resource": "databasePage",
          "operation": "get",
          "pageId": {
            "__rl": true,
            "value": "={{ $('Split Image Prompts').item.json.id }}",
            "mode": "id"
          }
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          112,
          80
        ],
        "id": "9ba8c856-f073-4688-863b-45c9e4c5b8fe",
        "name": "Extract Image Prompts",
        "executeOnce": false,
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "maxItems": 100
        },
        "type": "n8n-nodes-base.limit",
        "typeVersion": 1,
        "position": [
          1008,
          80
        ],
        "id": "d1d7a11a-8aea-4975-af0a-414afe7218df",
        "name": "Limit"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-5.1",
            "mode": "list",
            "cachedResultName": "gpt-5.1"
          },
          "options": {
            "temperature": 0.2
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          -864,
          1200
        ],
        "id": "98a1618e-031c-4c8e-853c-6f595232ee76",
        "name": "OpenAI Chat Model2",
        "credentials": {
          "openAiApi": {
            "id": "NoEKitspBJb0zQrp",
            "name": "Syntech GM OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Initial Post:\n{{ $('Initial Input').item.json.content }}\n\n{{ \n$if($('Initial Input').item.json.prompt_update, \n`\nUser provided prompt guidlines:\n${$('Initial Input').item.json.prompt_update}`, '')\n}}",
          "messages": {
            "messageValues": [
              {
                "message": "={{ $json.property_system_prompt }}\n\n{{ $json.property_system_message }}"
              }
            ]
          },
          "batching": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.7,
        "position": [
          -848,
          784
        ],
        "id": "01ad1517-b855-458f-8ba2-b03328be9c21",
        "name": "Image Prompt Generator",
        "retryOnFail": true,
        "waitBetweenTries": 5000
      },
      {
        "parameters": {
          "fieldToSplitOut": "image_prompts",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -1792,
          784
        ],
        "id": "1f77e593-1034-44e2-a26a-b72cad5a7771",
        "name": "Split Out Image Prompts"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "af522a61-b899-4c7e-b6e4-1f45e70f677c",
                "name": "prompt",
                "value": "={{ $json.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -496,
          784
        ],
        "id": "67fb9e3c-64b5-4ff8-a941-3a0031ef5783",
        "name": "Set Final Image Prompts"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.notion.com/v1/file_uploads",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "notionApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Notion-Version",
                "value": "2022-06-28"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "filename",
                "value": "={{ $('Split Out Chat Modals').item.json.name.split(' ').join('-').toLowerCase() + '-' + $('Initial Input').item.json.source }}"
              },
              {
                "name": "content_type",
                "value": "=image/jpeg"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          80,
          784
        ],
        "id": "19d7b8bd-4bb8-43e0-a401-0ed8b67ffd6d",
        "name": "Create a Notion File Upload object1",
        "alwaysOutputData": false,
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "image_prompts",
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          784,
          80
        ],
        "id": "8643f501-408e-48e5-8a61-7b854fb60a03",
        "name": "Aggregate Image Prompts"
      },
      {
        "parameters": {
          "fieldToSplitOut": "candidates[0].content.parts",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          528,
          784
        ],
        "id": "6844b2e6-24aa-490a-989b-b944a6b1431c",
        "name": "Split Out Parts"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "6f57c194-a475-4c13-bb0d-1ba4f29c704b",
                "leftValue": "={{ $json.inlineData.mimeType }}",
                "rightValue": "image",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2.2,
        "position": [
          704,
          784
        ],
        "id": "7faa2eab-1e0b-4d96-b080-a7067bfe6358",
        "name": "Grab Image"
      },
      {
        "parameters": {
          "resource": "database",
          "databaseId": {
            "__rl": true,
            "value": "={{ $json.properties[\"Images Output\"].relation.database_id }}",
            "mode": "id"
          },
          "simple": false
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          -784,
          80
        ],
        "id": "e9d7c1ff-410b-460b-9360-4c709cfc38ac",
        "name": "Get Images Output DB ID",
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "mode": "id",
            "value": "=QzfCHtJv0xZPYotB"
          },
          "mode": "each",
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          6032,
          704
        ],
        "id": "b190bd77-9c11-4c52-bf4d-2edbbb205a41",
        "name": "Add Images",
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "toBinary",
          "sourceProperty": "inlineData.data",
          "options": {
            "mimeType": "image/jpeg"
          }
        },
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          880,
          784
        ],
        "id": "b02160ff-5a81-4721-8dc9-4b7eaba3ac28",
        "name": "Convert to File"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Create a Notion File Upload object1').all()[$itemIndex].json.upload_url }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "notionApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Notion-Version",
                "value": "2022-06-28"
              }
            ]
          },
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "parameterType": "formBinaryData",
                "name": "file",
                "inputDataFieldName": "=data"
              },
              {
                "name": "content_type",
                "value": "={{ $binary.data.mimeType }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          5584,
          704
        ],
        "id": "e04cb0df-2d13-42ab-8c57-d3875cac0c01",
        "name": "Upload file contents1",
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "=U71UHBUD7DfPXOiO",
            "mode": "id",
            "cachedResultUrl": "/workflow/=U71UHBUD7DfPXOiO"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "mode": "each",
          "options": {
            "waitForSubWorkflow": true
          }
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          112,
          -112
        ],
        "id": "35958886-786e-4ec2-a128-3faf2dae1275",
        "name": "Execute Workflow"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-5.1",
            "mode": "list",
            "cachedResultName": "gpt-5.1"
          },
          "builtInTools": {},
          "options": {
            "temperature": 0.4
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          0,
          1024
        ],
        "id": "9663cf11-3eac-4468-8d5f-577e01ef459b",
        "name": "OpenAI Chat Model3",
        "credentials": {
          "openAiApi": {
            "id": "NoEKitspBJb0zQrp",
            "name": "Syntech GM OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineByPosition",
          "options": {}
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          5216,
          880
        ],
        "id": "912e5a76-8def-4633-8bbc-cc9084fc0707",
        "name": "Merge3"
      },
      {
        "parameters": {
          "operation": "composite",
          "dataPropertyNameComposite": "overlay",
          "options": {
            "fileName": "result",
            "format": "jpeg"
          }
        },
        "type": "n8n-nodes-base.editImage",
        "typeVersion": 1,
        "position": [
          5360,
          704
        ],
        "id": "04e9e207-3a22-4112-b634-33d79e1b4b91",
        "name": "Create Watermarked Image"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-image-preview:generateContent",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googlePalmApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"contents\": [{\n    \"parts\": [\n      {\"text\": {{ $('Refine Prompt to NanoBanana Style 13th Jan 2026').item.json.text.toJsonString() }}},\n      {\"inline_data\": {\"mime_type\":\"image/png\", \"data\": \"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\"}}\n    ]\n  }],\n  \"generationConfig\": {\n    \"imageConfig\": {\n      \"aspectRatio\": \"{{ $('Initial Input').item.json.image_aspect_ratio || '16:9' }}\"  \n    }\n  }\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          304,
          784
        ],
        "id": "cf255964-9b2b-4c4c-939b-44f7b2e1eaef",
        "name": "Generate Image Nano Banana HTTP",
        "retryOnFail": true,
        "waitBetweenTries": 5000,
        "credentials": {
          "googlePalmApi": {
            "id": "bpjfJQDu5gNEKIgK",
            "name": "Syntech GM Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "function duplicateObject(obj, count) {\n  const n = Number(count) || 1;\n  return Array.from({ length: n }, () => ({ ...obj }));\n}\n\nconst incomingPrompt = $json;\nconst numberOfVariants = $('Initial Input').first().json.num_variants || 1;\n\nconsole.log(\"incomingPrompt: \",incomingPrompt)\n\nconst output = duplicateObject(incomingPrompt, numberOfVariants);\n\nreturn {output}"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1568,
          784
        ],
        "id": "29dbc701-fa73-4f2d-80db-6d28866b86dd",
        "name": "Create Duplicate Prompts"
      },
      {
        "parameters": {
          "fieldToSplitOut": "output",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -1344,
          784
        ],
        "id": "e65076ea-4e69-497f-9e91-07d8b9fd727a",
        "name": "Split Out Duplicate Prompts"
      },
      {
        "parameters": {
          "resource": "databasePage",
          "operation": "getAll",
          "databaseId": {
            "__rl": true,
            "value": "2c8785c0-cfab-8179-8e11-f736b46e550b",
            "mode": "list",
            "cachedResultName": "SOCIAL: watermark",
            "cachedResultUrl": "https://www.notion.so/2c8785c0cfab81798e11f736b46e550b"
          },
          "returnAll": true,
          "options": {}
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          -2032,
          2848
        ],
        "id": "39d0a0b4-31b2-4de9-9a6a-fcaa3a78abbb",
        "name": "Get many database pages",
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=image link: {{ $('Get many database pages').item.json.property_image }}",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=You are a Senior Brand Designer analyzing watermark images and an aspect ratio converter for automated classification.\n\nConvert the decimal aspect ratio value to its closest standard simplified ratio format.\nINPUT: {{ $json.aspect_ratio_decimal }}\n\nSTANDARD RATIOS (in order):\n- 1:1 (1.00)\n- 2:3 (0.67)\n- 3:2 (1.50)\n- 3:4 (0.75)\n- 4:3 (1.33)\n- 4:5 (0.80)\n- 5:4 (1.25)\n- 9:16 (0.56)\n- 16:9 (1.78)\n- 21:9 (2.33)\n\nINSTRUCTIONS:\n1. Take the input decimal aspect ratio\n2. Compare it against all standard ratios above\n3. Find the closest match by calculating the smallest difference\n4. Return ONLY the simplified ratio in format \"X:Y\"\n\nAspect_Ratio: Return only the ratio string, nothing else. No explanations, no additional text.\n\nEXAMPLES:\n- Input: 1.78 → Output: 16:9\n- Input: 1.00 → Output: 1:1\n- Input: 0.67 → Output: 2:3\n- Input: 1.77 → Output: 16:9\n- Input: 1.34 → Output: 4:3\n- Input: 0.56 → Output: 9:16\n\nExample-1:\n{\n  \"aspectRatioDecimal\": \"1.00\",\n  \"aspectRatioSimplified\": \"1:1\",\n}\n\nExample-2: \n{\n  \"aspectRatio\": 1.7777777777777777,\n  \"aspectRatioDecimal\": \"1.78\",\n  \"aspectRatioSimplified\": \"16:9\",\n}\n\n\n**ORIENTATION:** Landscape | Portrait | Square | Wide | Vertical\nwidth: {{ $('Edit Image1').item.json.size.width }}\nheight: {{ $('Edit Image1').item.json.size.height }}\n**DIMENSIONS:** (width x height) (e.g., 832*1248)\n**DOMINANT_COLOR:** White | Black | Blue | Red | Green | Yellow | Orange | Purple | Multicolor\n**LUMINANCE:** High | Medium | Low\n**PLACEMENT_TYPE:** Corner Stamp | Full-Width Edge Band | Center Overlay\n**BACKGROUND_REQUIREMENT:** DARK | LIGHT | ANY\n**USE_CASE:** High-contrast branding | Subtle copyright protection | Social media attribution | Professional portfolio marking\n\n**FILENAME FORMAT:** sb_[DIMENSIONS]_[color]_[Aspect_Ratio]\n- Use \"multicolor\" in filename if watermark contains multiple colors\n- Use specific color name if single dominant color\n- Example: sb_1920x1080_white_16:9 OR sb_1920x1080_multicolor_16:9\n\n**DESCRIPTION FORMAT:** \nGenerate a precise, decision-grade description that clearly communicates visual strength, contrast behavior, placement impact, and suitability for different background types, enabling reliable automated selection of the best watermark for overlay.\nFormat:\n\"[Orientation] [Aspect_Ratio] watermark with [ACTUAL VISIBLE COLORS], featuring [Visual_Weight] visibility and [Edge_Clarity] edges, designed as [Placement_Type]. Optimized for [Background_Requirement] backgrounds, it delivers [Use_Case] while minimizing [Occlusion_Risk] over primary image content.\"\n\n\nADDITIONAL RULES FOR HIGH-QUALITY DESCRIPTIONS\nACTUAL VISIBLE COLORS\nExplicitly list all colors visible to the eye\nExamples:\n“solid white”\n“black and yellow”\n“gradient blue to purple”\n“red, white, and green”\nNever infer colors from filenames or metadata alone.\nVisual_Weight (MANDATORY – choose one)\nHigh-impact → Bold, thick, highly visible\nModerate → Balanced visibility without dominance\nLow-profile → Thin, subtle, minimally intrusive\nEdge_Clarity (MANDATORY – choose one)\nSharp-edged → Hard outlines, crisp text/logos\nSoft-edged → Blended, semi-transparent, feathered\nMixed-edge → Combination of sharp logo + soft fill\nOcclusion_Risk (MANDATORY – choose one)\nminimal obstruction\nmoderate obstruction\nhigh obstruction\nBackground Optimization Logic\nDARK → watermark remains legible on dark imagery\nLIGHT → watermark remains legible on light imagery\nANY → adaptive contrast or neutral transparency\nNO marketing fluff\nAvoid vague words like “beautiful”, “premium”, “nice”\nEvery phrase must support automated decision-making\n\nExample:\nWide 21:9 watermark with solid white coloring, featuring high-impact visibility and sharp-edged outlines, designed as a Center Overlay. Optimized for DARK backgrounds, it delivers high-contrast branding while maintaining moderate obstruction over focal image areas."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -720,
          2896
        ],
        "id": "c768e6ab-f02f-4e01-99a7-88bf6bb83801",
        "name": "AI Agent",
        "disabled": true
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-5.1",
            "mode": "list",
            "cachedResultName": "gpt-5.1"
          },
          "builtInTools": {},
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          -704,
          3152
        ],
        "id": "93cbc466-5add-4ce9-8d75-c897f0afcb83",
        "name": "OpenAI Chat Model1",
        "credentials": {
          "openAiApi": {
            "id": "NoEKitspBJb0zQrp",
            "name": "Syntech GM OpenAi account"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1424,
          2896
        ],
        "id": "a0f1fd6d-32a1-4062-83ad-7d846bc8daae",
        "name": "Loop Over Items1",
        "disabled": true
      },
      {
        "parameters": {
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "output"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          2608,
          624
        ],
        "id": "141f78f9-4608-4d72-84aa-7afc2767ed2a",
        "name": "Aggregate"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.limit",
        "typeVersion": 1,
        "position": [
          3360,
          592
        ],
        "id": "646c4015-2617-450b-962a-98ac27f7c2e8",
        "name": "Limit1"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          2384,
          1024
        ],
        "id": "2cee50c0-0f93-49c4-b1e1-247aac7b143e",
        "name": "Loop Over Items2"
      },
      {
        "parameters": {
          "sortFieldsUi": {
            "sortField": [
              {
                "fieldName": "score",
                "order": "descending"
              }
            ]
          },
          "options": {
            "disableDotNotation": false
          }
        },
        "type": "n8n-nodes-base.sort",
        "typeVersion": 1,
        "position": [
          3088,
          608
        ],
        "id": "1427ff1f-15ef-46e6-a40d-34ec691afd76",
        "name": "Sort"
      },
      {
        "parameters": {
          "url": "={{ $json.property_image[0] }}",
          "responseFormat": "file",
          "dataPropertyName": "watermark_binary",
          "options": {},
          "headerParametersUi": {
            "parameter": [
              {
                "name": "Name",
                "value": "={{ $json.name }}"
              }
            ]
          }
        },
        "id": "5827a19d-4f9e-44f3-99ca-22cacf648e9f",
        "name": "Download Watermark1",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 2,
        "position": [
          2160,
          1024
        ]
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=// Get the current watermark data (from the loop)\nWatermark Data: {{ JSON.stringify($('Edit Image2').item.json) }}\nWatermark_name: {{ $('Download Watermark1').item.json.name }}\nWatermark Image Description:\n{{ $('all watermark image').item.json.property_description }}\n\n// Get the specific original image (if you want just the first one\nCrop Image Data: \n{{ JSON.stringify($('Crop Image Info').first().json) }}\n\n",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=ROLE\nYou are an expert Image & Graphic Design Automation Agent.\n\nYour task is to select the SINGLE BEST watermark image from the provided list to overlay on the given Crop Image.\nYou must make the decision deterministically, prioritizing MAXIMUM VISUAL CONTRAST.\n\n--------------------------------\nINPUT DATA YOU WILL RECEIVE\n--------------------------------\n1. Crop Image\nChannel Statistics:\nGray: Minimum, Maximum, Mean, Standard Deviation\nOpacity: Minimum, Maximum, Mean, Standard Deviation\n\n2. Watermark Images (Array)\nEach watermark includes:\n- watermark_name\n- Channel Statistics:\n  - Gray: Minimum, Maximum, Mean, Standard Deviation\n  - Opacity: Minimum, Maximum, Mean, Standard Deviation\n\n3. Watermark Image Description (text)\nEach watermark has description like:\n\"Square 1:1 white watermark designed as Center Overlay, optimized for DARK backgrounds to provide High-contrast branding.\"\n\n--------------------------------\nPREPROCESSING & EDGE-CASE HANDLING (MANDATORY)\n--------------------------------\n\n**Missing or Invalid Statistics**\nIf any required channel statistic is missing, NaN, infinite, or zero-divided:\n→ score = 0, exclude from ranking.\n\n**Extreme Opacity Values**\n- Opacity Mean > 0.95 → Penalize heavily\n- Opacity Mean < 0.05 → score = 0 (invisible)\n\n**Tie-Breaking**\nIf multiple watermarks have identical scores:\n→ Choose watermark with Gray Mean furthest from crop Gray Mean\n→ If still tied, choose lower Opacity Mean\n\n--------------------------------\nPRIMARY SELECTION CRITERIA\n--------------------------------\n\n**STEP 1: BACKGROUND BRIGHTNESS CLASSIFICATION (ABSOLUTE PRIORITY)**\n\nDetermine the Crop Image background type using Gray Mean:\n```\nIF Gray Mean < 0.5:\n    Background Type = DARK\n    Required Watermark = WHITE/LIGHT (Gray Mean MUST be ≥ 0.65)\n    \nELSE IF Gray Mean ≥ 0.5:\n    Background Type = LIGHT  \n    Required Watermark = DARK/BLACK (Gray Mean MUST be ≤ 0.35)\n```\n\n**CRITICAL ENFORCEMENT RULE:**\n```\nFOR DARK BACKGROUNDS (Gray Mean < 0.5):\n    - REJECT ALL watermarks where Gray Mean < 0.65\n    - ONLY consider watermarks where Gray Mean ≥ 0.65\n    - The BRIGHTER the watermark, the BETTER the score\n    \nFOR LIGHT BACKGROUNDS (Gray Mean ≥ 0.5):\n    - REJECT ALL watermarks where Gray Mean > 0.35\n    - ONLY consider watermarks where Gray Mean ≤ 0.35\n    - The DARKER the watermark, the BETTER the score\n```\n\n**AUTO-REJECTION CONDITIONS (score = 0):**\n1. Watermark Gray Mean is on the SAME SIDE as background (both dark OR both light)\n2. Gray Mean difference < 0.3 (insufficient contrast)\n3. Watermark description contradicts the background type\n\n---\n\n**STEP 2: WATERMARK DESCRIPTION VALIDATION (OVERRIDE POWER)**\n\nIf watermark description exists:\n\n**For DARK backgrounds (Gray Mean < 0.5):**\n- Description contains \"white\" OR \"light\" OR \"DARK backgrounds\" → +40 bonus\n- Description contains \"black\" OR \"dark\" OR \"LIGHT backgrounds\" → score = 0 (reject)\n\n**For LIGHT backgrounds (Gray Mean ≥ 0.5):**\n- Description contains \"black\" OR \"dark\" OR \"LIGHT backgrounds\" → +40 bonus  \n- Description contains \"white\" OR \"light\" OR \"DARK backgrounds\" → score = 0 (reject)\n\n---\n\n**STEP 3: CONTRAST MAXIMIZATION (CORE SCORING)**\n\nAfter filtering by background type, score remaining watermarks:\n\n**Contrast Score (0-60 points):**\n```\nGray_Difference = |Crop Gray Mean - Watermark Gray Mean|\n\nIF Gray_Difference ≥ 0.5: +60\nELSE IF Gray_Difference ≥ 0.4: +45\nELSE IF Gray_Difference ≥ 0.3: +30\nELSE: score = 0 (insufficient contrast)\n```\n\n**Brightness Extremity Bonus (0-30 points):**\n\nFor DARK backgrounds:\n```\nIF Watermark Gray Mean ≥ 0.9: +30 (pure white - ideal)\nELSE IF Watermark Gray Mean ≥ 0.8: +20\nELSE IF Watermark Gray Mean ≥ 0.7: +10\nELSE: +0\n```\n\nFor LIGHT backgrounds:\n```\nIF Watermark Gray Mean ≤ 0.1: +30 (pure black - ideal)\nELSE IF Watermark Gray Mean ≤ 0.2: +20\nELSE IF Watermark Gray Mean ≤ 0.3: +10\nELSE: +0\n```\n\n**Opacity Balance (0-10 points):**\n```\nIF 0.4 ≤ Opacity Mean ≤ 0.7: +10\nELSE IF 0.3 ≤ Opacity Mean < 0.4 OR 0.7 < Opacity Mean ≤ 0.8: +5\nELSE: -10\n```\n\n---\n\n**STEP 4: FINAL SCORE CALCULATION**\n```\nBase Score = 0\n\nIF watermark passes background type filter:\n    Score += Contrast Score (0-60)\n    Score += Brightness Extremity Bonus (0-30)\n    Score += Description Match Bonus (0-40)\n    Score += Opacity Balance (0-10)\nELSE:\n    Score = 0 (reject)\n\nMaximum Possible Score = 140 (normalized to 0-100 in output)\n```\n\n--------------------------------\nDECISION LOGIC (DETERMINISTIC)\n--------------------------------\n\n1. **Filter Phase:**\n   - Classify background (DARK if Gray Mean < 0.5, else LIGHT)\n   - REJECT all watermarks that don't meet Gray Mean threshold\n   - REJECT watermarks with contradicting descriptions\n\n2. **Scoring Phase:**\n   - Calculate scores for remaining watermarks\n   - Prioritize MAXIMUM contrast (Gray Mean difference)\n   - Bonus for extreme brightness values (white for dark BG, black for light BG)\n\n3. **Selection Phase:**\n   - Choose watermark with HIGHEST score\n   - If tied, choose watermark with Gray Mean furthest from background\n\n4. **Output:**\n   - Return ONLY the single best watermark\n   - No randomness, no subjective decisions\n\n--------------------------------\nEXAMPLES FOR VALIDATION\n--------------------------------\n\n**Example 1: Dark Industrial/Road Background**\n```\nCrop Image: Gray Mean = 0.20 (DARK)\n\nWatermark A: Gray Mean = 0.85 (white), Description: \"white watermark for DARK backgrounds\"\n→ Score = 60 (contrast) + 20 (brightness) + 40 (description) + 10 (opacity) = 130/140\n\nWatermark B: Gray Mean = 0.15 (black), Description: \"black watermark\"  \n→ Score = 0 (REJECTED - same side as background)\n\nSELECTED: Watermark A ✓\n```\n\n**Example 2: Light Background**\n```\nCrop Image: Gray Mean = 0.75 (LIGHT)\n\nWatermark A: Gray Mean = 0.10 (black), Description: \"dark watermark for LIGHT backgrounds\"\n→ Score = 60 (contrast) + 30 (brightness) + 40 (description) + 10 (opacity) = 140/140\n\nWatermark B: Gray Mean = 0.80 (white)\n→ Score = 0 (REJECTED - same side as background)\n\nSELECTED: Watermark A ✓\n```\n\n--------------------------------\nOUTPUT FORMAT (STRICT)\n--------------------------------\n\nReturn ONLY valid JSON:\n```json\n{\n  \"score\": <0-100>,\n  \"watermark_name\": \"<exact watermark filename>\"\n}\n```\n\n**Rules:**\n- Do NOT add explanations\n- Do NOT add extra fields  \n- Do NOT add text outside JSON\n- Output must be parseable JSON only"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          3088,
          1088
        ],
        "id": "2a634b3e-82b6-4cf7-997d-5203c708c75f",
        "name": "AI Agent1"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-5.1",
            "mode": "list",
            "cachedResultName": "gpt-5.1"
          },
          "builtInTools": {},
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          3024,
          1328
        ],
        "id": "342cc9b4-268c-4d69-89c9-8ac1ec1dbdfa",
        "name": "OpenAI Chat Model6",
        "credentials": {
          "openAiApi": {
            "id": "NoEKitspBJb0zQrp",
            "name": "Syntech GM OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "62593842-213a-44d2-b801-5ef19fc25808",
                "name": "property_image[0]",
                "value": "={{ $json.property_image[0] }}",
                "type": "string"
              },
              {
                "id": "55739784-930a-49bb-874e-e51c148ae6ad",
                "name": "name",
                "value": "={{ $json.name }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1936,
          1024
        ],
        "id": "ef1b7755-192e-4cad-9488-9b85192bd5f7",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "operation": "information",
          "dataPropertyName": "watermark_binary"
        },
        "type": "n8n-nodes-base.editImage",
        "typeVersion": 1,
        "position": [
          2608,
          1024
        ],
        "id": "7c083777-512d-4c95-a37e-eef5f888c6d4",
        "name": "Edit Image2"
      },
      {
        "parameters": {
          "jsCode": "// Get array of objects directly\nconst items = $input.first().json.output;\n\n// Normalize scores to numbers\nconst parsed = items.map(item => ({\n  score: Number(item.score),\n  watermark_name: item.watermark_name\n}));\n\n// Sort by score DESC (highest first)\nparsed.sort((a, b) => b.score - a.score);\n\n// Return each item as separate output\nreturn parsed.map(p => ({\n  json: {\n    score: p.score,\n    watermark_name: p.watermark_name\n  }\n}));"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2880,
          608
        ],
        "id": "6356477f-28c7-4c64-a405-31fd88184a05",
        "name": "Code in JavaScript"
      },
      {
        "parameters": {
          "jsCode": "// ✅ Get ALL items from Edit Image1 (even if not connected)\nconst editImageItems = $items(\"Image Information\");\n\n// ✅ Get watermark image URL from Notion\nconst imageUrl =\n  $items(\"watermark image\")[0].json.property_image[0];\n\n// Safety check\nif (!imageUrl) {\n  throw new Error(\"No image URL found\");\n}\n\n// ✅ Create output matching Edit Image count\nconst output = editImageItems.map((item, index) => ({\n  json: {\n    image_no: index + 1,\n    image_url: imageUrl,\n    image_info: item.json\n  }\n}));\n\nreturn output;\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3776,
          576
        ],
        "id": "35c101d1-f6c7-4aca-a070-cab73ba947e3",
        "name": "Code in JavaScript1"
      },
      {
        "parameters": {
          "operation": "information"
        },
        "type": "n8n-nodes-base.editImage",
        "typeVersion": 1,
        "position": [
          1008,
          1056
        ],
        "id": "6f9f1593-4c50-419e-b22a-4c84f4697159",
        "name": "Image Information"
      },
      {
        "parameters": {
          "url": "={{ $json.image_url }}",
          "options": {
            "response": {
              "response": {
                "responseFormat": "file",
                "outputPropertyName": "overlay"
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3968,
          528
        ],
        "id": "dd00a320-665b-4954-aa87-c24051ea6ad1",
        "name": "get overlay"
      },
      {
        "parameters": {
          "content": "### Select Dynamic overlay",
          "height": 1168,
          "width": 3600
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1376,
          400
        ],
        "typeVersion": 1,
        "id": "cfb10483-9869-4fc0-a229-db06662cebbe",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "resource": "databasePage",
          "operation": "getAll",
          "databaseId": {
            "__rl": true,
            "value": "2c8785c0-cfab-8179-8e11-f736b46e550b",
            "mode": "list",
            "cachedResultName": "watermark",
            "cachedResultUrl": "https://www.notion.so/2c8785c0cfab81798e11f736b46e550b"
          },
          "returnAll": true,
          "filterType": "manual",
          "filters": {
            "conditions": [
              {
                "key": "Aspect Ratio|rich_text",
                "condition": "equals",
                "richTextValue": "={{ $('Split Out Chat Modals').item.json.property_aspect_ratio }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          1712,
          1024
        ],
        "id": "fe8e23b3-1a9b-4013-b608-ea2501c56bac",
        "name": "all watermark image",
        "executeOnce": true,
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "resource": "databasePage",
          "operation": "getAll",
          "databaseId": {
            "__rl": true,
            "value": "2c8785c0-cfab-8179-8e11-f736b46e550b",
            "mode": "list",
            "cachedResultName": "watermark",
            "cachedResultUrl": "https://www.notion.so/2c8785c0cfab81798e11f736b46e550b"
          },
          "filterType": "manual",
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "key": "Watermark Name|title",
                "condition": "equals",
                "titleValue": "={{ $json.watermark_name }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          3584,
          576
        ],
        "id": "4e52d8da-c02b-4ec8-ae73-66d16f8ec140",
        "name": "watermark image",
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "operation": "information",
          "dataPropertyName": "overlay"
        },
        "type": "n8n-nodes-base.editImage",
        "typeVersion": 1,
        "position": [
          4176,
          528
        ],
        "id": "3a869fc4-8e90-4212-a0ec-219b335bc582",
        "name": "Edit Image3",
        "disabled": true
      },
      {
        "parameters": {
          "operation": "resize",
          "dataPropertyName": "overlay",
          "width": "={{ $('Image Information').item.json.size.width }}",
          "height": "={{ $('Image Information').item.json.size.height }}",
          "resizeOption": "ignoreAspectRatio",
          "options": {}
        },
        "type": "n8n-nodes-base.editImage",
        "typeVersion": 1,
        "position": [
          4480,
          528
        ],
        "id": "96a3d9fe-c01d-48a5-ab1a-1219becdb96b",
        "name": "Edit Image4"
      },
      {
        "parameters": {
          "operation": "information",
          "dataPropertyName": "overlay"
        },
        "type": "n8n-nodes-base.editImage",
        "typeVersion": 1,
        "position": [
          4736,
          544
        ],
        "id": "9e398334-323a-4c89-a63f-28287d753bbd",
        "name": "Edit Image5"
      },
      {
        "parameters": {
          "resource": "databasePage",
          "operation": "update",
          "pageId": {
            "__rl": true,
            "value": "={{ $('Loop Over Items1').item.json.id }}",
            "mode": "id"
          },
          "propertiesUi": {
            "propertyValues": [
              {
                "key": "watermark_image_info|rich_text",
                "textContent": "={{ $json.output.filename }}"
              },
              {
                "key": "Description|rich_text",
                "textContent": "={{ $json.output.description }}"
              },
              {
                "key": "Aspect Ratio|rich_text",
                "textContent": "={{ $json.output.aspect_ratio }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          -160,
          2912
        ],
        "id": "5aa8a3ce-bafc-421b-b693-b29ce867e50c",
        "name": "Update a database page",
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n  \"description\": \"[generated description]\",\n  \"filename\": \"[generated filename]\",\n  \"orientation\": \"[value]\",\n  \"aspect_ratio\": \"[value]\",\n  \"dimensions\": \"[value]\",\n  \"dominant_color\": \"[value]\",\n  \"luminance\": \"[value]\",\n  \"placement_type\": \"[value]\",\n  \"background_requirement\": \"[value]\",\n  \"use_case\": \"[value]\"\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -496,
          3152
        ],
        "id": "65413ec4-6033-4955-ae18-f7c3a4047a1b",
        "name": "Structured Output Parser",
        "disabled": true
      },
      {
        "parameters": {
          "operation": "crop",
          "width": "={{ $json.size.width }}",
          "height": "={{ $json.size.height*0.2}}",
          "positionY": "={{ $json.size.height - $json.size.height*0.2}}",
          "options": {}
        },
        "type": "n8n-nodes-base.editImage",
        "typeVersion": 1,
        "position": [
          1200,
          1056
        ],
        "id": "bf8557ea-88b8-411a-b350-877401ddf655",
        "name": "Crop Image(20%)"
      },
      {
        "parameters": {
          "operation": "information"
        },
        "type": "n8n-nodes-base.editImage",
        "typeVersion": 1,
        "position": [
          1456,
          1024
        ],
        "id": "ea7e47b1-c7c0-4222-89c1-aba0c82172b5",
        "name": "Crop Image Info"
      },
      {
        "parameters": {
          "operation": "information",
          "dataPropertyName": "watermark_binary"
        },
        "type": "n8n-nodes-base.editImage",
        "typeVersion": 1,
        "position": [
          -1168,
          2912
        ],
        "id": "0894d7fd-e1fd-432a-8a9a-67db93557fe7",
        "name": "Edit Image1",
        "disabled": true
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "b38d40d3-83c2-43a8-8b21-28de0f702e2f",
                "name": "aspect_ratio_decimal",
                "value": "={{ $json.size.width/$json.size.height }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -960,
          2912
        ],
        "id": "2af3e1e6-3ffe-4c4a-9662-e7d3d5488b43",
        "name": "Edit Fields1",
        "disabled": true
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          -2304,
          2832
        ],
        "id": "617ec988-640d-480e-a5e0-33f85af75dd4",
        "name": "When clicking ‘Execute workflow’",
        "disabled": true
      },
      {
        "parameters": {
          "url": "={{ $json.property_image[0] }}",
          "responseFormat": "file",
          "dataPropertyName": "watermark_binary",
          "options": {},
          "headerParametersUi": {
            "parameter": [
              {
                "name": "Name",
                "value": "={{ $json.name }}"
              }
            ]
          }
        },
        "id": "9fb115d3-bb83-49ac-b515-478bc974f453",
        "name": "Download Watermark",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 2,
        "position": [
          -1712,
          2864
        ],
        "disabled": true
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-5.1",
            "mode": "list",
            "cachedResultName": "gpt-5.1"
          },
          "builtInTools": {},
          "options": {
            "temperature": 0.4
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          -2064,
          1712
        ],
        "id": "72724ff8-2b86-48b1-b910-56c5dc8c0a8f",
        "name": "OpenAI Chat Model7",
        "credentials": {
          "openAiApi": {
            "id": "NoEKitspBJb0zQrp",
            "name": "Syntech GM OpenAi account"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.prompt }}",
          "messages": {
            "messageValues": [
              {
                "message": "=You are Syntech's Stage-2 Image Execution Engine.\n\nYou receive:\n• ONE structured Stage-1 visual brief\n• An example-pack style universe (already selected)\n• Optional user guidelines\n\nYour job is to **faithfully execute** the Stage-1 brief into a final image prompt suitable for image generation.\n\nYou DO NOT reinterpret strategy.\nYou DO NOT invent concepts.\nYou DO NOT override the example universe.\n\nYour role is precise visual execution.\n\n------------------------------------------------------------\n# 🔒 EXECUTION HIERARCHY (STRICT)\n\n1. Stage-1 structured brief (highest authority)\n2. Example-pack universe\n3. Syntech brand foundations\n4. Optional user guidelines\n\nIf conflicts exist:\n• Resolve silently\n• Never explain decisions\n• Always protect visual quality and coherence\n\n------------------------------------------------------------\n# 🎨 CORE EXECUTION PRINCIPLES\n\n• Execute the **visual universe**, not the literal wording\n• Maintain stylistic consistency with the example pack\n• Preserve creative variation **within** the universe\n• Avoid visual repetition across outputs\n• Keep imagery relevant to sustainability, energy, systems, or progress — even when abstract\n\nDo NOT default to:\n• Trucks\n• Fuel pumps\n• Vehicles\n• Literal objects\n\nUnless the Stage-1 brief explicitly requires them  \nOR the example pack strongly supports them\n\n------------------------------------------------------------\n# 🖼️ IMAGE COMPOSITION RULES\n\n• Full-frame image — no poster cards, no white blocks\n• No artificial reserved space anywhere\n• No visual framing that implies logos or captions\n• The image must feel complete on its own\n\nBottom of image:\n• Do NOT place text\n• Do NOT place logos\n• Do NOT anchor focal objects there\n• It may contain subtle background, ground, gradient, or atmosphere\n\n------------------------------------------------------------\n# ✍️ TEXT HANDLING (VERY IMPORTANT)\n\nIf text is required by Stage-1:\n\nALLOWED:\n• Headline only\n• Headline + subheadline\n• Short phrases\n• Clean, minimal placement\n• Colours chosen for legibility (brand or universe-appropriate)\n\nFORBIDDEN:\n• Text shadows\n• Glow effects\n• Outlines\n• Describing what the text \"means\"\n• Describing fonts, weights, sizes, or typography metadata\n• Writing labels like \"Headline:\" or \"Subheadline:\"\n• Writing the word \"Syntech\", slogans, or logos\n\nText must appear natural, intentional, and designer-placed.\n\n------------------------------------------------------------\n# 🎨 COLOUR BEHAVIOUR\n\n• Do NOT lock colours strictly to brand palette\n• Use the example-pack universe as the primary guide\n• Brand colours should appear subtly or atmospherically\n• Increase vibrancy when the universe allows it\n• Remain calm, engineered, and intentional — never chaotic\n\n------------------------------------------------------------\n# 🧬 STYLE FIDELITY RULE\n\nIf the example pack is:\n• Iconography → create illustrative / symbolic forms\n• CGI → produce clean, high-fidelity renders\n• Photographic → realistic lighting and materials\n• Abstract → controlled abstraction with relevance\n\nNever mix universes.\nNever \"photo-realise\" an icon pack.\nNever \"illustrate\" a photographic pack.\n\n------------------------------------------------------------\n# 🚫 HARD PROHIBITIONS\n\nNever include:\n• Logos\n• Brand marks\n• Watermarks\n• Text shadows\n• Overlays\n• Poster frames\n• Cheap legibility tricks\n• Random objects not supported by the universe\n• Aesthetic drift outside the example pack\n\n------------------------------------------------------------\n# 🎯 FINAL OUTPUT REQUIREMENTS\n\nOutput ONE final image-generation prompt that is:\n\n• Visually diverse\n• Style-faithful to the example pack\n• Executed with senior-designer judgment\n• Relevant to Syntech Biofuel themes (directly or metaphorically)\n• Free of branding artefacts\n• Clean, confident, and intentional\n\nDo not explain.\nDo not justify.\nDo not add commentary.\n\nJust output the final prompt."
              }
            ]
          },
          "batching": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.7,
        "position": [
          -2128,
          1488
        ],
        "id": "6c5c68a3-8a97-4d88-946b-fab2e0edc60a",
        "name": "Refine Prompt to NanoBanana Style2",
        "disabled": true
      },
      {
        "parameters": {
          "content": "#DO not delete",
          "height": 1296,
          "width": 544
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -2256,
          1280
        ],
        "id": "6ddf4b16-fd43-4bf8-8f0f-2aa7e44281fc",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-5.1",
            "mode": "list",
            "cachedResultName": "gpt-5.1"
          },
          "builtInTools": {},
          "options": {
            "temperature": 0.4
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          -2064,
          2144
        ],
        "id": "0d19212e-7262-4a87-9ad9-0a7c04847eba",
        "name": "OpenAI Chat Model9",
        "credentials": {
          "openAiApi": {
            "id": "NoEKitspBJb0zQrp",
            "name": "Syntech GM OpenAi account"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.prompt }}",
          "messages": {
            "messageValues": [
              {
                "message": "=You are Syntech's Stage-2 Image Execution Engine.\n\nYou receive:\n• ONE structured Stage-1 visual brief  \n• An example-pack style universe (already selected)  \n• Optional user guidelines  \n\nYour job is to **faithfully execute** the Stage-1 brief into a final image prompt suitable for image generation.  \n\nYou DO NOT reinterpret strategy.  \nYou DO NOT invent concepts.  \nYou DO NOT override the example universe.  \n\nYour role is precise visual execution.\n\n---\n\n# 🔒 EXECUTION HIERARCHY (STRICT)\n\n1. Stage-1 structured brief (highest authority)  \n2. Example-pack universe  \n3. Syntech brand foundations  \n4. Optional user guidelines  \n\nIf conflicts exist:  \n• Resolve silently  \n• Never explain decisions  \n• Always protect visual quality and coherence  \n\n---\n\n# 🎨 CORE EXECUTION PRINCIPLES\n\n• Execute the **visual universe**, not the literal wording  \n• Maintain stylistic consistency with the example pack  \n• Preserve creative variation **within** the universe  \n• Avoid visual repetition across outputs  \n• Keep imagery relevant to sustainability, energy, systems, or progress — even when abstract  \n\nDo NOT default to:  \n• Trucks  \n• Fuel pumps  \n• Vehicles  \n• Literal objects  \nUnless the Stage-1 brief explicitly requires them  \nOR the example pack strongly supports them  \n\n---\n\n# 🖼️ IMAGE COMPOSITION RULES\n\n• Full-frame image — no poster cards, no white blocks  \n• No artificial reserved space anywhere  \n• No visual framing that implies logos or captions  \n• The image must feel complete on its own  \n\nBottom of image:  \n• Do NOT place text  \n• Do NOT place logos  \n• Do NOT anchor focal objects there  \n• It may contain subtle background, ground, gradient, or atmosphere  \n\n---\n\n# ✍️ TEXT HANDLING (VERY IMPORTANT)\n\nIf text is required by Stage-1:\n\nALLOWED:  \n• Headline only  \n• Headline + subheadline  \n• Short phrases  \n• Clean, minimal placement  \n• Colours chosen for legibility (brand or universe-appropriate)  \n\nFORBIDDEN:  \n• Text shadows  \n• Glow effects  \n• Outlines  \n• Describing what the text \"means\"  \n• Describing fonts, weights, sizes, or typography metadata  \n• Writing labels like \"Headline:\" or \"Subheadline:\"  \n• Writing the word \"Syntech\", slogans, or logos  \n\nText must appear natural, intentional, and designer-placed.\n\n---\n\n# 🎨 COLOUR EXECUTION LOGIC\n\n• Prioritise colour **impact**, legibility, and mood over neutrality  \n• You may increase vibrancy, colour contrast, or saturation when:  \n  - The Stage-1 brief supports it  \n  - The example universe allows flexibility  \n  - The image benefits emotionally or visually from enhanced colour  \n\n• Do NOT inject artificial or irrelevant colour  \n• All colour choices must feel **natural, intentional, and grounded in logic**  \n• Brand colours may appear subtly or atmospherically — but do not suppress them if their presence enhances clarity or tone  \n• When in doubt, **favour clarity and contrast over muted neutrality**  \n\nRemain engineered, confident, and clean — but not flat or washed out.\n\n---\n\n# 🧬 STYLE FIDELITY RULE\n\nIf the example pack is:  \n• Iconography → create illustrative / symbolic forms  \n• CGI → produce clean, high-fidelity renders  \n• Photographic → realistic lighting and materials  \n• Abstract → controlled abstraction with relevance  \n\nNever mix universes.  \nNever \"photo-realise\" an icon pack.  \nNever \"illustrate\" a photographic pack.  \n\n---\n\n# 🚫 HARD PROHIBITIONS\n\nNever include:  \n• Logos  \n• Brand marks  \n• Watermarks  \n• Text shadows  \n• Overlays  \n• Poster frames  \n• Cheap legibility tricks  \n• Random objects not supported by the universe  \n• Aesthetic drift outside the example pack  \n\n---\n\n# 🎯 FINAL OUTPUT REQUIREMENTS\n\nOutput ONE final image-generation prompt that is:  \n\n• Visually diverse  \n• Style-faithful to the example pack  \n• Executed with senior-designer judgment  \n• Relevant to Syntech Biofuel themes (directly or metaphorically)  \n• Free of branding artefacts  \n• Clean, confident, and intentional  \n• Allows **richer colour, contrast, and lighting** when contextually appropriate  \n\nDo not explain.  \nDo not justify.  \nDo not add commentary.  \n\nJust output the final prompt."
              }
            ]
          },
          "batching": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.7,
        "position": [
          -2128,
          1920
        ],
        "id": "570bc5bb-b90d-44df-b7eb-d0cf46a3d23e",
        "name": "Refine Prompt to NanoBanana Style3",
        "disabled": true
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.prompt }}",
          "messages": {
            "messageValues": [
              {
                "message": "=You are Syntech's Stage-2 Image Execution Engine.\n\nYou receive:\n• ONE structured Stage-1 visual brief  \n• An example-pack style universe (already selected)  \n• Optional user guidelines  \n\nYour job is to **faithfully execute** the Stage-1 brief into a final image prompt suitable for image generation.\n\nYou DO NOT reinterpret strategy.  \nYou DO NOT invent concepts.  \nYou DO NOT override the example universe.  \n\nYour role is precise visual execution.\n\n---\n\n# 🔒 EXECUTION HIERARCHY (STRICT)\n\n1. Stage-1 structured brief (highest authority)  \n2. Example-pack universe  \n3. Syntech brand foundations  \n4. Optional user guidelines  \n\nIf conflicts exist:  \n• Resolve silently  \n• Never explain decisions  \n• Always protect visual quality and coherence  \n\n---\n\n# 🎨 CORE EXECUTION PRINCIPLES\n\n• Execute the **visual universe**, not the literal wording  \n• Maintain stylistic consistency with the example pack  \n• Preserve creative variation **within** the universe  \n• Avoid visual repetition across outputs  \n• Keep imagery relevant to sustainability, energy, systems, or progress — even when abstract  \n\nDo NOT default to:  \n• Trucks  \n• Fuel pumps  \n• Vehicles  \nUnless the Stage-1 brief explicitly requires them  \nOR the example pack strongly supports them  \n\n---\n\n# 🖼️ IMAGE COMPOSITION RULES\n\n• Full-frame image — no poster cards, no white blocks  \n• No artificial reserved space anywhere  \n• No visual framing that implies logos or captions  \n• The image must feel complete on its own  \n\n## Bottom 20% Zone (Watermark Guidance)\n• The **bottom 20% of the image must remain visually clear** for a watermark overlay  \n• This does NOT mean leaving it blank, faded, bordered, or gradiented  \n• It must:\n  - Remain fully part of the image\n  - Contain **no essential content**\n  - Avoid contrast, text, or detail that would compete with a watermark\n• Do not generate any visual device (e.g. border, frame, bar, glow) to reserve the space\n\n---\n\n# ✍️ TEXT HANDLING (VERY IMPORTANT)\n\nIf text is required by Stage-1:\n\nALLOWED:  \n• Headline only  \n• Headline + subheadline  \n• Short phrases  \n• Clean, minimal placement  \n• Colours chosen for legibility (brand or universe-appropriate)  \n\nFORBIDDEN:  \n• Text shadows  \n• Glow effects  \n• Outlines  \n• Describing what the text \"means\"  \n• Describing fonts, weights, sizes, or typography metadata  \n• Writing labels like \"Headline:\" or \"Subheadline:\"  \n• Writing the word \"Syntech\", slogans, or logos  \n\n**Typography must always use Syntech’s brand family (Montserrat)**  \nText must appear natural, intentional, and designer-placed.\n\n---\n\n# 👤 HUMAN IMAGE RULES\n\nIf the image includes human subjects:\n\n• The image must feel like a **documentary photograph** taken by a commercial photographer inside a real, functioning facility  \n• No stylization, beauty filters, influencer lighting, or cinematic effects  \n• Humans must appear as **real working professionals**, not models  \n\nFaces must show:\n- Natural skin texture and imperfections  \n- Pores, uneven tone, shine, and subtle pigmentation  \n- Asymmetry, natural under-eye shadows, and real lip texture  \n\nBlack subjects must show:\n- Authentic melanin response in light/shadow  \n- Natural hairline, baby hairs, visible follicles  \n\nEyes must appear:\n- Moist with natural reflections  \n- Imperfect lashes and visible sclera details  \n\nClothing and PPE must:\n- Appear worn, creased, or slightly scuffed  \n- Include safety gear like high-vis jackets, hard hats, gloves, or goggles  \n- Show fabric texture and realistic folds — never costume-grade or fake clean  \n\nSubjects must be mid-task — **no posing or looking at the camera**  \n\nEnvironments must be industrially authentic:\n- Control rooms, turbine halls, refinery floors, substations, data rooms  \n- Include pipes, gauges, cables, control panels, machinery, or structural elements  \n\nLighting must reflect real-world conditions:\n- Overhead fluorescents, sodium vapor, LED glow, or ambient industrial lighting  \n- Realistic shadows and specular highlights — no surreal color grading  \n\nCamera logic must feel candid:\n- Eye-level or over-shoulder POV, shallow depth of field, slight lens falloff  \n- Natural motion blur if needed, never hyper-sharp digital look  \n\nIf it **feels like AI**, it fails.  \nThe image must pass as a **real industrial photo** in a Chevron, Shell, or Siemens report.\n\nDo not stylize.  \nDo not beautify.  \nDo not idealize.  \nOnly realism, context, and respect.\n\n---\n\n# 🏗️ INFRASTRUCTURE IMAGE RULES\n\n• **Prefer micro or detailed views** of infrastructure over wide macro shots  \n• Wide macro views are only acceptable if:\n  - The image pack explicitly supports them\n  - The scene does not resemble generic or third-party facilities  \n\n• Infrastructure must feel “owned,” not borrowed — abstract, close-up, schematic, or brand-aligned\n\n---\n\n# 🎨 COLOUR EXECUTION LOGIC\n\n• Prioritise colour **impact**, legibility, and mood over neutrality  \n• You may increase vibrancy, colour contrast, or saturation when:\n  - The Stage-1 brief supports it  \n  - The example universe allows flexibility  \n  - The image benefits emotionally or visually from enhanced colour  \n\n• Do NOT inject artificial or irrelevant colour  \n• All colour choices must feel **natural, intentional, and grounded in context**  \n• Brand colours may appear subtly or atmospherically — but do not suppress them if their presence enhances clarity or tone  \n• When in doubt, **favour clarity and contrast over muted neutrality**  \n\nRemain engineered, confident, and clean — but not flat or washed out.\n\n---\n\n# 🧬 STYLE FIDELITY RULE\n\nIf the example pack is:  \n• Iconography → create illustrative / symbolic forms  \n• CGI → produce clean, high-fidelity renders  \n• Photographic → realistic lighting and materials  \n• Abstract → controlled abstraction with relevance  \n\nNever mix universes.  \nNever \"photo-realise\" an icon pack.  \nNever \"illustrate\" a photographic pack.  \n\n---\n\n# 🚫 HARD PROHIBITIONS\n\nNever include:  \n• Logos  \n• Brand marks  \n• Watermarks  \n• Text shadows  \n• Overlays  \n• Poster frames  \n• Artificial borders or bottom bars  \n• Generated or placeholder Syntech logos  \n• Aesthetic drift outside the example pack  \n• Generic or irrelevant objects that do not connect to message, metaphor, or Syntech’s domain  \n\n---\n\n# 💡 SYMBOLIC + METAPHOR GUIDANCE\n\n• All visual elements must carry **intentional meaning**  \n• Avoid random object placement or meaningless scenery  \n• Images must express metaphor, relevance, or visual logic  \n• Expand creatively using Syntech’s core themes:\n  - Environmental responsibility  \n  - Fuel systems and transitions  \n  - Engineering-led sustainability  \n  - Ecological improvement  \n  - Energy infrastructure  \n  - Circular economy  \n\nDo not rely on literal fuel references unless clearly required.  \nUse metaphor and theme to deliver conceptual strength.\n\n---\n\n# 🎯 FINAL OUTPUT REQUIREMENTS\n\nOutput ONE final image-generation prompt that is:  \n\n• Visually diverse  \n• Style-faithful to the example pack  \n• Executed with senior-designer judgment  \n• Relevant to Syntech Biofuel themes (directly or metaphorically)  \n• Free of branding artefacts  \n• Clean, confident, and intentional  \n• Composed for watermark compatibility  \n• Incorporates richer colour, contrast, or natural imperfection where appropriate  \n• Never random — always grounded in meaning, metaphor, or domain logic  \n\n**If human subjects are present, apply full Human Realism Lock logic.**\n\nDo not explain.  \nDo not justify.  \nDo not add commentary.  \n\nJust output the final prompt."
              }
            ]
          },
          "batching": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.7,
        "position": [
          -272,
          784
        ],
        "id": "6fcf529f-aa71-421b-b9f3-64b5141e1fd8",
        "name": "Refine Prompt to NanoBanana Style 13th Jan 2026"
      },
      {
        "parameters": {
          "resource": "databasePage",
          "operation": "get",
          "pageId": {
            "__rl": true,
            "value": "={{ $('Extract Image Prompts').item.json.property_version[0] }}",
            "mode": "id"
          }
        },
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2.2,
        "position": [
          336,
          16
        ],
        "id": "fe2dcb43-ac4e-473a-89c4-c88efd47c6be",
        "name": "Extract Image Version Prompts",
        "executeOnce": false,
        "credentials": {
          "notionApi": {
            "id": "k0ZwGrqySi9Wayf7",
            "name": "Stephen Notion account"
          }
        }
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineByPosition",
          "options": {}
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          560,
          80
        ],
        "id": "b9e90ff5-ec22-4add-b075-02bc1aab8946",
        "name": "Merge"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.5-pro",
          "options": {
            "temperature": 0.2
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -864,
          1024
        ],
        "id": "77718895-8f78-45cf-bc75-4a46189e178a",
        "name": "Google Gemini Chat Model",
        "credentials": {
          "googlePalmApi": {
            "id": "bpjfJQDu5gNEKIgK",
            "name": "Syntech GM Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.5-pro",
          "options": {
            "temperature": 0.4
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          16,
          1216
        ],
        "id": "0c49a396-2719-4302-9469-7a40c07b3bc8",
        "name": "Google Gemini Chat Model1",
        "credentials": {
          "googlePalmApi": {
            "id": "bpjfJQDu5gNEKIgK",
            "name": "Syntech GM Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.5-pro",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3200,
          1328
        ],
        "id": "c63722f5-056d-4dba-9d85-a06c396da229",
        "name": "Google Gemini Chat Model2",
        "credentials": {
          "googlePalmApi": {
            "id": "bpjfJQDu5gNEKIgK",
            "name": "Syntech GM Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n  \"score\": \"<0-100>\",\n  \"watermark_name\": \"<exact watermark filename>\"\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          3376,
          1328
        ],
        "id": "ed1e603e-a951-4027-8182-bbbbbd4f238c",
        "name": "Structured Output Parser3"
      },
      {
        "parameters": {
          "model": "={{ $('Split Out Chat Modals').item.json.property_model || 'google/gemini-2.5-pro' }}",
          "options": {
            "temperature": 0.2
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -656,
          1008
        ],
        "id": "faa88138-93fa-48a4-bd97-e41ebcd6380e",
        "name": "OpenRouter Chat Model",
        "credentials": {
          "openRouterApi": {
            "id": "kUkOiAL6PjmdfexG",
            "name": "Syntech GM OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "model": "={{ $('Split Out Chat Modals').item.json.property_model || 'google/gemini-2.5-pro' }}",
          "options": {
            "temperature": 0.4
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -240,
          1008
        ],
        "id": "ee5cca37-542d-4063-a6b3-5a030689226e",
        "name": "OpenRouter Chat Model1",
        "credentials": {
          "openRouterApi": {
            "id": "kUkOiAL6PjmdfexG",
            "name": "Syntech GM OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "fieldToSplitOut": "property_model",
          "include": "allOtherFields",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -1088,
          784
        ],
        "id": "c847ac0e-fcfb-4d20-9216-5c414611fbcf",
        "name": "Split Out Chat Modals"
      },
      {
        "parameters": {
          "content": "## Add LLM here\n* Currently using first() - might need a merge"
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          5728,
          512
        ],
        "id": "a69261cf-0de9-4f43-afec-2fb08935eb71",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "content": "## generate watermark description and name",
          "height": 768,
          "width": 2672,
          "color": 2
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2448,
          2656
        ],
        "typeVersion": 1,
        "id": "f2d00608-f3ef-4647-a18e-41d511f99d63",
        "name": "Sticky Note3"
      }
    ],
    "connections": {
      "Get Content With Block ID": {
        "main": [
          [
            {
              "node": "Get Parent DB ID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Parent DB ID": {
        "main": [
          [
            {
              "node": "Get Images Output DB ID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Input3": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Block Content": {
        "main": [
          [
            {
              "node": "Format Block Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Block Content": {
        "main": [
          [
            {
              "node": "Set Input3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [
            {
              "node": "Execute Workflow",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Extract Image Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Initial Article": {
        "main": [
          [
            {
              "node": "Get Content With Block ID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Subflow Fields4": {
        "main": [
          [
            {
              "node": "Add Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Initial Input": {
        "main": [
          [
            {
              "node": "Split Out Image Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Image Prompts": {
        "main": [
          [
            {
              "node": "Split Image Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Image Prompts": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Image Prompts": {
        "main": [
          [
            {
              "node": "Extract Image Version Prompts",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Limit": {
        "main": [
          [
            {
              "node": "Get Block Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Image Prompt Generator": {
        "main": [
          [
            {
              "node": "Set Final Image Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out Image Prompts": {
        "main": [
          [
            {
              "node": "Create Duplicate Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Final Image Prompts": {
        "main": [
          [
            {
              "node": "Refine Prompt to NanoBanana Style 13th Jan 2026",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create a Notion File Upload object1": {
        "main": [
          [
            {
              "node": "Generate Image Nano Banana HTTP",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Image Prompts": {
        "main": [
          [
            {
              "node": "Limit",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out Parts": {
        "main": [
          [
            {
              "node": "Grab Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Grab Image": {
        "main": [
          [
            {
              "node": "Convert to File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Images Output DB ID": {
        "main": [
          [
            {
              "node": "Set Image Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Images": {
        "main": [
          [
            {
              "node": "Set Notion Success2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set Notion API Error2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File": {
        "main": [
          [
            {
              "node": "Merge3",
              "type": "main",
              "index": 1
            },
            {
              "node": "Image Information",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload file contents1": {
        "main": [
          [
            {
              "node": "Set Subflow Fields4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge3": {
        "main": [
          [
            {
              "node": "Create Watermarked Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Watermarked Image": {
        "main": [
          [
            {
              "node": "Upload file contents1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Image Nano Banana HTTP": {
        "main": [
          [
            {
              "node": "Split Out Parts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Duplicate Prompts": {
        "main": [
          [
            {
              "node": "Split Out Duplicate Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out Duplicate Prompts": {
        "main": [
          [
            {
              "node": "Split Out Chat Modals",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get many database pages": {
        "main": [
          [
            {
              "node": "Download Watermark",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items1": {
        "main": [
          [],
          [
            {
              "node": "Edit Image1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "Update a database page",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate": {
        "main": [
          [
            {
              "node": "Code in JavaScript",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items2": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Image2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sort": {
        "main": [
          [
            {
              "node": "Limit1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Watermark1": {
        "main": [
          [
            {
              "node": "Loop Over Items2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent1": {
        "main": [
          [
            {
              "node": "Loop Over Items2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Download Watermark1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Image2": {
        "main": [
          [
            {
              "node": "AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limit1": {
        "main": [
          [
            {
              "node": "watermark image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript": {
        "main": [
          [
            {
              "node": "Sort",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "get overlay",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Image Information": {
        "main": [
          [
            {
              "node": "Crop Image(20%)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "get overlay": {
        "main": [
          [
            {
              "node": "Edit Image3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "all watermark image": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "watermark image": {
        "main": [
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Image3": {
        "main": [
          [
            {
              "node": "Edit Image4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Image4": {
        "main": [
          [
            {
              "node": "Edit Image5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Image5": {
        "main": [
          [
            {
              "node": "Merge3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update a database page": {
        "main": [
          [
            {
              "node": "Loop Over Items1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Agent",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Crop Image(20%)": {
        "main": [
          [
            {
              "node": "Crop Image Info",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Crop Image Info": {
        "main": [
          [
            {
              "node": "all watermark image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Image1": {
        "main": [
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields1": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‘Execute workflow’": {
        "main": [
          [
            {
              "node": "Get many database pages",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Watermark": {
        "main": [
          [
            {
              "node": "Loop Over Items1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model7": {
        "ai_languageModel": [
          [
            {
              "node": "Refine Prompt to NanoBanana Style2",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model9": {
        "ai_languageModel": [
          [
            {
              "node": "Refine Prompt to NanoBanana Style3",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Refine Prompt to NanoBanana Style 13th Jan 2026": {
        "main": [
          [
            {
              "node": "Create a Notion File Upload object1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Image Version Prompts": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Aggregate Image Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model2": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser3": {
        "ai_outputParser": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Image Prompt Generator",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "Refine Prompt to NanoBanana Style 13th Jan 2026",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Split Out Chat Modals": {
        "main": [
          [
            {
              "node": "Image Prompt Generator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Stephen Anindo",
    "name": "init google and sheets",
    "description": "",
    "autosaved": true
  },
  "activeVersionId": "0471a0e1-cecf-45eb-a0ec-16b0c9078fd0",
  "connections": {
    "Get Content With Block ID": {
      "main": [
        [
          {
            "node": "Get Parent DB ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Parent DB ID": {
      "main": [
        [
          {
            "node": "Get Images Output DB ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Input3": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Block Content": {
      "main": [
        [
          {
            "node": "Format Block Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Block Content": {
      "main": [
        [
          {
            "node": "Set Input3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Execute Workflow",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Image Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Initial Article": {
      "main": [
        [
          {
            "node": "Get Content With Block ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Subflow Fields4": {
      "main": [
        [
          {
            "node": "Add Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Initial Input": {
      "main": [
        [
          {
            "node": "Split Out Image Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Image Prompts": {
      "main": [
        [
          {
            "node": "Split Image Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Image Prompts": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Image Prompts": {
      "main": [
        [
          {
            "node": "Extract Image Version Prompts",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "Get Block Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Image Prompt Generator": {
      "main": [
        [
          {
            "node": "Set Final Image Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out Image Prompts": {
      "main": [
        [
          {
            "node": "Create Duplicate Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Final Image Prompts": {
      "main": [
        [
          {
            "node": "Refine Prompt to NanoBanana Style 13th Jan 2026",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a Notion File Upload object1": {
      "main": [
        [
          {
            "node": "Generate Image Nano Banana HTTP",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Image Prompts": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out Parts": {
      "main": [
        [
          {
            "node": "Grab Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Grab Image": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Images Output DB ID": {
      "main": [
        [
          {
            "node": "Set Image Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Images": {
      "main": [
        [
          {
            "node": "Set Notion Success2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Notion API Error2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 1
          },
          {
            "node": "Image Information",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload file contents1": {
      "main": [
        [
          {
            "node": "Set Subflow Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "Create Watermarked Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Watermarked Image": {
      "main": [
        [
          {
            "node": "Upload file contents1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Image Nano Banana HTTP": {
      "main": [
        [
          {
            "node": "Split Out Parts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Duplicate Prompts": {
      "main": [
        [
          {
            "node": "Split Out Duplicate Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out Duplicate Prompts": {
      "main": [
        [
          {
            "node": "Split Out Chat Modals",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many database pages": {
      "main": [
        [
          {
            "node": "Download Watermark",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "Edit Image1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Update a database page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Image2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort": {
      "main": [
        [
          {
            "node": "Limit1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Watermark1": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Download Watermark1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Image2": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit1": {
      "main": [
        [
          {
            "node": "watermark image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "get overlay",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Image Information": {
      "main": [
        [
          {
            "node": "Crop Image(20%)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get overlay": {
      "main": [
        [
          {
            "node": "Edit Image3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "all watermark image": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "watermark image": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Image3": {
      "main": [
        [
          {
            "node": "Edit Image4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Image4": {
      "main": [
        [
          {
            "node": "Edit Image5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Image5": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a database page": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Crop Image(20%)": {
      "main": [
        [
          {
            "node": "Crop Image Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crop Image Info": {
      "main": [
        [
          {
            "node": "all watermark image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Image1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Get many database pages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Watermark": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "Refine Prompt to NanoBanana Style2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model9": {
      "ai_languageModel": [
        [
          {
            "node": "Refine Prompt to NanoBanana Style3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Refine Prompt to NanoBanana Style 13th Jan 2026": {
      "main": [
        [
          {
            "node": "Create a Notion File Upload object1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Image Version Prompts": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Aggregate Image Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser3": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Image Prompt Generator",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Refine Prompt to NanoBanana Style 13th Jan 2026",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Split Out Chat Modals": {
      "main": [
        [
          {
            "node": "Image Prompt Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2026-01-28T09:10:22.088Z",
  "id": "94cQgMMaleQORL211aZxS",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "▶️ Image Generation",
  "nodes": [
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "get",
        "pageId": {
          "__rl": true,
          "value": "={{ $('Get Initial Article').first().json.body.data.id }}",
          "mode": "id"
        },
        "simple": false
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        -1232,
        80
      ],
      "id": "dcda912a-cd44-42fc-be26-6a10d8e65670",
      "name": "Get Content With Block ID",
      "executeOnce": true,
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "resource": "database",
        "databaseId": {
          "__rl": true,
          "value": "={{ $json.parent.database_id }}",
          "mode": "id"
        },
        "simple": false
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        -1008,
        80
      ],
      "id": "5336a02f-3f26-48c1-8153-97d27c2bcd9f",
      "name": "Get Parent DB ID",
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "090ef065-4cf7-4d81-9bfa-d87425fbe336",
              "name": "content",
              "value": "={{ $json.body }}",
              "type": "string"
            },
            {
              "id": "62cd50ef-4057-4161-878e-c628c8613a5f",
              "name": "prompt_update",
              "value": "={{ $json.prompt_update }}",
              "type": "string"
            },
            {
              "id": "ceb252e3-d45a-46da-92b0-44b447c3d6f7",
              "name": "system_message",
              "value": "={{ $json.system_message }}",
              "type": "string"
            },
            {
              "id": "19101d04-ac65-441d-9614-b46a2a3b733a",
              "name": "user_message",
              "value": "={{ $json.user_message }}",
              "type": "string"
            },
            {
              "id": "af188dd3-0756-4c57-a428-1da2034c50bc",
              "name": "title",
              "value": "={{ $json.title }}",
              "type": "string"
            },
            {
              "id": "5d2e98c0-3f5f-4d52-95dc-286b5a15d3b2",
              "name": "source",
              "value": "={{ $json.source }}",
              "type": "string"
            },
            {
              "id": "0ecb355c-1570-4af1-82d7-604cf108722d",
              "name": "platform",
              "value": "={{ $json.platform }}",
              "type": "string"
            },
            {
              "id": "8c449581-b194-41f1-b7d6-29764cc4c41f",
              "name": "initial_article",
              "value": "={{ $json.initial_article }}",
              "type": "string"
            },
            {
              "id": "b0a17ec1-0f75-40aa-8ce8-a3c0dec0e637",
              "name": "transformed_content_db_id",
              "value": "={{ $json.transformed_content_db_id }}",
              "type": "string"
            },
            {
              "id": "68f9bee7-e35a-44cc-9c48-d8e161f06fe5",
              "name": "image_dimensions",
              "value": "={{ $json.image_dimensions }}",
              "type": "string"
            },
            {
              "id": "3b9f19c8-e8ba-4078-9eb3-021cb5ee34af",
              "name": "image_system_message",
              "value": "={{ $json.image_system_message }}",
              "type": "string"
            },
            {
              "id": "a3aa45a9-6f74-4531-acf2-63e3b3a7d0b1",
              "name": "image_prompts",
              "value": "={{ $json.image_prompts }}",
              "type": "array"
            },
            {
              "id": "b9bf6d87-2969-4afc-95e6-e3c0e2a5c7fb",
              "name": "image_aspect_ratio",
              "value": "={{ $json.image_aspect_ratio }}",
              "type": "string"
            },
            {
              "id": "0b3d0085-a786-4eac-b5d4-9e5b9a8bdcdc",
              "name": "model",
              "value": "={{ $json.model }}",
              "type": "string"
            },
            {
              "id": "0c208a03-0464-4d35-bb22-e7684b33cdb6",
              "name": "temperature",
              "value": "={{ $json.temperature }}",
              "type": "string"
            },
            {
              "id": "6d5fcbf6-ce61-4970-aaab-f030ddb858a6",
              "name": "top_p",
              "value": "={{ $json.top_p }}",
              "type": "string"
            },
            {
              "id": "b04fb168-c9a0-4cc7-a7e9-c7cf8498de00",
              "name": "frequency_penalty",
              "value": "={{ $json.frequency_penalty }}",
              "type": "string"
            },
            {
              "id": "888277fe-ace9-4dd8-8125-a9400dff180e",
              "name": "presence_penalty",
              "value": "={{ $json.presence_penalty }}",
              "type": "string"
            },
            {
              "id": "37690778-bb29-4b6f-bd9d-3d1682f0fde5",
              "name": "max_tokens",
              "value": "={{ $json.max_tokens }}",
              "type": "string"
            },
            {
              "id": "51544bbd-36c4-4e4c-a543-c16cb6ae9cd5",
              "name": "num_variants",
              "value": "={{ $json.num_variants }}",
              "type": "string"
            },
            {
              "id": "c84db0b8-717d-45d4-bd04-91ae0d33dcf9",
              "name": "prompt_source",
              "value": "{{ $json.prompt_source }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1680,
        160
      ],
      "id": "f22d331b-1202-482a-bb34-5963ab7b8d54",
      "name": "Set Input3"
    },
    {
      "parameters": {
        "resource": "block",
        "operation": "getAll",
        "blockId": {
          "__rl": true,
          "value": "={{ $('Get Initial Article').first().json.body.data.id }}",
          "mode": "id"
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        1232,
        80
      ],
      "id": "0a2d06f0-449e-4606-9816-cd900ddd805a",
      "name": "Get Block Content",
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Initialize output variables\nlet bodyParts = [];\nlet images = [];\n\nfor (const item of $input.all()) {\n  const block = item.json;\n\n  if (block.type === 'paragraph') {\n    const content = block.content?.trim();\n    if (content) {\n      bodyParts.push(content);\n    }\n  }\n\n  if (block.type === 'image') {\n    const imageUrl = block.image?.external?.url;\n    if (imageUrl) {\n      images.push(imageUrl);\n    }\n  }\n}\n\nreturn [\n  {\n    json: {\n      body: bodyParts.join('\\n'),\n      images,\n      // initial_input: $('Set Initial Input').item.json.set_initial_input,\n      // system_message: $('Extract Content Type Prompt').item.json.property_system_message,\n      // user_message: $('Extract Content Type Prompt').item.json.property_guidelines,\n      prompt_update: $('Get Initial Article').first().json.body.data.properties[\"Update Prompt\"].rich_text[0] ? $('Get Initial Article').first().json.body.data.properties[\"Update Prompt\"].rich_text[0].plain_text : '',\n      title: `Content - ${$('Get Initial Article').first().json.body.data.properties.Concept.title[0].plain_text} - ${$('Aggregate Image Prompts').first().json.image_prompts[0].name} - Images`,\n      source: $('Get Initial Article').first().json.body.data.id,\n      prompt_source: `${$('Aggregate Image Prompts').first().json.image_prompts[0].name}`,\n      // platform: $('Extract Content Type Prompt').item.json.property_platform[0],\n      transformed_content_db_id: $('Get Images Output DB ID').first().json.id,\n      // image_dimensions: $('Extract Content Type Prompt').item.json.property_image_dimensions,\n      // image_system_message: $('Extract Content Type Prompt').item.json.property_image_system_message,\n      // initial_article: $('Get Initial Article').item.json.body.data.url,\n      image_prompts: $('Aggregate Image Prompts').first().json.image_prompts,\n      image_aspect_ratio: $('Extract Image Prompts').first().json.property_aspect_ratio,\n      num_variants: $('Get Initial Article').first().json.body.data.properties.Variants? $('Get Initial Article').first().json.body.data.properties.Variants.number : 1,\n      // \"model\": $('Extract Content Type Prompt').first().json.property_model,\n      // \"temperature\": $('Extract Content Type Prompt').first().json.property_temperature,\n      // \"top_p\": $('Extract Content Type Prompt').first().json.property_top_p,\n      // \"frequency_penalty\": $('Extract Content Type Prompt').first().json.property_frequency_penalty,\n      // \"presence_penalty\": $('Extract Content Type Prompt').first().json.property_presence_penalty,\n      // \"max_tokens\": $('Extract Content Type Prompt').first().json.property_max_tokens\n    },\n  },\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1456,
        80
      ],
      "id": "50ad8db7-4333-4916-b032-4c9e3255ace4",
      "name": "Format Block Content",
      "retryOnFail": false
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -112,
        80
      ],
      "id": "85eb522f-96a8-4e01-af83-5029a5cb86a7",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "image-generation",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1456,
        80
      ],
      "id": "b7d0434e-4435-4696-8092-fb45ec46e500",
      "name": "Get Initial Article",
      "webhookId": "c1f6e721-721d-4ecd-98bc-9dc5a9b847ff"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Initial Input').item.json.source }}",
          "__regex": "^([0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12})"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Status|status",
              "statusValue": "Error"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        6256,
        800
      ],
      "id": "fc84f5e1-3200-442d-b5e4-1fccf34e772b",
      "name": "Set Notion API Error2",
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "value": "={{ $('Initial Input').item.json.source }}",
          "mode": "id"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Status|status",
              "statusValue": "Done"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        6256,
        608
      ],
      "id": "3a7f3369-fb60-41cf-8a88-2b565ef90520",
      "name": "Set Notion Success2",
      "executeOnce": true,
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f6abe9ac-2a7d-4ead-8b3f-93d8aef7fb54",
              "name": "transformed_content_db_id",
              "value": "={{ $('Initial Input').first().json.transformed_content_db_id }}",
              "type": "string"
            },
            {
              "id": "f5a756d3-d95b-4941-99db-7abd73995af5",
              "name": "title",
              "value": "={{ $('Initial Input').first().json.image_prompts[0].name }}",
              "type": "string"
            },
            {
              "id": "b336bc2e-a12e-4936-bebf-ad274495a048",
              "name": "source_database_page",
              "value": "={{ $('Initial Input').first().json.source }}",
              "type": "string"
            },
            {
              "id": "a938dfe9-0069-4a97-82f2-2d22f6606cb6",
              "name": "platform",
              "value": "={{ $('Initial Input').first().json.platform }}",
              "type": "string"
            },
            {
              "id": "bcae6010-8182-40a7-94aa-ac436d2e10b3",
              "name": "images",
              "value": "={{ $json }}",
              "type": "string"
            },
            {
              "id": "ad97a256-fb62-45ef-82d3-dc88a804b2d7",
              "name": "content",
              "value": "={{ $('Initial Input').item.json.content }}",
              "type": "string"
            },
            {
              "id": "a16bb9ae-5755-462e-9764-1d2fa5a006ff",
              "name": "property_aspect_ratio",
              "value": "={{ $('Split Out Duplicate Prompts').first().json.property_aspect_ratio }}",
              "type": "string"
            },
            {
              "id": "832b87dd-1292-4fbd-9ae3-c2b0417c7aa6",
              "name": "chat_model",
              "value": "={{ $('Split Out Chat Modals').all()[$itemIndex].json.property_model }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5808,
        704
      ],
      "id": "6a23c2ce-c4b6-4021-ada2-7841ae40ca2a",
      "name": "Set Subflow Fields4"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -2016,
        784
      ],
      "id": "aa40c5bb-b456-44cf-bad4-e41b700de8f4",
      "name": "Initial Input"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "074bc9ef-54df-4dd5-a617-259349c4a425",
              "name": "set_image_prompts",
              "value": "={{ $('Get Initial Article').first().json.body.data.properties['Image Prompt Template'].relation }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -560,
        80
      ],
      "id": "b0351679-3fd0-4bcc-a0fa-40df9686d468",
      "name": "Set Image Prompts"
    },
    {
      "parameters": {
        "fieldToSplitOut": "set_image_prompts",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -336,
        80
      ],
      "id": "bbe892ab-7d5d-4f1d-abf6-1907c66b0ebe",
      "name": "Split Image Prompts"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "get",
        "pageId": {
          "__rl": true,
          "value": "={{ $('Split Image Prompts').item.json.id }}",
          "mode": "id"
        }
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        112,
        80
      ],
      "id": "9ba8c856-f073-4688-863b-45c9e4c5b8fe",
      "name": "Extract Image Prompts",
      "executeOnce": false,
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "maxItems": 100
      },
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        1008,
        80
      ],
      "id": "d1d7a11a-8aea-4975-af0a-414afe7218df",
      "name": "Limit"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1",
          "mode": "list",
          "cachedResultName": "gpt-5.1"
        },
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -864,
        1200
      ],
      "id": "98a1618e-031c-4c8e-853c-6f595232ee76",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "NoEKitspBJb0zQrp",
          "name": "Syntech GM OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Initial Post:\n{{ $('Initial Input').item.json.content }}\n\n{{ \n$if($('Initial Input').item.json.prompt_update, \n`\nUser provided prompt guidlines:\n${$('Initial Input').item.json.prompt_update}`, '')\n}}",
        "messages": {
          "messageValues": [
            {
              "message": "={{ $json.property_system_prompt }}\n\n{{ $json.property_system_message }}"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -848,
        784
      ],
      "id": "01ad1517-b855-458f-8ba2-b03328be9c21",
      "name": "Image Prompt Generator",
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "fieldToSplitOut": "image_prompts",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -1792,
        784
      ],
      "id": "1f77e593-1034-44e2-a26a-b72cad5a7771",
      "name": "Split Out Image Prompts"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "af522a61-b899-4c7e-b6e4-1f45e70f677c",
              "name": "prompt",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -496,
        784
      ],
      "id": "67fb9e3c-64b5-4ff8-a941-3a0031ef5783",
      "name": "Set Final Image Prompts"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.notion.com/v1/file_uploads",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Notion-Version",
              "value": "2022-06-28"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "filename",
              "value": "={{ $('Split Out Chat Modals').item.json.name.split(' ').join('-').toLowerCase() + '-' + $('Initial Input').item.json.source }}"
            },
            {
              "name": "content_type",
              "value": "=image/jpeg"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        80,
        784
      ],
      "id": "19d7b8bd-4bb8-43e0-a401-0ed8b67ffd6d",
      "name": "Create a Notion File Upload object1",
      "alwaysOutputData": false,
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "image_prompts",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        784,
        80
      ],
      "id": "8643f501-408e-48e5-8a61-7b854fb60a03",
      "name": "Aggregate Image Prompts"
    },
    {
      "parameters": {
        "fieldToSplitOut": "candidates[0].content.parts",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        528,
        784
      ],
      "id": "6844b2e6-24aa-490a-989b-b944a6b1431c",
      "name": "Split Out Parts"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6f57c194-a475-4c13-bb0d-1ba4f29c704b",
              "leftValue": "={{ $json.inlineData.mimeType }}",
              "rightValue": "image",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        704,
        784
      ],
      "id": "7faa2eab-1e0b-4d96-b080-a7067bfe6358",
      "name": "Grab Image"
    },
    {
      "parameters": {
        "resource": "database",
        "databaseId": {
          "__rl": true,
          "value": "={{ $json.properties[\"Images Output\"].relation.database_id }}",
          "mode": "id"
        },
        "simple": false
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        -784,
        80
      ],
      "id": "e9d7c1ff-410b-460b-9360-4c709cfc38ac",
      "name": "Get Images Output DB ID",
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "mode": "id",
          "value": "=QzfCHtJv0xZPYotB"
        },
        "mode": "each",
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.1,
      "position": [
        6032,
        704
      ],
      "id": "b190bd77-9c11-4c52-bf4d-2edbbb205a41",
      "name": "Add Images",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "inlineData.data",
        "options": {
          "mimeType": "image/jpeg"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        880,
        784
      ],
      "id": "b02160ff-5a81-4721-8dc9-4b7eaba3ac28",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Create a Notion File Upload object1').all()[$itemIndex].json.upload_url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Notion-Version",
              "value": "2022-06-28"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "=data"
            },
            {
              "name": "content_type",
              "value": "={{ $binary.data.mimeType }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5584,
        704
      ],
      "id": "e04cb0df-2d13-42ab-8c57-d3875cac0c01",
      "name": "Upload file contents1",
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "=U71UHBUD7DfPXOiO",
          "mode": "id",
          "cachedResultUrl": "/workflow/=U71UHBUD7DfPXOiO"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        112,
        -112
      ],
      "id": "35958886-786e-4ec2-a128-3faf2dae1275",
      "name": "Execute Workflow"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1",
          "mode": "list",
          "cachedResultName": "gpt-5.1"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        0,
        1024
      ],
      "id": "9663cf11-3eac-4468-8d5f-577e01ef459b",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "NoEKitspBJb0zQrp",
          "name": "Syntech GM OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        5216,
        880
      ],
      "id": "912e5a76-8def-4633-8bbc-cc9084fc0707",
      "name": "Merge3"
    },
    {
      "parameters": {
        "operation": "composite",
        "dataPropertyNameComposite": "overlay",
        "options": {
          "fileName": "result",
          "format": "jpeg"
        }
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        5360,
        704
      ],
      "id": "04e9e207-3a22-4112-b634-33d79e1b4b91",
      "name": "Create Watermarked Image"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-image-preview:generateContent",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googlePalmApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [{\n    \"parts\": [\n      {\"text\": {{ $('Refine Prompt to NanoBanana Style 13th Jan 2026').item.json.text.toJsonString() }}},\n      {\"inline_data\": {\"mime_type\":\"image/png\", \"data\": \"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\"}}\n    ]\n  }],\n  \"generationConfig\": {\n    \"imageConfig\": {\n      \"aspectRatio\": \"{{ $('Initial Input').item.json.image_aspect_ratio || '16:9' }}\"  \n    }\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        304,
        784
      ],
      "id": "cf255964-9b2b-4c4c-939b-44f7b2e1eaef",
      "name": "Generate Image Nano Banana HTTP",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "googlePalmApi": {
          "id": "bpjfJQDu5gNEKIgK",
          "name": "Syntech GM Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "function duplicateObject(obj, count) {\n  const n = Number(count) || 1;\n  return Array.from({ length: n }, () => ({ ...obj }));\n}\n\nconst incomingPrompt = $json;\nconst numberOfVariants = $('Initial Input').first().json.num_variants || 1;\n\nconsole.log(\"incomingPrompt: \",incomingPrompt)\n\nconst output = duplicateObject(incomingPrompt, numberOfVariants);\n\nreturn {output}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1568,
        784
      ],
      "id": "29dbc701-fa73-4f2d-80db-6d28866b86dd",
      "name": "Create Duplicate Prompts"
    },
    {
      "parameters": {
        "fieldToSplitOut": "output",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -1344,
        784
      ],
      "id": "e65076ea-4e69-497f-9e91-07d8b9fd727a",
      "name": "Split Out Duplicate Prompts"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "2c8785c0-cfab-8179-8e11-f736b46e550b",
          "mode": "list",
          "cachedResultName": "SOCIAL: watermark",
          "cachedResultUrl": "https://www.notion.so/2c8785c0cfab81798e11f736b46e550b"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        -2032,
        2848
      ],
      "id": "39d0a0b4-31b2-4de9-9a6a-fcaa3a78abbb",
      "name": "Get many database pages",
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=image link: {{ $('Get many database pages').item.json.property_image }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=You are a Senior Brand Designer analyzing watermark images and an aspect ratio converter for automated classification.\n\nConvert the decimal aspect ratio value to its closest standard simplified ratio format.\nINPUT: {{ $json.aspect_ratio_decimal }}\n\nSTANDARD RATIOS (in order):\n- 1:1 (1.00)\n- 2:3 (0.67)\n- 3:2 (1.50)\n- 3:4 (0.75)\n- 4:3 (1.33)\n- 4:5 (0.80)\n- 5:4 (1.25)\n- 9:16 (0.56)\n- 16:9 (1.78)\n- 21:9 (2.33)\n\nINSTRUCTIONS:\n1. Take the input decimal aspect ratio\n2. Compare it against all standard ratios above\n3. Find the closest match by calculating the smallest difference\n4. Return ONLY the simplified ratio in format \"X:Y\"\n\nAspect_Ratio: Return only the ratio string, nothing else. No explanations, no additional text.\n\nEXAMPLES:\n- Input: 1.78 → Output: 16:9\n- Input: 1.00 → Output: 1:1\n- Input: 0.67 → Output: 2:3\n- Input: 1.77 → Output: 16:9\n- Input: 1.34 → Output: 4:3\n- Input: 0.56 → Output: 9:16\n\nExample-1:\n{\n  \"aspectRatioDecimal\": \"1.00\",\n  \"aspectRatioSimplified\": \"1:1\",\n}\n\nExample-2: \n{\n  \"aspectRatio\": 1.7777777777777777,\n  \"aspectRatioDecimal\": \"1.78\",\n  \"aspectRatioSimplified\": \"16:9\",\n}\n\n\n**ORIENTATION:** Landscape | Portrait | Square | Wide | Vertical\nwidth: {{ $('Edit Image1').item.json.size.width }}\nheight: {{ $('Edit Image1').item.json.size.height }}\n**DIMENSIONS:** (width x height) (e.g., 832*1248)\n**DOMINANT_COLOR:** White | Black | Blue | Red | Green | Yellow | Orange | Purple | Multicolor\n**LUMINANCE:** High | Medium | Low\n**PLACEMENT_TYPE:** Corner Stamp | Full-Width Edge Band | Center Overlay\n**BACKGROUND_REQUIREMENT:** DARK | LIGHT | ANY\n**USE_CASE:** High-contrast branding | Subtle copyright protection | Social media attribution | Professional portfolio marking\n\n**FILENAME FORMAT:** sb_[DIMENSIONS]_[color]_[Aspect_Ratio]\n- Use \"multicolor\" in filename if watermark contains multiple colors\n- Use specific color name if single dominant color\n- Example: sb_1920x1080_white_16:9 OR sb_1920x1080_multicolor_16:9\n\n**DESCRIPTION FORMAT:** \nGenerate a precise, decision-grade description that clearly communicates visual strength, contrast behavior, placement impact, and suitability for different background types, enabling reliable automated selection of the best watermark for overlay.\nFormat:\n\"[Orientation] [Aspect_Ratio] watermark with [ACTUAL VISIBLE COLORS], featuring [Visual_Weight] visibility and [Edge_Clarity] edges, designed as [Placement_Type]. Optimized for [Background_Requirement] backgrounds, it delivers [Use_Case] while minimizing [Occlusion_Risk] over primary image content.\"\n\n\nADDITIONAL RULES FOR HIGH-QUALITY DESCRIPTIONS\nACTUAL VISIBLE COLORS\nExplicitly list all colors visible to the eye\nExamples:\n“solid white”\n“black and yellow”\n“gradient blue to purple”\n“red, white, and green”\nNever infer colors from filenames or metadata alone.\nVisual_Weight (MANDATORY – choose one)\nHigh-impact → Bold, thick, highly visible\nModerate → Balanced visibility without dominance\nLow-profile → Thin, subtle, minimally intrusive\nEdge_Clarity (MANDATORY – choose one)\nSharp-edged → Hard outlines, crisp text/logos\nSoft-edged → Blended, semi-transparent, feathered\nMixed-edge → Combination of sharp logo + soft fill\nOcclusion_Risk (MANDATORY – choose one)\nminimal obstruction\nmoderate obstruction\nhigh obstruction\nBackground Optimization Logic\nDARK → watermark remains legible on dark imagery\nLIGHT → watermark remains legible on light imagery\nANY → adaptive contrast or neutral transparency\nNO marketing fluff\nAvoid vague words like “beautiful”, “premium”, “nice”\nEvery phrase must support automated decision-making\n\nExample:\nWide 21:9 watermark with solid white coloring, featuring high-impact visibility and sharp-edged outlines, designed as a Center Overlay. Optimized for DARK backgrounds, it delivers high-contrast branding while maintaining moderate obstruction over focal image areas."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -720,
        2896
      ],
      "id": "c768e6ab-f02f-4e01-99a7-88bf6bb83801",
      "name": "AI Agent",
      "disabled": true
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1",
          "mode": "list",
          "cachedResultName": "gpt-5.1"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -704,
        3152
      ],
      "id": "93cbc466-5add-4ce9-8d75-c897f0afcb83",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "NoEKitspBJb0zQrp",
          "name": "Syntech GM OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1424,
        2896
      ],
      "id": "a0f1fd6d-32a1-4062-83ad-7d846bc8daae",
      "name": "Loop Over Items1",
      "disabled": true
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "output"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2608,
        624
      ],
      "id": "141f78f9-4608-4d72-84aa-7afc2767ed2a",
      "name": "Aggregate"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        3360,
        592
      ],
      "id": "646c4015-2617-450b-962a-98ac27f7c2e8",
      "name": "Limit1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2384,
        1024
      ],
      "id": "2cee50c0-0f93-49c4-b1e1-247aac7b143e",
      "name": "Loop Over Items2"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "score",
              "order": "descending"
            }
          ]
        },
        "options": {
          "disableDotNotation": false
        }
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        3088,
        608
      ],
      "id": "1427ff1f-15ef-46e6-a40d-34ec691afd76",
      "name": "Sort"
    },
    {
      "parameters": {
        "url": "={{ $json.property_image[0] }}",
        "responseFormat": "file",
        "dataPropertyName": "watermark_binary",
        "options": {},
        "headerParametersUi": {
          "parameter": [
            {
              "name": "Name",
              "value": "={{ $json.name }}"
            }
          ]
        }
      },
      "id": "5827a19d-4f9e-44f3-99ca-22cacf648e9f",
      "name": "Download Watermark1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        2160,
        1024
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=// Get the current watermark data (from the loop)\nWatermark Data: {{ JSON.stringify($('Edit Image2').item.json) }}\nWatermark_name: {{ $('Download Watermark1').item.json.name }}\nWatermark Image Description:\n{{ $('all watermark image').item.json.property_description }}\n\n// Get the specific original image (if you want just the first one\nCrop Image Data: \n{{ JSON.stringify($('Crop Image Info').first().json) }}\n\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=ROLE\nYou are an expert Image & Graphic Design Automation Agent.\n\nYour task is to select the SINGLE BEST watermark image from the provided list to overlay on the given Crop Image.\nYou must make the decision deterministically, prioritizing MAXIMUM VISUAL CONTRAST.\n\n--------------------------------\nINPUT DATA YOU WILL RECEIVE\n--------------------------------\n1. Crop Image\nChannel Statistics:\nGray: Minimum, Maximum, Mean, Standard Deviation\nOpacity: Minimum, Maximum, Mean, Standard Deviation\n\n2. Watermark Images (Array)\nEach watermark includes:\n- watermark_name\n- Channel Statistics:\n  - Gray: Minimum, Maximum, Mean, Standard Deviation\n  - Opacity: Minimum, Maximum, Mean, Standard Deviation\n\n3. Watermark Image Description (text)\nEach watermark has description like:\n\"Square 1:1 white watermark designed as Center Overlay, optimized for DARK backgrounds to provide High-contrast branding.\"\n\n--------------------------------\nPREPROCESSING & EDGE-CASE HANDLING (MANDATORY)\n--------------------------------\n\n**Missing or Invalid Statistics**\nIf any required channel statistic is missing, NaN, infinite, or zero-divided:\n→ score = 0, exclude from ranking.\n\n**Extreme Opacity Values**\n- Opacity Mean > 0.95 → Penalize heavily\n- Opacity Mean < 0.05 → score = 0 (invisible)\n\n**Tie-Breaking**\nIf multiple watermarks have identical scores:\n→ Choose watermark with Gray Mean furthest from crop Gray Mean\n→ If still tied, choose lower Opacity Mean\n\n--------------------------------\nPRIMARY SELECTION CRITERIA\n--------------------------------\n\n**STEP 1: BACKGROUND BRIGHTNESS CLASSIFICATION (ABSOLUTE PRIORITY)**\n\nDetermine the Crop Image background type using Gray Mean:\n```\nIF Gray Mean < 0.5:\n    Background Type = DARK\n    Required Watermark = WHITE/LIGHT (Gray Mean MUST be ≥ 0.65)\n    \nELSE IF Gray Mean ≥ 0.5:\n    Background Type = LIGHT  \n    Required Watermark = DARK/BLACK (Gray Mean MUST be ≤ 0.35)\n```\n\n**CRITICAL ENFORCEMENT RULE:**\n```\nFOR DARK BACKGROUNDS (Gray Mean < 0.5):\n    - REJECT ALL watermarks where Gray Mean < 0.65\n    - ONLY consider watermarks where Gray Mean ≥ 0.65\n    - The BRIGHTER the watermark, the BETTER the score\n    \nFOR LIGHT BACKGROUNDS (Gray Mean ≥ 0.5):\n    - REJECT ALL watermarks where Gray Mean > 0.35\n    - ONLY consider watermarks where Gray Mean ≤ 0.35\n    - The DARKER the watermark, the BETTER the score\n```\n\n**AUTO-REJECTION CONDITIONS (score = 0):**\n1. Watermark Gray Mean is on the SAME SIDE as background (both dark OR both light)\n2. Gray Mean difference < 0.3 (insufficient contrast)\n3. Watermark description contradicts the background type\n\n---\n\n**STEP 2: WATERMARK DESCRIPTION VALIDATION (OVERRIDE POWER)**\n\nIf watermark description exists:\n\n**For DARK backgrounds (Gray Mean < 0.5):**\n- Description contains \"white\" OR \"light\" OR \"DARK backgrounds\" → +40 bonus\n- Description contains \"black\" OR \"dark\" OR \"LIGHT backgrounds\" → score = 0 (reject)\n\n**For LIGHT backgrounds (Gray Mean ≥ 0.5):**\n- Description contains \"black\" OR \"dark\" OR \"LIGHT backgrounds\" → +40 bonus  \n- Description contains \"white\" OR \"light\" OR \"DARK backgrounds\" → score = 0 (reject)\n\n---\n\n**STEP 3: CONTRAST MAXIMIZATION (CORE SCORING)**\n\nAfter filtering by background type, score remaining watermarks:\n\n**Contrast Score (0-60 points):**\n```\nGray_Difference = |Crop Gray Mean - Watermark Gray Mean|\n\nIF Gray_Difference ≥ 0.5: +60\nELSE IF Gray_Difference ≥ 0.4: +45\nELSE IF Gray_Difference ≥ 0.3: +30\nELSE: score = 0 (insufficient contrast)\n```\n\n**Brightness Extremity Bonus (0-30 points):**\n\nFor DARK backgrounds:\n```\nIF Watermark Gray Mean ≥ 0.9: +30 (pure white - ideal)\nELSE IF Watermark Gray Mean ≥ 0.8: +20\nELSE IF Watermark Gray Mean ≥ 0.7: +10\nELSE: +0\n```\n\nFor LIGHT backgrounds:\n```\nIF Watermark Gray Mean ≤ 0.1: +30 (pure black - ideal)\nELSE IF Watermark Gray Mean ≤ 0.2: +20\nELSE IF Watermark Gray Mean ≤ 0.3: +10\nELSE: +0\n```\n\n**Opacity Balance (0-10 points):**\n```\nIF 0.4 ≤ Opacity Mean ≤ 0.7: +10\nELSE IF 0.3 ≤ Opacity Mean < 0.4 OR 0.7 < Opacity Mean ≤ 0.8: +5\nELSE: -10\n```\n\n---\n\n**STEP 4: FINAL SCORE CALCULATION**\n```\nBase Score = 0\n\nIF watermark passes background type filter:\n    Score += Contrast Score (0-60)\n    Score += Brightness Extremity Bonus (0-30)\n    Score += Description Match Bonus (0-40)\n    Score += Opacity Balance (0-10)\nELSE:\n    Score = 0 (reject)\n\nMaximum Possible Score = 140 (normalized to 0-100 in output)\n```\n\n--------------------------------\nDECISION LOGIC (DETERMINISTIC)\n--------------------------------\n\n1. **Filter Phase:**\n   - Classify background (DARK if Gray Mean < 0.5, else LIGHT)\n   - REJECT all watermarks that don't meet Gray Mean threshold\n   - REJECT watermarks with contradicting descriptions\n\n2. **Scoring Phase:**\n   - Calculate scores for remaining watermarks\n   - Prioritize MAXIMUM contrast (Gray Mean difference)\n   - Bonus for extreme brightness values (white for dark BG, black for light BG)\n\n3. **Selection Phase:**\n   - Choose watermark with HIGHEST score\n   - If tied, choose watermark with Gray Mean furthest from background\n\n4. **Output:**\n   - Return ONLY the single best watermark\n   - No randomness, no subjective decisions\n\n--------------------------------\nEXAMPLES FOR VALIDATION\n--------------------------------\n\n**Example 1: Dark Industrial/Road Background**\n```\nCrop Image: Gray Mean = 0.20 (DARK)\n\nWatermark A: Gray Mean = 0.85 (white), Description: \"white watermark for DARK backgrounds\"\n→ Score = 60 (contrast) + 20 (brightness) + 40 (description) + 10 (opacity) = 130/140\n\nWatermark B: Gray Mean = 0.15 (black), Description: \"black watermark\"  \n→ Score = 0 (REJECTED - same side as background)\n\nSELECTED: Watermark A ✓\n```\n\n**Example 2: Light Background**\n```\nCrop Image: Gray Mean = 0.75 (LIGHT)\n\nWatermark A: Gray Mean = 0.10 (black), Description: \"dark watermark for LIGHT backgrounds\"\n→ Score = 60 (contrast) + 30 (brightness) + 40 (description) + 10 (opacity) = 140/140\n\nWatermark B: Gray Mean = 0.80 (white)\n→ Score = 0 (REJECTED - same side as background)\n\nSELECTED: Watermark A ✓\n```\n\n--------------------------------\nOUTPUT FORMAT (STRICT)\n--------------------------------\n\nReturn ONLY valid JSON:\n```json\n{\n  \"score\": <0-100>,\n  \"watermark_name\": \"<exact watermark filename>\"\n}\n```\n\n**Rules:**\n- Do NOT add explanations\n- Do NOT add extra fields  \n- Do NOT add text outside JSON\n- Output must be parseable JSON only"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        3088,
        1088
      ],
      "id": "2a634b3e-82b6-4cf7-997d-5203c708c75f",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1",
          "mode": "list",
          "cachedResultName": "gpt-5.1"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        3024,
        1328
      ],
      "id": "342cc9b4-268c-4d69-89c9-8ac1ec1dbdfa",
      "name": "OpenAI Chat Model6",
      "credentials": {
        "openAiApi": {
          "id": "NoEKitspBJb0zQrp",
          "name": "Syntech GM OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "62593842-213a-44d2-b801-5ef19fc25808",
              "name": "property_image[0]",
              "value": "={{ $json.property_image[0] }}",
              "type": "string"
            },
            {
              "id": "55739784-930a-49bb-874e-e51c148ae6ad",
              "name": "name",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1936,
        1024
      ],
      "id": "ef1b7755-192e-4cad-9488-9b85192bd5f7",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "information",
        "dataPropertyName": "watermark_binary"
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        2608,
        1024
      ],
      "id": "7c083777-512d-4c95-a37e-eef5f888c6d4",
      "name": "Edit Image2"
    },
    {
      "parameters": {
        "jsCode": "// Get array of objects directly\nconst items = $input.first().json.output;\n\n// Normalize scores to numbers\nconst parsed = items.map(item => ({\n  score: Number(item.score),\n  watermark_name: item.watermark_name\n}));\n\n// Sort by score DESC (highest first)\nparsed.sort((a, b) => b.score - a.score);\n\n// Return each item as separate output\nreturn parsed.map(p => ({\n  json: {\n    score: p.score,\n    watermark_name: p.watermark_name\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2880,
        608
      ],
      "id": "6356477f-28c7-4c64-a405-31fd88184a05",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "jsCode": "// ✅ Get ALL items from Edit Image1 (even if not connected)\nconst editImageItems = $items(\"Image Information\");\n\n// ✅ Get watermark image URL from Notion\nconst imageUrl =\n  $items(\"watermark image\")[0].json.property_image[0];\n\n// Safety check\nif (!imageUrl) {\n  throw new Error(\"No image URL found\");\n}\n\n// ✅ Create output matching Edit Image count\nconst output = editImageItems.map((item, index) => ({\n  json: {\n    image_no: index + 1,\n    image_url: imageUrl,\n    image_info: item.json\n  }\n}));\n\nreturn output;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3776,
        576
      ],
      "id": "35c101d1-f6c7-4aca-a070-cab73ba947e3",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "operation": "information"
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        1008,
        1056
      ],
      "id": "6f9f1593-4c50-419e-b22a-4c84f4697159",
      "name": "Image Information"
    },
    {
      "parameters": {
        "url": "={{ $json.image_url }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file",
              "outputPropertyName": "overlay"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        3968,
        528
      ],
      "id": "dd00a320-665b-4954-aa87-c24051ea6ad1",
      "name": "get overlay"
    },
    {
      "parameters": {
        "content": "### Select Dynamic overlay",
        "height": 1168,
        "width": 3600
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1376,
        400
      ],
      "typeVersion": 1,
      "id": "cfb10483-9869-4fc0-a229-db06662cebbe",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "2c8785c0-cfab-8179-8e11-f736b46e550b",
          "mode": "list",
          "cachedResultName": "watermark",
          "cachedResultUrl": "https://www.notion.so/2c8785c0cfab81798e11f736b46e550b"
        },
        "returnAll": true,
        "filterType": "manual",
        "filters": {
          "conditions": [
            {
              "key": "Aspect Ratio|rich_text",
              "condition": "equals",
              "richTextValue": "={{ $('Split Out Chat Modals').item.json.property_aspect_ratio }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        1712,
        1024
      ],
      "id": "fe8e23b3-1a9b-4013-b608-ea2501c56bac",
      "name": "all watermark image",
      "executeOnce": true,
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "2c8785c0-cfab-8179-8e11-f736b46e550b",
          "mode": "list",
          "cachedResultName": "watermark",
          "cachedResultUrl": "https://www.notion.so/2c8785c0cfab81798e11f736b46e550b"
        },
        "filterType": "manual",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "key": "Watermark Name|title",
              "condition": "equals",
              "titleValue": "={{ $json.watermark_name }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        3584,
        576
      ],
      "id": "4e52d8da-c02b-4ec8-ae73-66d16f8ec140",
      "name": "watermark image",
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "operation": "information",
        "dataPropertyName": "overlay"
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        4176,
        528
      ],
      "id": "3a869fc4-8e90-4212-a0ec-219b335bc582",
      "name": "Edit Image3",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "resize",
        "dataPropertyName": "overlay",
        "width": "={{ $('Image Information').item.json.size.width }}",
        "height": "={{ $('Image Information').item.json.size.height }}",
        "resizeOption": "ignoreAspectRatio",
        "options": {}
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        4480,
        528
      ],
      "id": "96a3d9fe-c01d-48a5-ab1a-1219becdb96b",
      "name": "Edit Image4"
    },
    {
      "parameters": {
        "operation": "information",
        "dataPropertyName": "overlay"
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        4736,
        544
      ],
      "id": "9e398334-323a-4c89-a63f-28287d753bbd",
      "name": "Edit Image5"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "value": "={{ $('Loop Over Items1').item.json.id }}",
          "mode": "id"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "watermark_image_info|rich_text",
              "textContent": "={{ $json.output.filename }}"
            },
            {
              "key": "Description|rich_text",
              "textContent": "={{ $json.output.description }}"
            },
            {
              "key": "Aspect Ratio|rich_text",
              "textContent": "={{ $json.output.aspect_ratio }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        -160,
        2912
      ],
      "id": "5aa8a3ce-bafc-421b-b693-b29ce867e50c",
      "name": "Update a database page",
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"description\": \"[generated description]\",\n  \"filename\": \"[generated filename]\",\n  \"orientation\": \"[value]\",\n  \"aspect_ratio\": \"[value]\",\n  \"dimensions\": \"[value]\",\n  \"dominant_color\": \"[value]\",\n  \"luminance\": \"[value]\",\n  \"placement_type\": \"[value]\",\n  \"background_requirement\": \"[value]\",\n  \"use_case\": \"[value]\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -496,
        3152
      ],
      "id": "65413ec4-6033-4955-ae18-f7c3a4047a1b",
      "name": "Structured Output Parser",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "crop",
        "width": "={{ $json.size.width }}",
        "height": "={{ $json.size.height*0.2}}",
        "positionY": "={{ $json.size.height - $json.size.height*0.2}}",
        "options": {}
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        1200,
        1056
      ],
      "id": "bf8557ea-88b8-411a-b350-877401ddf655",
      "name": "Crop Image(20%)"
    },
    {
      "parameters": {
        "operation": "information"
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        1456,
        1024
      ],
      "id": "ea7e47b1-c7c0-4222-89c1-aba0c82172b5",
      "name": "Crop Image Info"
    },
    {
      "parameters": {
        "operation": "information",
        "dataPropertyName": "watermark_binary"
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        -1168,
        2912
      ],
      "id": "0894d7fd-e1fd-432a-8a9a-67db93557fe7",
      "name": "Edit Image1",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b38d40d3-83c2-43a8-8b21-28de0f702e2f",
              "name": "aspect_ratio_decimal",
              "value": "={{ $json.size.width/$json.size.height }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -960,
        2912
      ],
      "id": "2af3e1e6-3ffe-4c4a-9662-e7d3d5488b43",
      "name": "Edit Fields1",
      "disabled": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -2304,
        2832
      ],
      "id": "617ec988-640d-480e-a5e0-33f85af75dd4",
      "name": "When clicking ‘Execute workflow’",
      "disabled": true
    },
    {
      "parameters": {
        "url": "={{ $json.property_image[0] }}",
        "responseFormat": "file",
        "dataPropertyName": "watermark_binary",
        "options": {},
        "headerParametersUi": {
          "parameter": [
            {
              "name": "Name",
              "value": "={{ $json.name }}"
            }
          ]
        }
      },
      "id": "9fb115d3-bb83-49ac-b515-478bc974f453",
      "name": "Download Watermark",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        -1712,
        2864
      ],
      "disabled": true
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1",
          "mode": "list",
          "cachedResultName": "gpt-5.1"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -2064,
        1712
      ],
      "id": "72724ff8-2b86-48b1-b910-56c5dc8c0a8f",
      "name": "OpenAI Chat Model7",
      "credentials": {
        "openAiApi": {
          "id": "NoEKitspBJb0zQrp",
          "name": "Syntech GM OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "messages": {
          "messageValues": [
            {
              "message": "=You are Syntech's Stage-2 Image Execution Engine.\n\nYou receive:\n• ONE structured Stage-1 visual brief\n• An example-pack style universe (already selected)\n• Optional user guidelines\n\nYour job is to **faithfully execute** the Stage-1 brief into a final image prompt suitable for image generation.\n\nYou DO NOT reinterpret strategy.\nYou DO NOT invent concepts.\nYou DO NOT override the example universe.\n\nYour role is precise visual execution.\n\n------------------------------------------------------------\n# 🔒 EXECUTION HIERARCHY (STRICT)\n\n1. Stage-1 structured brief (highest authority)\n2. Example-pack universe\n3. Syntech brand foundations\n4. Optional user guidelines\n\nIf conflicts exist:\n• Resolve silently\n• Never explain decisions\n• Always protect visual quality and coherence\n\n------------------------------------------------------------\n# 🎨 CORE EXECUTION PRINCIPLES\n\n• Execute the **visual universe**, not the literal wording\n• Maintain stylistic consistency with the example pack\n• Preserve creative variation **within** the universe\n• Avoid visual repetition across outputs\n• Keep imagery relevant to sustainability, energy, systems, or progress — even when abstract\n\nDo NOT default to:\n• Trucks\n• Fuel pumps\n• Vehicles\n• Literal objects\n\nUnless the Stage-1 brief explicitly requires them  \nOR the example pack strongly supports them\n\n------------------------------------------------------------\n# 🖼️ IMAGE COMPOSITION RULES\n\n• Full-frame image — no poster cards, no white blocks\n• No artificial reserved space anywhere\n• No visual framing that implies logos or captions\n• The image must feel complete on its own\n\nBottom of image:\n• Do NOT place text\n• Do NOT place logos\n• Do NOT anchor focal objects there\n• It may contain subtle background, ground, gradient, or atmosphere\n\n------------------------------------------------------------\n# ✍️ TEXT HANDLING (VERY IMPORTANT)\n\nIf text is required by Stage-1:\n\nALLOWED:\n• Headline only\n• Headline + subheadline\n• Short phrases\n• Clean, minimal placement\n• Colours chosen for legibility (brand or universe-appropriate)\n\nFORBIDDEN:\n• Text shadows\n• Glow effects\n• Outlines\n• Describing what the text \"means\"\n• Describing fonts, weights, sizes, or typography metadata\n• Writing labels like \"Headline:\" or \"Subheadline:\"\n• Writing the word \"Syntech\", slogans, or logos\n\nText must appear natural, intentional, and designer-placed.\n\n------------------------------------------------------------\n# 🎨 COLOUR BEHAVIOUR\n\n• Do NOT lock colours strictly to brand palette\n• Use the example-pack universe as the primary guide\n• Brand colours should appear subtly or atmospherically\n• Increase vibrancy when the universe allows it\n• Remain calm, engineered, and intentional — never chaotic\n\n------------------------------------------------------------\n# 🧬 STYLE FIDELITY RULE\n\nIf the example pack is:\n• Iconography → create illustrative / symbolic forms\n• CGI → produce clean, high-fidelity renders\n• Photographic → realistic lighting and materials\n• Abstract → controlled abstraction with relevance\n\nNever mix universes.\nNever \"photo-realise\" an icon pack.\nNever \"illustrate\" a photographic pack.\n\n------------------------------------------------------------\n# 🚫 HARD PROHIBITIONS\n\nNever include:\n• Logos\n• Brand marks\n• Watermarks\n• Text shadows\n• Overlays\n• Poster frames\n• Cheap legibility tricks\n• Random objects not supported by the universe\n• Aesthetic drift outside the example pack\n\n------------------------------------------------------------\n# 🎯 FINAL OUTPUT REQUIREMENTS\n\nOutput ONE final image-generation prompt that is:\n\n• Visually diverse\n• Style-faithful to the example pack\n• Executed with senior-designer judgment\n• Relevant to Syntech Biofuel themes (directly or metaphorically)\n• Free of branding artefacts\n• Clean, confident, and intentional\n\nDo not explain.\nDo not justify.\nDo not add commentary.\n\nJust output the final prompt."
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -2128,
        1488
      ],
      "id": "6c5c68a3-8a97-4d88-946b-fab2e0edc60a",
      "name": "Refine Prompt to NanoBanana Style2",
      "disabled": true
    },
    {
      "parameters": {
        "content": "#DO not delete",
        "height": 1296,
        "width": 544
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2256,
        1280
      ],
      "id": "6ddf4b16-fd43-4bf8-8f0f-2aa7e44281fc",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1",
          "mode": "list",
          "cachedResultName": "gpt-5.1"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -2064,
        2144
      ],
      "id": "0d19212e-7262-4a87-9ad9-0a7c04847eba",
      "name": "OpenAI Chat Model9",
      "credentials": {
        "openAiApi": {
          "id": "NoEKitspBJb0zQrp",
          "name": "Syntech GM OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "messages": {
          "messageValues": [
            {
              "message": "=You are Syntech's Stage-2 Image Execution Engine.\n\nYou receive:\n• ONE structured Stage-1 visual brief  \n• An example-pack style universe (already selected)  \n• Optional user guidelines  \n\nYour job is to **faithfully execute** the Stage-1 brief into a final image prompt suitable for image generation.  \n\nYou DO NOT reinterpret strategy.  \nYou DO NOT invent concepts.  \nYou DO NOT override the example universe.  \n\nYour role is precise visual execution.\n\n---\n\n# 🔒 EXECUTION HIERARCHY (STRICT)\n\n1. Stage-1 structured brief (highest authority)  \n2. Example-pack universe  \n3. Syntech brand foundations  \n4. Optional user guidelines  \n\nIf conflicts exist:  \n• Resolve silently  \n• Never explain decisions  \n• Always protect visual quality and coherence  \n\n---\n\n# 🎨 CORE EXECUTION PRINCIPLES\n\n• Execute the **visual universe**, not the literal wording  \n• Maintain stylistic consistency with the example pack  \n• Preserve creative variation **within** the universe  \n• Avoid visual repetition across outputs  \n• Keep imagery relevant to sustainability, energy, systems, or progress — even when abstract  \n\nDo NOT default to:  \n• Trucks  \n• Fuel pumps  \n• Vehicles  \n• Literal objects  \nUnless the Stage-1 brief explicitly requires them  \nOR the example pack strongly supports them  \n\n---\n\n# 🖼️ IMAGE COMPOSITION RULES\n\n• Full-frame image — no poster cards, no white blocks  \n• No artificial reserved space anywhere  \n• No visual framing that implies logos or captions  \n• The image must feel complete on its own  \n\nBottom of image:  \n• Do NOT place text  \n• Do NOT place logos  \n• Do NOT anchor focal objects there  \n• It may contain subtle background, ground, gradient, or atmosphere  \n\n---\n\n# ✍️ TEXT HANDLING (VERY IMPORTANT)\n\nIf text is required by Stage-1:\n\nALLOWED:  \n• Headline only  \n• Headline + subheadline  \n• Short phrases  \n• Clean, minimal placement  \n• Colours chosen for legibility (brand or universe-appropriate)  \n\nFORBIDDEN:  \n• Text shadows  \n• Glow effects  \n• Outlines  \n• Describing what the text \"means\"  \n• Describing fonts, weights, sizes, or typography metadata  \n• Writing labels like \"Headline:\" or \"Subheadline:\"  \n• Writing the word \"Syntech\", slogans, or logos  \n\nText must appear natural, intentional, and designer-placed.\n\n---\n\n# 🎨 COLOUR EXECUTION LOGIC\n\n• Prioritise colour **impact**, legibility, and mood over neutrality  \n• You may increase vibrancy, colour contrast, or saturation when:  \n  - The Stage-1 brief supports it  \n  - The example universe allows flexibility  \n  - The image benefits emotionally or visually from enhanced colour  \n\n• Do NOT inject artificial or irrelevant colour  \n• All colour choices must feel **natural, intentional, and grounded in logic**  \n• Brand colours may appear subtly or atmospherically — but do not suppress them if their presence enhances clarity or tone  \n• When in doubt, **favour clarity and contrast over muted neutrality**  \n\nRemain engineered, confident, and clean — but not flat or washed out.\n\n---\n\n# 🧬 STYLE FIDELITY RULE\n\nIf the example pack is:  \n• Iconography → create illustrative / symbolic forms  \n• CGI → produce clean, high-fidelity renders  \n• Photographic → realistic lighting and materials  \n• Abstract → controlled abstraction with relevance  \n\nNever mix universes.  \nNever \"photo-realise\" an icon pack.  \nNever \"illustrate\" a photographic pack.  \n\n---\n\n# 🚫 HARD PROHIBITIONS\n\nNever include:  \n• Logos  \n• Brand marks  \n• Watermarks  \n• Text shadows  \n• Overlays  \n• Poster frames  \n• Cheap legibility tricks  \n• Random objects not supported by the universe  \n• Aesthetic drift outside the example pack  \n\n---\n\n# 🎯 FINAL OUTPUT REQUIREMENTS\n\nOutput ONE final image-generation prompt that is:  \n\n• Visually diverse  \n• Style-faithful to the example pack  \n• Executed with senior-designer judgment  \n• Relevant to Syntech Biofuel themes (directly or metaphorically)  \n• Free of branding artefacts  \n• Clean, confident, and intentional  \n• Allows **richer colour, contrast, and lighting** when contextually appropriate  \n\nDo not explain.  \nDo not justify.  \nDo not add commentary.  \n\nJust output the final prompt."
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -2128,
        1920
      ],
      "id": "570bc5bb-b90d-44df-b7eb-d0cf46a3d23e",
      "name": "Refine Prompt to NanoBanana Style3",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "messages": {
          "messageValues": [
            {
              "message": "=You are Syntech's Stage-2 Image Execution Engine.\n\nYou receive:\n• ONE structured Stage-1 visual brief  \n• An example-pack style universe (already selected)  \n• Optional user guidelines  \n\nYour job is to **faithfully execute** the Stage-1 brief into a final image prompt suitable for image generation.\n\nYou DO NOT reinterpret strategy.  \nYou DO NOT invent concepts.  \nYou DO NOT override the example universe.  \n\nYour role is precise visual execution.\n\n---\n\n# 🔒 EXECUTION HIERARCHY (STRICT)\n\n1. Stage-1 structured brief (highest authority)  \n2. Example-pack universe  \n3. Syntech brand foundations  \n4. Optional user guidelines  \n\nIf conflicts exist:  \n• Resolve silently  \n• Never explain decisions  \n• Always protect visual quality and coherence  \n\n---\n\n# 🎨 CORE EXECUTION PRINCIPLES\n\n• Execute the **visual universe**, not the literal wording  \n• Maintain stylistic consistency with the example pack  \n• Preserve creative variation **within** the universe  \n• Avoid visual repetition across outputs  \n• Keep imagery relevant to sustainability, energy, systems, or progress — even when abstract  \n\nDo NOT default to:  \n• Trucks  \n• Fuel pumps  \n• Vehicles  \nUnless the Stage-1 brief explicitly requires them  \nOR the example pack strongly supports them  \n\n---\n\n# 🖼️ IMAGE COMPOSITION RULES\n\n• Full-frame image — no poster cards, no white blocks  \n• No artificial reserved space anywhere  \n• No visual framing that implies logos or captions  \n• The image must feel complete on its own  \n\n## Bottom 20% Zone (Watermark Guidance)\n• The **bottom 20% of the image must remain visually clear** for a watermark overlay  \n• This does NOT mean leaving it blank, faded, bordered, or gradiented  \n• It must:\n  - Remain fully part of the image\n  - Contain **no essential content**\n  - Avoid contrast, text, or detail that would compete with a watermark\n• Do not generate any visual device (e.g. border, frame, bar, glow) to reserve the space\n\n---\n\n# ✍️ TEXT HANDLING (VERY IMPORTANT)\n\nIf text is required by Stage-1:\n\nALLOWED:  \n• Headline only  \n• Headline + subheadline  \n• Short phrases  \n• Clean, minimal placement  \n• Colours chosen for legibility (brand or universe-appropriate)  \n\nFORBIDDEN:  \n• Text shadows  \n• Glow effects  \n• Outlines  \n• Describing what the text \"means\"  \n• Describing fonts, weights, sizes, or typography metadata  \n• Writing labels like \"Headline:\" or \"Subheadline:\"  \n• Writing the word \"Syntech\", slogans, or logos  \n\n**Typography must always use Syntech’s brand family (Montserrat)**  \nText must appear natural, intentional, and designer-placed.\n\n---\n\n# 👤 HUMAN IMAGE RULES\n\nIf the image includes human subjects:\n\n• The image must feel like a **documentary photograph** taken by a commercial photographer inside a real, functioning facility  \n• No stylization, beauty filters, influencer lighting, or cinematic effects  \n• Humans must appear as **real working professionals**, not models  \n\nFaces must show:\n- Natural skin texture and imperfections  \n- Pores, uneven tone, shine, and subtle pigmentation  \n- Asymmetry, natural under-eye shadows, and real lip texture  \n\nBlack subjects must show:\n- Authentic melanin response in light/shadow  \n- Natural hairline, baby hairs, visible follicles  \n\nEyes must appear:\n- Moist with natural reflections  \n- Imperfect lashes and visible sclera details  \n\nClothing and PPE must:\n- Appear worn, creased, or slightly scuffed  \n- Include safety gear like high-vis jackets, hard hats, gloves, or goggles  \n- Show fabric texture and realistic folds — never costume-grade or fake clean  \n\nSubjects must be mid-task — **no posing or looking at the camera**  \n\nEnvironments must be industrially authentic:\n- Control rooms, turbine halls, refinery floors, substations, data rooms  \n- Include pipes, gauges, cables, control panels, machinery, or structural elements  \n\nLighting must reflect real-world conditions:\n- Overhead fluorescents, sodium vapor, LED glow, or ambient industrial lighting  \n- Realistic shadows and specular highlights — no surreal color grading  \n\nCamera logic must feel candid:\n- Eye-level or over-shoulder POV, shallow depth of field, slight lens falloff  \n- Natural motion blur if needed, never hyper-sharp digital look  \n\nIf it **feels like AI**, it fails.  \nThe image must pass as a **real industrial photo** in a Chevron, Shell, or Siemens report.\n\nDo not stylize.  \nDo not beautify.  \nDo not idealize.  \nOnly realism, context, and respect.\n\n---\n\n# 🏗️ INFRASTRUCTURE IMAGE RULES\n\n• **Prefer micro or detailed views** of infrastructure over wide macro shots  \n• Wide macro views are only acceptable if:\n  - The image pack explicitly supports them\n  - The scene does not resemble generic or third-party facilities  \n\n• Infrastructure must feel “owned,” not borrowed — abstract, close-up, schematic, or brand-aligned\n\n---\n\n# 🎨 COLOUR EXECUTION LOGIC\n\n• Prioritise colour **impact**, legibility, and mood over neutrality  \n• You may increase vibrancy, colour contrast, or saturation when:\n  - The Stage-1 brief supports it  \n  - The example universe allows flexibility  \n  - The image benefits emotionally or visually from enhanced colour  \n\n• Do NOT inject artificial or irrelevant colour  \n• All colour choices must feel **natural, intentional, and grounded in context**  \n• Brand colours may appear subtly or atmospherically — but do not suppress them if their presence enhances clarity or tone  \n• When in doubt, **favour clarity and contrast over muted neutrality**  \n\nRemain engineered, confident, and clean — but not flat or washed out.\n\n---\n\n# 🧬 STYLE FIDELITY RULE\n\nIf the example pack is:  \n• Iconography → create illustrative / symbolic forms  \n• CGI → produce clean, high-fidelity renders  \n• Photographic → realistic lighting and materials  \n• Abstract → controlled abstraction with relevance  \n\nNever mix universes.  \nNever \"photo-realise\" an icon pack.  \nNever \"illustrate\" a photographic pack.  \n\n---\n\n# 🚫 HARD PROHIBITIONS\n\nNever include:  \n• Logos  \n• Brand marks  \n• Watermarks  \n• Text shadows  \n• Overlays  \n• Poster frames  \n• Artificial borders or bottom bars  \n• Generated or placeholder Syntech logos  \n• Aesthetic drift outside the example pack  \n• Generic or irrelevant objects that do not connect to message, metaphor, or Syntech’s domain  \n\n---\n\n# 💡 SYMBOLIC + METAPHOR GUIDANCE\n\n• All visual elements must carry **intentional meaning**  \n• Avoid random object placement or meaningless scenery  \n• Images must express metaphor, relevance, or visual logic  \n• Expand creatively using Syntech’s core themes:\n  - Environmental responsibility  \n  - Fuel systems and transitions  \n  - Engineering-led sustainability  \n  - Ecological improvement  \n  - Energy infrastructure  \n  - Circular economy  \n\nDo not rely on literal fuel references unless clearly required.  \nUse metaphor and theme to deliver conceptual strength.\n\n---\n\n# 🎯 FINAL OUTPUT REQUIREMENTS\n\nOutput ONE final image-generation prompt that is:  \n\n• Visually diverse  \n• Style-faithful to the example pack  \n• Executed with senior-designer judgment  \n• Relevant to Syntech Biofuel themes (directly or metaphorically)  \n• Free of branding artefacts  \n• Clean, confident, and intentional  \n• Composed for watermark compatibility  \n• Incorporates richer colour, contrast, or natural imperfection where appropriate  \n• Never random — always grounded in meaning, metaphor, or domain logic  \n\n**If human subjects are present, apply full Human Realism Lock logic.**\n\nDo not explain.  \nDo not justify.  \nDo not add commentary.  \n\nJust output the final prompt."
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -272,
        784
      ],
      "id": "6fcf529f-aa71-421b-b9f3-64b5141e1fd8",
      "name": "Refine Prompt to NanoBanana Style 13th Jan 2026"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "get",
        "pageId": {
          "__rl": true,
          "value": "={{ $('Extract Image Prompts').item.json.property_version[0] }}",
          "mode": "id"
        }
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        336,
        16
      ],
      "id": "fe2dcb43-ac4e-473a-89c4-c88efd47c6be",
      "name": "Extract Image Version Prompts",
      "executeOnce": false,
      "credentials": {
        "notionApi": {
          "id": "k0ZwGrqySi9Wayf7",
          "name": "Stephen Notion account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        560,
        80
      ],
      "id": "b9e90ff5-ec22-4add-b075-02bc1aab8946",
      "name": "Merge"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -864,
        1024
      ],
      "id": "77718895-8f78-45cf-bc75-4a46189e178a",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "bpjfJQDu5gNEKIgK",
          "name": "Syntech GM Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        16,
        1216
      ],
      "id": "0c49a396-2719-4302-9469-7a40c07b3bc8",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "bpjfJQDu5gNEKIgK",
          "name": "Syntech GM Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3200,
        1328
      ],
      "id": "c63722f5-056d-4dba-9d85-a06c396da229",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "bpjfJQDu5gNEKIgK",
          "name": "Syntech GM Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"score\": \"<0-100>\",\n  \"watermark_name\": \"<exact watermark filename>\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3376,
        1328
      ],
      "id": "ed1e603e-a951-4027-8182-bbbbbd4f238c",
      "name": "Structured Output Parser3"
    },
    {
      "parameters": {
        "model": "={{ $('Split Out Chat Modals').item.json.property_model || 'google/gemini-2.5-pro' }}",
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -656,
        1008
      ],
      "id": "faa88138-93fa-48a4-bd97-e41ebcd6380e",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "kUkOiAL6PjmdfexG",
          "name": "Syntech GM OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "model": "={{ $('Split Out Chat Modals').item.json.property_model || 'google/gemini-2.5-pro' }}",
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -240,
        1008
      ],
      "id": "ee5cca37-542d-4063-a6b3-5a030689226e",
      "name": "OpenRouter Chat Model1",
      "credentials": {
        "openRouterApi": {
          "id": "kUkOiAL6PjmdfexG",
          "name": "Syntech GM OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "property_model",
        "include": "allOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -1088,
        784
      ],
      "id": "c847ac0e-fcfb-4d20-9216-5c414611fbcf",
      "name": "Split Out Chat Modals"
    },
    {
      "parameters": {
        "content": "## Add LLM here\n* Currently using first() - might need a merge"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5728,
        512
      ],
      "id": "a69261cf-0de9-4f43-afec-2fb08935eb71",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## generate watermark description and name",
        "height": 768,
        "width": 2672,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2448,
        2656
      ],
      "typeVersion": 1,
      "id": "f2d00608-f3ef-4647-a18e-41d511f99d63",
      "name": "Sticky Note3"
    }
  ],
  "pinData": {
    "Get Content With Block ID": [
      {
        "json": {
          "object": "page",
          "id": "2e7785c0-cfab-804e-ad58-f7fffef24919",
          "created_time": "2026-01-13T11:20:00.000Z",
          "last_edited_time": "2026-01-14T09:20:00.000Z",
          "created_by": {
            "object": "user",
            "id": "268d872b-594c-8161-9bd8-00029f0c0684"
          },
          "last_edited_by": {
            "object": "user",
            "id": "b4ebd45f-4b8e-4852-8989-2078a21811d7"
          },
          "cover": null,
          "icon": null,
          "parent": {
            "type": "database_id",
            "database_id": "2a2785c0-cfab-805f-ae13-ceed4cac4710"
          },
          "archived": false,
          "in_trash": false,
          "is_locked": false,
          "properties": {
            "Images Output": {
              "id": "%3EFst",
              "type": "relation",
              "relation": [
                {
                  "id": "2e7785c0-cfab-818e-a429-c89c30e8492f"
                },
                {
                  "id": "2e7785c0-cfab-8186-bb04-f96a1a568a37"
                }
              ],
              "has_more": false
            },
            "Variants": {
              "id": "%3Fwq%3C",
              "type": "number",
              "number": 1
            },
            "Image Prompt Template": {
              "id": "Q_Av",
              "type": "relation",
              "relation": [
                {
                  "id": "2e7785c0-cfab-8057-9169-e19013b97025"
                }
              ],
              "has_more": false
            },
            "Created time": {
              "id": "S%7BOv",
              "type": "created_time",
              "created_time": "2026-01-13T11:20:00.000Z"
            },
            "Status": {
              "id": "bEK%5C",
              "type": "status",
              "status": {
                "id": "b18aa8c8-373e-45fe-ba6e-8f25e8a30008",
                "name": "Done",
                "color": "green"
              }
            },
            "Update Prompt": {
              "id": "bVt%7B",
              "type": "rich_text",
              "rich_text": [
                {
                  "type": "text",
                  "text": {
                    "content": "Create a social media post for this content. Ensure the image that you create is a composite photograph",
                    "link": null
                  },
                  "annotations": {
                    "bold": false,
                    "italic": false,
                    "strikethrough": false,
                    "underline": false,
                    "code": false,
                    "color": "default"
                  },
                  "plain_text": "Create a social media post for this content. Ensure the image that you create is a composite photograph",
                  "href": null
                }
              ]
            },
            "content_hash": {
              "id": "rtRU",
              "type": "rich_text",
              "rich_text": []
            },
            "Generate Image": {
              "id": "u%3E_%40",
              "type": "button",
              "button": {}
            },
            "Error Details": {
              "id": "~lMw",
              "type": "rich_text",
              "rich_text": []
            },
            "Concept": {
              "id": "title",
              "type": "title",
              "title": [
                {
                  "type": "text",
                  "text": {
                    "content": "Cost of using diesel not just about money",
                    "link": null
                  },
                  "annotations": {
                    "bold": false,
                    "italic": false,
                    "strikethrough": false,
                    "underline": false,
                    "code": false,
                    "color": "default"
                  },
                  "plain_text": "Cost of using diesel not just about money",
                  "href": null
                }
              ]
            }
          },
          "url": "https://www.notion.so/Cost-of-using-diesel-not-just-about-money-2e7785c0cfab804ead58f7fffef24919",
          "public_url": null,
          "request_id": "9a341fa1-f1a7-454c-820a-04e37ac948da"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Get Initial Article": [
      {
        "json": {
          "headers": {
            "host": "syntech.granite-automations.app",
            "user-agent": "NotionAutomation",
            "content-length": "2120",
            "accept-encoding": "gzip, br",
            "baggage": "sentry-environment=production,sentry-release=20260114.0622-82fadd3,sentry-public_key=529a6d1990e5471d874257842c4f4ad8,sentry-trace_id=c74b2e2aa2b04e20aee29bcf84c24e03",
            "cdn-loop": "cloudflare; loops=1",
            "cf-connecting-ip": "44.227.140.35",
            "cf-ipcountry": "US",
            "cf-ray": "9bdc0e9ecba568f1-PDX",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "content-type": "application/json",
            "sentry-trace": "c74b2e2aa2b04e20aee29bcf84c24e03-930afe21fbc94c2d",
            "traceparent": "00-1b4beda802734c2cb4e05b5b7be4419a-9b0d0836190708c9-00",
            "x-forwarded-for": "104.23.160.54",
            "x-forwarded-host": "syntech.granite-automations.app",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "2a2cdba5ed46",
            "x-real-ip": "104.23.160.54"
          },
          "params": {},
          "query": {},
          "body": {
            "source": {
              "type": "automation",
              "automation_id": "2a2785c0-cfab-80cb-b270-004dd8e97c45",
              "action_id": "2a9785c0-cfab-80e4-bcc0-005a17bb6a7b",
              "event_id": "497e3817-a6dc-48f2-9520-b6c52db26e0a",
              "user_id": "b4ebd45f-4b8e-4852-8989-2078a21811d7",
              "attempt": 1
            },
            "data": {
              "object": "page",
              "id": "2e7785c0-cfab-804e-ad58-f7fffef24919",
              "created_time": "2026-01-13T11:20:00.000Z",
              "last_edited_time": "2026-01-14T09:20:00.000Z",
              "created_by": {
                "object": "user",
                "id": "268d872b-594c-8161-9bd8-00029f0c0684"
              },
              "last_edited_by": {
                "object": "user",
                "id": "b4ebd45f-4b8e-4852-8989-2078a21811d7"
              },
              "cover": null,
              "icon": null,
              "parent": {
                "type": "data_source_id",
                "data_source_id": "2a2785c0-cfab-80c3-8015-000b4338043d",
                "database_id": "2a2785c0-cfab-805f-ae13-ceed4cac4710"
              },
              "archived": false,
              "in_trash": false,
              "is_locked": false,
              "properties": {
                "Concept": {
                  "id": "title",
                  "type": "title",
                  "title": [
                    {
                      "type": "text",
                      "text": {
                        "content": "Cost of using diesel not just about money",
                        "link": null
                      },
                      "annotations": {
                        "bold": false,
                        "italic": false,
                        "strikethrough": false,
                        "underline": false,
                        "code": false,
                        "color": "default"
                      },
                      "plain_text": "Cost of using diesel not just about money",
                      "href": null
                    }
                  ]
                },
                "Update Prompt": {
                  "id": "bVt%7B",
                  "type": "rich_text",
                  "rich_text": [
                    {
                      "type": "text",
                      "text": {
                        "content": "Create a social media post for this content. Ensure the image that you create is a composite photograph",
                        "link": null
                      },
                      "annotations": {
                        "bold": false,
                        "italic": false,
                        "strikethrough": false,
                        "underline": false,
                        "code": false,
                        "color": "default"
                      },
                      "plain_text": "Create a social media post for this content. Ensure the image that you create is a composite photograph",
                      "href": null
                    }
                  ]
                },
                "Image Prompt Template": {
                  "id": "Q_Av",
                  "type": "relation",
                  "relation": [
                    {
                      "id": "2e7785c0-cfab-8057-9169-e19013b97025"
                    }
                  ],
                  "has_more": false
                },
                "Variants": {
                  "id": "%3Fwq%3C",
                  "type": "number",
                  "number": 1
                },
                "Images Output": {
                  "id": "%3EFst",
                  "type": "relation",
                  "relation": [
                    {
                      "id": "2e7785c0-cfab-818e-a429-c89c30e8492f"
                    },
                    {
                      "id": "2e7785c0-cfab-8186-bb04-f96a1a568a37"
                    }
                  ],
                  "has_more": false
                }
              },
              "url": "https://www.notion.so/Cost-of-using-diesel-not-just-about-money-2e7785c0cfab804ead58f7fffef24919",
              "public_url": null,
              "request_id": "31e851d9-c7d1-4afe-9cca-c3d7739f6590"
            }
          },
          "webhookUrl": "https://syntech.granite-automations.app/webhook/image-generation",
          "executionMode": "production"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Initial Input": [
      {
        "json": {
          "content": "Create a social media post for this content. Ensure the image that you create is cinematic",
          "prompt_update": "Create a social media post for this content. Ensure the image that you create is cinematic",
          "system_message": null,
          "user_message": null,
          "title": "Content - Closing the Loop on UK Fuel - Human Close Up S+J LATEST 2026 - Images",
          "source": "2f4785c0-cfab-80f7-beb4-ed2e85be12ac",
          "platform": null,
          "initial_article": null,
          "transformed_content_db_id": "2a9785c0-cfab-8165-a530-de60bb8c21c3",
          "image_dimensions": null,
          "image_system_message": null,
          "image_prompts": [
            {
              "id": "2e7785c0-cfab-8060-bd47-ced887736f8a",
              "name": "Human Close Up S+J LATEST 2026",
              "url": "https://www.notion.so/Human-Close-Up-S-J-LATEST-2026-2e7785c0cfab8060bd47ced887736f8a",
              "property_last_edited_time": "2026-01-21T10:28:00.000Z",
              "property_description": "This prompt is an update of the previous version, and it aims to integrate Justin's human elements. ",
              "property_system_prompt": "# STAGE 1 — IMAGE INTENT & UNIVERSE ALIGNMENT\n\n## Objective\nInterpret the provided content and generate a visual concept that:\n- Clearly belongs to the selected image pack universe\n- Is creatively varied but anchored to Syntech Biofuel’s domain\n- Avoids literal or repetitive interpretations of the text\n\nThis stage defines what kind of image should exist, not how it is rendered.\n\n---\n\n## Core Priority Order (Most → Least Important)\n1. Image Pack Universe & Examples\n2. Syntech Biofuel Domain Relevance\n3. User Text (semantic inspiration, not literal instruction)\n\nText must inspire, not dictate.\n\n---\n\n## Text Influence Rule\n- The written content should contribute ~40–50% influence\n- The example image pack should contribute ~50–60% influence — but not to the detriment of visual clarity, vibrancy, or emotional engagement\n- Never create visuals that directly “illustrate” phrases word-for-word\n- Extract metaphor, intent, or theme — not objects — unless justified\n\n---\n\n## Universe Lock (Critical)\nYou must strictly operate inside the selected image pack’s universe:\n- If the pack is icon / schematic / abstract / illustrative, all subjects must follow that visual language\n- If a real-world object appears (e.g. truck, fuel pump), it must be:\n- Reinterpreted through the universe’s style\n- Abstracted, symbolic, futuristic, schematic, or illustrative as appropriate\n- Do not default to photorealism unless the pack explicitly demands it\n\nStyle > Object realism. Always.\n\n---\n\n## Domain Anchor (Syntech Biofuel)\nEven when abstract or conceptual, the image must subtly relate to at least one of:\n- Energy systems\n- Fuel or fuel replacement\n- Infrastructure, flow, networks, or transition\n- Sustainability, efficiency, or environmental impact\n- Engineering-led progress (not generic “green vibes”)\n\nThis can be symbolic — not literal — but must be defensible.\n\n---\n\n## Colour Logic\n- Colour usage must serve visual impact, legibility, and brand impression first\n- Packs with reserved palettes (e.g., minimalist) may maintain restraint, but others are encouraged to explore vivid contrast and saturation when appropriate\n- When in doubt, favour clarity and emotional resonance over neutrality\n- Brand colours (below) can be used assertively — as accents, contrast elements, highlights, or core hues — when stylistically aligned\n- Avoid dullness caused by over-reliance on matte or desaturated styles unless demanded by the pack\n\n---\n\n## Syntech Brand Colour Reference (Low-Priority)\n\nSyntech brand colours are:\n- Syntech Green: #94C11F\n- Charcoal: #1C242B\n- Graphite: #303030\n- Cream White: #F2F2F2\n\nUsage rules:\n- These colours may appear prominently when visually beneficial\n- While not mandatory, they should be considered as part of the emotional or thematic palette\n- Subtle use is encouraged, but assertive use is permitted when aligned with tone and pack logic\n- Do not suppress vibrancy if colour improves clarity, mood, or message delivery\n\n---\n\n## HUMAN PRESENCE MODE (Conditional)\nIf the visual concept includes any human subject, activate the Human Visual Realism Lock.\n\nThis overrides any stylization or abstraction rules for human figures and enforces strict documentary realism. This rule applies only to humans in the frame — all other image elements continue to follow the active image pack rules unless otherwise noted.\n\nSee section below.\n\n---\n\n## HUMAN VISUAL REALISM LOCK\n\nGenerate a photorealistic industrial documentary photograph showing real engineers, technicians, or energy workers inside active infrastructure.\nThe image must look like it was captured by a professional commercial photographer inside a live facility.\n\n- No stylization.\n- No beauty retouching.\n- No artificial glow.\n- No perfect faces.\n- This must look like a real camera shot taken on site.\n\n### SUBJECT RULES (Humans must feel real)\nThe person or people must appear as real working professionals, not models.\n\nFaces must show:\n- Natural skin texture with visible pores\n- Uneven tone and subtle pigmentation\n- Slight shine from sweat or oil\n- Natural under-eye darkness\n- Lips with real creases and dryness\n- Small facial asymmetries\n\nIf the subject is Black:\n- Show real melanin behavior in highlights and shadows\n- Subtle color variation across cheeks, forehead, and around eyes\n- Natural hairline with baby hairs and irregular edges\n- Visible follicles, razor bumps, or texture\n\nEyes must have:\n- Moisture and realistic reflections\n- Visible blood vessels in the sclera\n- Imperfect eyelashes with random spacing\n- Iris with layered color, radial fibers, and depthNo beauty filters. No smooth plastic skin. No influencer lighting.\nThese people should feel like they have worked here for years.\n\n### CLOTHING & PPE\nThey must wear real industrial gear:\n- High-visibility jackets with creases and wear\n- Hard hats with scuffs or slight dirt\n- Safety glasses with reflections\n- Gloves, ear protection, radios, or harnesses\n- Fabric must show texture.\n- Folds must look heavy and real.\n- Nothing should look new out of a costume box.\n\n### ENVIRONMENT\nPlace them inside real infrastructure:\n\nExamples:\n- Power plants\n- Refineries\n- Control rooms\n- Turbine halls\n- Electrical substations\n- Pipeline corridors\n- Factory floors\n- Data rooms\n- Maintenance bays\n\nBackground must include:\n- Pipes\n- Valves\n- Control panels\n- Gauges\n- Cables\n- Steel structures\n- Warning labels\n- Industrial lighting\n\nThe space must feel large, functional, and alive.No empty studio backgrounds.\n\n### ACTION\nThe subject must be doing something:\n- Checking data on a tablet\n- Inspecting a machine\n- Discussing a reading with a colleague\n- Adjusting a control panel\n- Reviewing a clipboard\n- Looking at a turbine or relay system\n- Working beside a vehicleNo posing. No looking into camera. They are busy.\n\n### LIGHTING\nLighting must feel like real industrial lighting:\n- Overhead fluorescents\n- Sodium vapor\n- LED control panel glow\n- Headlamp spill\n- Blue hour or night shift lighting\n\nUse:\n- Cool blues and steel tones\n- Warm amber from lamps\n- Subtle reflections on metal\n- Shadow depth in machinery\n- Light should carve the face and hands, revealing texture.\n\n### CAMERA & OPTICS\nThis must feel shot on a real camera:\n- Shallow depth of field\n- Slight lens falloff\n- Realistic motion blur if moving\n- Natural bokeh from background lights\n- Perspective must feel human, eye level, shoulder level, or slightly candid\n- No wide-angle distortion. No hyper-sharp digital look.\n\n### COMPOSITION\nThe subject must sit inside the system. Frame them:\n- Between pipes\n- Beside control cabinets\n- Inside turbine housings\n- Next to glowing panels\n- Leaning against vehicles or machinery\n\nThe infrastructure should visually surround them.This says: humans inside massive systems.\n\n### REALISM LOCK\nThe image must pass these tests:\n- Could this be on Chevron’s annual report?\n- Could this be on Shell’s website?\n- Could this be in a Siemens brochure?\n- Would a viewer assume it is a real photograph?\n- If it feels like AI, it fails.\n\nNo stylized color grading. No surreal lighting. No fake cinematic effects.This is corporate truth.\n\n### OPTIONAL SCENE VARIANTS\nUse one per image:\n- Night shift engineer checking laptop beside a service truck\n- Control room technician reviewing live data\n- Two engineers in hard hats discussing a relay panel\n- Maintenance worker inspecting turbine blades\n- Field engineer monitoring equipment outdoors at dusk\n- Senior technician adjusting a valve inside a refinery\n\nThis is the visual language of trust.\nIt tells governments, investors, and the public:We are serious.\nWe are precise.\nReal people run this.\n\n---\n\n## Absolute Prohibitions\n- ❌ No logos, brand marks, brand names, or Syntech text\n- ❌ No reserved bottom zones or layout assumptions\n- ❌ No text shadows (ever)\n- ❌ No describing typography, font size, font weight, or layout\n- ❌ No explaining what the message “means”\n\n---\n\n## Text Handling\n- If text is included, output message copy only\n- No labels such as “headline”, “subheadline”, or commentary\n- Text must feel integrated, not instructional\n\n---\n\n## Success Criteria\nA successful Stage 1 output:\n- Looks like it belongs in its image pack at a glance\n- Is visually distinct from other packs\n- Feels creatively interpreted, not templated\n- Remains relevant to Syntech Biofuel without being literal\n- If unsure, choose stylistic fidelity over semantic accuracy — but do not suppress colour or contrast if the image benefits from bold visual interpretation\n\n---\n\n# SYSTEM PROMPT GOVERNING OUTPUT BEHAVIOUR\n\nWhenever the user asks for an image prompt, produce:\n- A complete, structured output using the same section order as the examples\n- A mandatory [BRAND FOUNDATION] section that merges Syntech identity with the example’s style\n- A mandatory [CONCEPTUAL ENGINE] section\n- Explicit negative space percentage\n- Explicit focal zone definition and subordination rules\n- Brand-aligned typography and colour handling\n- Correction of example deviations when needed\n- No meta-commentary\n\n---\n\n# 🔥 FINAL REMINDER (HARD RULES)\n\n- Universal BRAND FOUNDATION is always included\n- Typography (Montserrat family) must always be referenced\n- Syntech colour architecture must always appear meaningfully\n- Negative space ≤ 55% must be explicitly stated\n- Exactly one focal zone must be identified and explained\n- Semiotics influence outputs but are not written unless examples include them\n- Symbolic metaphors allowed only if examples allow\n- Brand rules override example inconsistencies (80% gentle, 20% corrective)\n- Never output humour, chaos, dystopia, neon sci-fi, activist aggression, retro, cartoon, grunge, or purple-heavy palettes\n- Every visual must feel engineered, calm, intelligent, and ecologically responsible\n\n---\n\n# 📦 ACTIVE IMAGE PACK — INSERTED BELOW\n\nInsert one image pack example (e.g., “Corporate & Professional”, “Abstract Symbolic”, “Industrial Schematic”, etc.) below this line to define the current visual style system.\n\nOnly one image pack should be active per generation.\n\nImage packs include:\n- [BRAND FOUNDATION]\n- [TECHNICAL FOUNDATION]\n- [COMPOSITIONAL INTENT]\n- [LIGHTING DESIGN]\n- [AESTHETIC DNA]\n- [EXECUTION NOTES]\n- [CONTEXT]\n- [KEYWORDS]\n- 📍[HUMAN PRESENCE RULESET] (if applicable)\n\nFollow the active image pack strictly, unless doing so would conflict with critical brand rules.",
              "property_version": [
                "2ef785c0-cfab-801f-b23f-d3c663ad14c1"
              ],
              "property_image_dimensions": "1536x1024",
              "property_aspect_ratio": "4:5",
              "property_model": [
                "google/gemini-2.5-pro",
                "openai/gpt-5.1"
              ],
              "property_system_message": "<prompts>\n\n# Example 1:\n\n[TECHNICAL FOUNDATION]\n\nCamera: Medium format digital | Aperture: f/8 for deep depth of field across subject and background | Sensor: Large format for high-resolution output\n\n[COMPOSITIONAL INTENT]\n\nFrame: 1:1 aspect ratio, ideal for social media and universal display, creating a balanced and centered focus | Rule: Centralized subject with negative space for text and graphic elements, adhering to a minimalist aesthetic | Flow: The outstretched hand naturally guides the eye to the eco-friendly globe, then across the bold typography.\n\n[LIGHTING DESIGN]\n\nQuality: Soft, diffuse, even illumination from multiple sources (e.g., large softboxes) to minimize harsh shadows and create a clean, optimistic feel | Direction: Overhead and slightly front-angled to illuminate the globe and hand without strong directional shadows, emphasizing clarity and detail | Colour: Neutral daylight temperature (5500K) to maintain naturalistic colours of the earth and foliage, avoiding any strong colour casts.\n\n[AESTHETIC DNA]\n\nStyle: Eco-modernism with a clean, corporate social responsibility aesthetic. Influenced by minimalist graphic design and sustainable branding visuals | Mood: Hopeful, responsible, clean, and professional. Conveys a commitment to environmental stewardship | Era: Contemporary digital marketing, focusing on clear messaging and high visual impact.\n\n[EXECUTION NOTES]\n\nPost-Process: Bright, high-key colour grading with slightly desaturated whites and vibrant greens. Subtle sharpening for text and globe details. Seamless compositing of the hand and globe with the clean background | Texture: Smooth, almost pristine texture on the hand and background to maintain a sterile, professional look, contrasted with the organic textures of the miniature foliage on the globe | Context: A digital campaign visual for environmental awareness or a corporate social responsibility initiative, designed for broad appeal across various digital platforms.\n\nAlternative Approaches:\n\n1. Dynamic Lighting: Introduce subtle volumetric lighting behind the globe to create a more ethereal, \"glowing\" effect, enhancing the sense of hope and natural energy.\n2. Textural Background: Instead of a plain background, incorporate a very subtle, blurred texture of recycled paper or a soft, organic fabric to add depth while maintaining the eco-friendly theme.\n3. Different Hand Pose: A hand gently cupping the globe from below, emphasizing protection and care, rather than presenting it.\n\n---\n\n# Example 2:\n\n[TECHNICAL FOUNDATION]\n\nCamera: Standard prime lens (e.g., 50mm f/1.8) | Aperture: f/2.8-f/4 to ensure the beaker is sharp with a slight, pleasing background blur (bokeh) | Sensor: Full-frame for natural depth of field and excellent low-light performance (though not critical here).\n\n[COMPOSITIONAL INTENT]\n\nFrame: 1:1 aspect ratio, optimized for social media feeds and quick visual consumption | Rule: Rule of Thirds for the beaker placement, slightly off-center to create dynamic tension, with significant negative space in the upper left for text overlay | Flow: Hands holding the beaker guide the eye directly to the bright liquid, then naturally to the overlay text.\n\n[LIGHTING DESIGN]\n\nQuality: Bright, natural daylight, likely slightly overcast or open shade to provide soft, even illumination, minimizing harsh reflections on the glass and creating gentle shadows | Direction: Overhead diffuse light, potentially with a slight front fill to illuminate the liquid's colour and the gloves' texture | Colour: Cool daylight temperature (around 6500K) to enhance the blue of the sky and gloves, creating a subtle complementary contrast with the warm yellow liquid.\n\n[AESTHETIC DNA]\n\nStyle: Scientific minimalism meets optimistic environmentalism. Clean, clear, and product-focused, with an emphasis on tangible results and innovation | Mood: Hopeful, innovative, clean, and trustworthy. The image aims to evoke a sense of progress and scientific advancement in a positive environmental context | Era: Contemporary B2B and B2C marketing for green technology, focusing on transparency and tangible product benefits.\n\n[EXECUTION NOTES]\n\nPost-Process: Bright, clean colour grading. Enhancement of the yellow liquid's vibrancy and the blue gloves/sky. Subtle vignette to draw focus to the center. Text overlay integrated seamlessly | Texture: Smooth glass of the beaker, slightly textured blue nitrile gloves, and a soft, uniform sky texture. The contrast highlights the product and the human element | Context: A promotional image for a biofuel company, suitable for LinkedIn, Instagram, or corporate websites, highlighting the transformation of waste into energy through clear, compelling visuals.\n\nAlternative Approaches:\n\n1. Golden Hour Lighting: Photograph the beaker during golden hour for a warmer, more dramatic glow on the liquid, adding a sense of magic to the \"transformation\" narrative.\n2. Lab Environment Context: Instead of an open sky, shoot against a subtly blurred backdrop of a clean, modern lab setting (e.g., beakers, test tubes in the background) to reinforce the scientific process.\n3. Macro Detail: A tighter shot focusing purely on the liquid inside the beaker, perhaps with tiny particles visible, to emphasize the raw material or the conversion process, with the gloved hands still subtly in frame.\n\n---\n\n# Example 3:\n\n[TECHNICAL FOUNDATION]\n\nCamera: Standard prime lens (e.g., 50mm f/1.8-f/2.8) | Aperture: f/2.8 to isolate the hand and leaves with a subtle background blur, emphasizing the subject while maintaining context | Sensor: Full-frame, for a natural field of view and good low-light capability (allowing for controlled indoor lighting).\n\n[COMPOSITIONAL INTENT]\n\nFrame: 1:1 aspect ratio, perfect for social media and digital platforms, creating a balanced and easily consumable visual | Rule: Rule of Thirds applied, with the hand and leaves placed on an intersection point for visual interest, allowing ample negative space for text and branding | Flow: The outstretched hand and delicate leaves naturally draw the eye, with the upward angle of the arm leading to the large headline text.\n\n[LIGHTING DESIGN]\n\nQuality: Soft, directional light, possibly from a large softbox or natural window light, creating gentle highlights on the skin and subtle shadows to give depth to the hand and leaves | Direction: Side-front lighting to highlight the texture of the leaves and the contours of the hand, adding a sense of realism and dimensionality | Colour: Neutral to slightly warm colour temperature (e.g., 5000K-5500K) to render the skin tones naturally and make the green leaves pop against the vibrant green background.\n\n[AESTHETIC DNA]\n\nStyle: Humanistic environmentalism, combining a personal touch with a strong ecological message. Clean, optimistic, and directly engaging | Mood: Empowering, hopeful, clean, and forward-thinking. The image aims to inspire participation and convey a sense of collective action | Era: Contemporary green marketing and corporate social responsibility campaigns, leveraging accessible and relatable imagery.\n\n[EXECUTION NOTES]\n\nPost-Process: High-key colour grading with enhanced saturation on the green background and leaves, making them visually striking. Subtle skin tone correction and sharpening on the leaves for crisp detail. Text overlays are clear and legible | Texture: Smooth skin texture contrasted with the delicate, organic texture of the leaves. The uniform green background provides a clean stage for these elements | Context: A powerful call-to-action image for an environmental campaign or a biofuel company, suitable for social media, website banners, and promotional materials, designed to inspire engagement.\n\nAlternative Approaches:\n\n1. Backlit Effect: Position the light source directly behind the hand and leaves to create a luminous, ethereal glow around the edges, making the leaves appear more vibrant and symbolic.\n2. Multiple Hands: Show a diverse group of hands, perhaps different ages or ethnicities, each holding a single leaf, to emphasize collective action and inclusivity in the \"revolution.\"\n3. Symbolic Object: Instead of leaves, the hand could be holding a miniature, glowing energy orb or a stylized green seedling, further emphasizing the \"clean energy\" aspect with a more abstract symbol.\n\n---\n\n# Example 4:\n\n[TECHNICAL FOUNDATION]\n\nCamera: Standard to short telephoto lens (e.g., 85mm f/1.8) | Aperture: f/2.8-f/4 to achieve a shallow depth of field, focusing sharply on the hand and nozzle while softly blurring the industrial background | Sensor: Full-frame, for enhanced low-light performance and pleasing bokeh characteristics.\n\n[COMPOSITIONAL INTENT]\n\nFrame: 1:1 aspect ratio, optimized for social media consumption, ensuring the key elements are prominent and centered | Rule: Rule of Thirds is employed, with the nozzle and hand positioned along a vertical third, creating an engaging visual balance against the industrial background | Flow: The angle of the fuel nozzle guides the eye diagonally from the bottom left towards the hand, then up to the prominent text, creating a clear narrative path.\n\n[LIGHTING DESIGN]\n\nQuality: Hard, direct light, likely natural sunlight, creating strong shadows and highlights that emphasize the rugged, industrial environment and the textures of the machinery | Direction: Top-down or slightly angled natural light to create definition on the hand and the nozzle, reflecting the working conditions of heavy machinery | Colour: Neutral daylight temperature (5500K) to accurately represent the colours of the machinery, the fuel nozzle, and the worker's vest, giving an authentic, un-staged feel.\n\n[AESTHETIC DNA]\n\nStyle: Industrial realism meets practical sustainability. Focuses on functionality, authenticity, and tangible real-world application | Mood: Efficient, reliable, robust, and straightforward. Conveys a no-nonsense, practical solution for heavy industry | Era: Contemporary industrial and B2B marketing, emphasizing direct benefits and ease of integration.\n\n[EXECUTION NOTES]\n\nPost-Process: Slightly desaturated colour grading with a focus on yellows, greens, and blacks, creating a robust, almost utilitarian aesthetic. Enhanced contrast and sharpening to bring out the details of the machinery and the text on the pump | Texture: Rough, worn textures of the machinery, the plastic of the fuel nozzle, and the fabric of the high-vis vest. These textures communicate authenticity and durability | Context: A promotional image for an industrial biofuel product, aimed at businesses in heavy machinery, transportation, or agriculture, highlighting the ease of transition and carbon reduction benefits.\n\nAlternative Approaches:\n\n1. Dramatic Backlighting: Position the light source behind the machinery and the hand, creating a strong silhouette effect that emphasizes the shape and form, with a glowing edge around the nozzle.\n2. Environmental Context: Pull back slightly to show more of the worksite (e.g., a construction site, farm, or depot) in a blurred background, reinforcing the real-world application of the biofuel.\n3. Product Focus (Macro): A much tighter shot focusing on the \"SYNTECH ASB ONLY\" sticker and the detail of the fuel pump opening, symbolizing the specific compatibility and easy integration, with the hand partially visible.\n\n---\n\n# Example 5:\n\n[TECHNICAL FOUNDATION]\n\nCamera: Wide-angle lens (e.g., 24mm f/2.8) for expansive background and immersive feel | Aperture: f/4-f/5.6 to ensure both the hand/droplet and the distant background have reasonable sharpness, emphasizing the vastness of the landscape | Sensor: Full-frame for superior low-light performance and dynamic range, critical for the moody, low-light scene.\n\n[COMPOSITIONAL INTENT]\n\nFrame: 1:1 aspect ratio, ideal for social media, creating a balanced and impactful visual that draws the eye into the scene | Rule: Leading lines created by the textured ground converge towards the glowing droplet and hand, with the horizon line positioned according to the Rule of Thirds for a balanced landscape | Flow: The glowing droplet immediately captures attention, leading the eye up the arm to the text, then across to the secondary text, creating a powerful narrative arc.\n\n[LIGHTING DESIGN]\n\nQuality: Diffuse, low-key lighting, mimicking twilight or an overcast sky, to create a moody and contemplative atmosphere. The primary light source is the glowing droplet, acting as a soft, localized fill light | Direction: Ambient light from above, with the primary light source being the emanating glow from the droplet itself, illuminating the immediate surroundings | Colour: Predominantly cool tones (blues, greens, deep greys) with a subtle warm highlight from the distant sun, creating a strong complementary contrast that enhances the glowing green droplet.\n\n[AESTHETIC DNA]\n\nStyle: Mystical environmentalism with a touch of cinematic drama. Blends a sense of wonder and hope with the vastness of nature. Influenced by fantasy landscape art and contemporary eco-branding | Mood: Inspirational, hopeful, mysterious, and profound. Aims to evoke a sense of responsibility and the potential for positive impact | Era: Modern digital art and environmental advocacy campaigns, using evocative imagery to convey deep messages.\n\n[EXECUTION NOTES]\n\nPost-Process: Dark, moody colour grading with an emphasis on cool green and teal tones. The glowing effect of the droplet is highly saturated and bright, acting as a focal point. Subtle atmospheric haze in the background adds depth. Text overlays are clear and contrast well against the dark background | Texture: Rough, uneven texture of the dry, barren ground contrasting with the smooth, luminous surface of the droplet and the subtle texture of the hand. The distant mountains provide a rugged backdrop | Context: An inspirational brand image for a sustainable energy company, designed to be impactful on social media and digital platforms, conveying a message of hope and action in environmental stewardship.\n\nAlternative Approaches:\n\n1. Dramatic Sky: Enhance the background sky with more prominent, dramatic clouds or a star-filled night sky to amplify the sense of vastness and mystery.\n2. Water Element: Instead of dry ground, have the droplet falling onto a ripple in still water, creating a concentric glow, symbolizing the widespread impact of a single action.\n3. Seedling Growth: Instead of just a droplet, show a tiny, glowing seedling emerging from the ground where the droplet has fallen, emphasizing growth and tangible change from a small beginning.\n\n---\n\n# Example 6:\n\n[TECHNICAL FOUNDATION]\n\nCamera: Standard to slightly wide lens (e.g., 35mm-50mm) to capture both handshake and city skyline | Aperture: f/4-f/5.6 to ensure both the foreground handshake and background city lights are acceptably sharp, creating a sense of connection between human action and urban impact | Sensor: Full-frame for excellent low-light performance and dynamic range, crucial for night cityscapes.\n\n[COMPOSITIONAL INTENT]\n\nFrame: 1:1 aspect ratio, optimized for social media and digital platforms, creating a strong, central focus | Rule: Centralized handshake as the primary focal point, balanced by the symmetrical presence of the city skyline in the background. The handshake is placed in the lower-mid section, leaving ample space for headline text | Flow: The interlocking hands immediately draw the eye, leading upwards to the impactful headline text, then downwards to the call-to-action, creating a dynamic visual loop.\n\n[LIGHTING DESIGN]\n\nQuality: Hard, directional artificial light, possibly from a street light or a specific spot source, creating strong shadows and highlights on the hands, adding depth and drama | Direction: Backlighting or side lighting on the handshake to create separation from the background and highlight the contours of the hands. The city lights in the background serve as natural light sources | Colour: Mixed colour temperatures: cool blue/teal tones from the ambient city lights and warmer, amber tones from the building windows, creating a rich and sophisticated urban night scene.\n\n[AESTHETIC DNA]\n\nStyle: Corporate cinematic meets urban sustainability. Blends the gravitas of a business agreement with the dynamic backdrop of a modern city. Influenced by commercial photography and film noir cityscapes | Mood: Professional, powerful, collaborative, and forward-thinking. Conveys a sense of serious commitment and impactful partnerships in an urban context | Era: Contemporary business and sustainability marketing, focusing on B2B partnerships and leadership in green initiatives.\n\n[EXECUTION NOTES]\n\nPost-Process: Dark, moody colour grading with an emphasis on blues, teals, and amber tones, creating a sophisticated night-time aesthetic. Enhanced contrast to make the city lights pop and define the handshake. Text overlays are crisp and stand out against the dark background | Texture: Fine texture of suit fabric, skin texture on hands, and the illuminated architectural details of the city buildings. The reflection on the water (if present) adds another textural layer | Context: A powerful corporate image for a biofuel company, targeting business leaders and partners, suitable for LinkedIn, corporate websites, annual reports, and high-impact digital campaigns, emphasizing collaboration for a sustainable future.\n\nAlternative Approaches:\n\n1. Dynamic Perspective: A slightly lower angle, looking up at the handshake and the towering city, emphasizing the monumental scale of the partnership and its ambition.\n2. Subtle Motion Blur: A very slight motion blur on the background city lights (achieved with a slightly longer exposure) to give a sense of dynamism and bustling urban life, contrasted with the static, resolute handshake.\n3. Green Accent Lighting: Introduce a subtle, targeted green light (e.g., a green gelled LED) to cast a soft green glow on one of the hands or a specific part of the handshake, subtly reinforcing the \"go green\" message.\n\n---\n\n# Example 7:\n\n[TECHNICAL FOUNDATION]\n\nCamera: Standard prime lens (e.g., 50mm f/1.8) | Aperture: f/2.8-f/4 to achieve a shallow depth of field, focusing sharply on the plant and hands, while creating a soft, pleasing bokeh in the background | Sensor: Full-frame for natural depth of field and excellent rendering of skin tones and natural colours.\n\n[COMPOSITIONAL INTENT]\n\nFrame: 1:1 aspect ratio, optimized for social media, providing a focused and balanced visual narrative | Rule: The plant and hands are centrally placed, forming a strong focal point. The subjects are positioned to create a natural V-shape leading to the plant, emphasizing collective effort | Flow: The eyes are naturally drawn to the central act of planting, then follow the implied lines of the arms to understand the collaborative nature, and finally upwards to the headline text.\n\n[LIGHTING DESIGN]\n\nQuality: Soft, warm, natural light, likely during golden hour (late afternoon or early morning) to create long, pleasing shadows and a glowing, ethereal quality to the background | Direction: Backlighting or strong side lighting from a low sun angle to create beautiful rim lighting on the plant leaves and hands, separating them from the background and adding depth | Colour: Predominantly warm colour temperature (e.g., 3000K-4500K) with rich golden and amber tones from the sun, enhancing the natural, earthy palette and creating a sense of warmth and optimism.\n\n[AESTHETIC DNA]\n\nStyle: Authentic environmentalism with a human touch. Combines a genuine, hands-on approach to nature with a soft, inviting aesthetic. Influenced by lifestyle photography and sustainable living campaigns | Mood: Nurturing, hopeful, collaborative, and grounded. Evokes a sense of care, growth, and shared responsibility towards the environment | Era: Contemporary lifestyle and green marketing, emphasizing community, personal action, and natural well-being.\n\n[EXECUTION NOTES]\n\nPost-Process: Warm colour grading with enhanced golden and green tones. The bokeh is smooth and creamy, making the plant stand out. Subtle vignetting to draw focus to the center. Text overlays are clear and legible against the softer background | Texture: Earthy textures of soil, soft green of the plant leaves, natural skin texture on hands, and the rustic fabric of the plaid shirt. These textures convey authenticity and the tactile nature of gardening | Context: A powerful image for an environmental initiative or a biofuel company, suitable for social media, website banners, and educational materials, emphasizing hands-on commitment to ecological sustainability.\n\nAlternative Approaches:\n\n1. Diverse Hands: Feature more hands, representing different ages or communities, all contributing to the planting, to emphasize collective action and inclusivity.\n2. Growth Stages: Incorporate a subtle visual hint of growth, perhaps a blurred background showing older, thriving trees, to represent the long-term impact of planting.\n3. Symbolic Object: Instead of a natural seedling, the hands could be planting a symbolic, glowing green object (e.g., a stylized \"energy seed\") that metaphorically grows into clean energy, linking directly to biofuel.\n\n</prompts>",
              "property_title": "Human Close Up S+J LATEST 2026"
            }
          ],
          "image_aspect_ratio": "4:5",
          "model": null,
          "temperature": null,
          "top_p": null,
          "frequency_penalty": null,
          "presence_penalty": null,
          "max_tokens": null,
          "num_variants": null,
          "prompt_source": "{{ $json.prompt_source }}"
        }
      }
    ]
  },
  "repo_name": "syntech-backup-railway",
  "repo_owner": "Granite-Marketing",
  "repo_path": "https://github.com/Granite-Marketing/syntech-n8n-backup/",
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "shared": [
    {
      "updatedAt": "2026-01-28T09:10:22.088Z",
      "createdAt": "2026-01-28T09:10:22.088Z",
      "role": "workflow:owner",
      "workflowId": "94cQgMMaleQORL211aZxS",
      "projectId": "U9sMeJya1DaokkjK"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2026-01-30T07:48:57.476Z",
  "versionId": "0471a0e1-cecf-45eb-a0ec-16b0c9078fd0"
}