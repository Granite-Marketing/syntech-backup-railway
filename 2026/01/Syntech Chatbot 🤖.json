{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        []
      ]
    },
    "get_platform_content_prompt": {
      "ai_tool": [
        [
          {
            "node": "write_platform_content",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Curate Sources": {
      "ai_tool": [
        [
          {
            "node": "get_topic_research_context",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Generate Search Queries2": {
      "ai_tool": [
        [
          {
            "node": "get_topic_research_context",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Search Internet2": {
      "ai_tool": [
        [
          {
            "node": "get_topic_research_context",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_topic_research_context": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory2": {
      "ai_memory": [
        []
      ]
    },
    "write_platform_content": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "get_topic_research_context",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "write_platform_content",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "start_content_work_item": {
      "ai_tool": [
        [
          {
            "node": "sync_content_workflow_state",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "cancel_content_work_item": {
      "ai_tool": [
        [
          {
            "node": "sync_content_workflow_state",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "complete_content_work_item": {
      "ai_tool": [
        [
          {
            "node": "sync_content_workflow_state",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "sync_content_workflow_state",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory3": {
      "ai_memory": [
        []
      ]
    },
    "sync_content_workflow_state": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Orchastrator": {
      "main": [
        []
      ]
    },
    "revise_platform_content": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "revise_platform_content",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get New Ideas1": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get New Ideas (From Time Period)1": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_workflow_states_by_notion_ids": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_workflow_items_by_status": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client": {
      "ai_tool": [
        []
      ]
    },
    "Orchastrator v3 (Prompt Engineer)": {
      "main": [
        []
      ]
    },
    "get_available_image_prompts": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "store_transformed_content": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "update_source_content_status": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "store_research_context": {
      "ai_tool": [
        [
          {
            "node": "Orchastrator v3 (Prompt Engineer)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2026-01-28T08:12:44.249Z",
  "id": "4k9HGu87hRmGn5vm",
  "isArchived": true,
  "meta": null,
  "name": "Syntech Chatbot ðŸ¤–",
  "nodes": [
    {
      "parameters": {
        "public": true,
        "availableInChat": true,
        "agentName": "syntech_post_creator",
        "agentDescription": "Write posts in Syntech's tone of voice",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -1216,
        0
      ],
      "id": "374e8950-0b9c-4454-9e7d-68fe0eebdbc4",
      "name": "When chat message received",
      "webhookId": "55cd7187-3b90-49a0-8b6c-015e2cc42878"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1",
          "mode": "list",
          "cachedResultName": "gpt-5.1"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.1,
          "timeout": 1200000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1344,
        224
      ],
      "id": "b877253c-2e56-4343-b406-cc37f071713a",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "S2kEpGa9PHsoI7on",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 6
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -1168,
        224
      ],
      "id": "ff0ef24b-6397-40ff-a856-d6803cc2ebcc",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "contextWindowLength": 1
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -2048,
        800
      ],
      "id": "8a46b056-e553-40db-86ae-a137033d6ee6",
      "name": "Simple Memory1"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=Use this tool to retrieve a platform-specific content writing prompt.\n\nThis tool returns prompts that define:\n- Writing style\n- Structure\n- Tone\n- Length constraints\n- Formatting rules\n\nYou MUST call this tool before writing any content.\n\nInputs:\n- platform (required): The target platform or content type (e.g. LinkedIn, Twitter/X, Blog, Newsletter)\n- content_type (optional): Post, article, thread, long-form blog, etc.\n\nOutput:\n- One or more writing prompts designed to be used as instructions for generating content.\n- These prompts are NOT final content and must be applied to the user-provided idea.\n\nIf a relevant prompt is found, select the best one and use it to generate the final content.\nIf no relevant prompt is found, do not generate content.",
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "27c785c0-cfab-810e-9c97-cefeee3d04b3",
          "mode": "list",
          "cachedResultName": "Syntech Platform Prompts",
          "cachedResultUrl": "https://www.notion.so/27c785c0cfab810e9c97cefeee3d04b3"
        },
        "filterType": "manual",
        "filters": {
          "conditions": [
            {
              "key": "Title|title",
              "condition": "contains",
              "titleValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Title', `The content prompt that the user want's to use to generate content. Input should only contain the platform name eg \"LinkedIn\", \"Threads\", \"Twitter/X\", \"Blog\" ...`, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        -1888,
        800
      ],
      "id": "535ecc54-a2d1-4940-9412-8ef52eebfc14",
      "name": "get_platform_content_prompt",
      "credentials": {
        "notionApi": {
          "id": "v7nNI35XIwsY1JzB",
          "name": "Syntech.granite"
        }
      }
    },
    {
      "parameters": {
        "name": "curate_sources",
        "description": "Call this tool to curate the best URLs from the generate_search_queries. The input should be the list of URLs from the generate_search_queries tool. ",
        "workflowId": {
          "__rl": true,
          "value": "EAPhQjGU2ySyEXs7",
          "mode": "list",
          "cachedResultUrl": "/workflow/EAPhQjGU2ySyEXs7",
          "cachedResultName": "Curate Sources"
        },
        "fields": {
          "values": [
            {
              "name": "question",
              "stringValue": "={{ $fromAI('initial_input', \"The user-provided topic to be researched\") }}"
            },
            {
              "name": "max_results",
              "stringValue": "=3"
            },
            {
              "name": "in_depth",
              "type": "booleanValue"
            }
          ]
        },
        "jsonSchemaExample": ""
      },
      "id": "4bf9cb50-1fc7-4fe7-ba3c-9da6a64cd798",
      "name": "Curate Sources",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -2832,
        704
      ]
    },
    {
      "parameters": {
        "name": "generate_search_queries",
        "description": "Generates the search queries prompt for the given question and context.\nArgs:\n        question (str): The question to generate the search queries prompt for\n        report_type (str): The report type\n        max_iterations (int): The maximum number of search queries to generate\n        context (str): Context for better understanding of the task with realtime web information provided by calling the 'get_content' tool\n\nReturns: str: The search queries prompt for the given question",
        "workflowId": {
          "__rl": true,
          "value": "3ZvtNy32wVNLZjZO",
          "mode": "list",
          "cachedResultUrl": "/workflow/3ZvtNy32wVNLZjZO",
          "cachedResultName": "Generate Search Queries"
        },
        "fields": {
          "values": [
            {
              "name": "question",
              "stringValue": "={{ $fromAI('initial_input', \"The user-provided topic to be researched\") }}"
            },
            {
              "name": "report_type",
              "stringValue": "=ada"
            },
            {
              "name": "max_iterations",
              "stringValue": "=3"
            }
          ]
        },
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "{\n\"type\": \"object\",\n\"properties\": {\n\t\"query\": {\n\t\t\"type\": \"string\",\n\t\t\"description\": \"The query generated by the agent\"\n    },\n    \"context\": {\n  \t\t\"type\": \"string\",\n  \t\t\"description\": \"The output generated by calling the 'get_contet' tool\"\n    }\n  }\n}"
      },
      "id": "a9458060-5398-49ae-97ea-b67c085ce36a",
      "name": "Generate Search Queries2",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -2672,
        704
      ]
    },
    {
      "parameters": {
        "toolDescription": "Useful for searching search queries generated by the agent. ",
        "method": "POST",
        "url": "https://api.tavily.com/search",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n    \"api_key\": \"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\",\n    \"query\": \"{query}\",\n}",
        "placeholderDefinitions": {
          "values": [
            {
              "name": "query",
              "description": "The query provided by the Agent"
            }
          ]
        },
        "optimizeResponse": true,
        "dataField": "results",
        "fieldsToInclude": "selected",
        "fields": "title, url, content, score"
      },
      "id": "1b20b432-9578-41a9-a34c-24daa199a59b",
      "name": "Search Internet2",
      "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
      "typeVersion": 1.1,
      "position": [
        -2496,
        704
      ]
    },
    {
      "parameters": {
        "toolDescription": "=Use this tool to retrieve factual background, key points, and recent context for a given topic.\n\nThis tool is for research only.\nIt returns raw informational context, not finished content.\n\nInputs:\n- topic or source material\n- optional scope (e.g. policy, economics, climate, technology)\n\nOutput:\n- Bullet-point facts\n- Key arguments\n- Important statistics or developments\n- Neutral, source-based context\n\nThis output is intended to be passed into a writing agent as background material.",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "=You are responsible for managing and coordinating researching the users query.\n\n# Objectives\n- Prioritise UK sources first; include EU/global only when UK data is unavailable or to add context.\n- Default to the most recent information, ideally within the last 24 months, unless citing foundational standards or landmark studies.\n- Emphasise factual, standards-led, and operationally relevant information (e.g., BS EN 14214, RTFO, on-site/on-time deployment, measurable emissions impact).\n- Exclude partisan commentary and political opinion pieces. Factual policy/regulatory materials are allowed.\n- Prefer credible sources: government, standards bodies, peer-reviewed research, and recognised industry research. Include high-quality industry/blog sources when they present verifiable data or methodology.\n\n# Steps\n\n1. **Initial orientation search (single-query only)**  \n   Perform **one** broad web search to gain a *high-level background understanding* of the topic:  \n   \"{{ $fromAI('initial_input', \"The user-provided topic to be researched\") }}\"\n\n   - This step is for orientation only, not exhaustive research.\n   - Do NOT generate multiple queries at this stage.\n   - Do NOT branch, refine, or iterate searches.\n   - The purpose is to understand key themes, terminology, standards, and entities.\n\n2. Use the context from the initial orientation search to generate structured search queries.\n\n3. Search the internet with the queries generated by the generate_search_queries tool.\n\n4. Curate the best URLs from step 3.\n\n# Tools Available\n\"generate_search_queries\": Create structured search queries based on initial context\n\"search_internet\": Obtain real-time web data\n\"curate_sources\": Evaluate and curate the best URLs from the research_search_queries tool\n\n# Output and Quality Notes\n- Capture sources that include measurable outcomes, standards/regulatory references, supply-chain/ESG implications, and concrete data.\n- Avoid redundancy; include overlapping sources only if each adds novel data, methodology, or perspective.\n- Note paywalls or inaccessible pages; prefer accessible sources for extraction and citation.\n- Assume todays date is {{ $now }}.",
          "maxIterations": 30,
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        -2720,
        496
      ],
      "id": "40a3fb01-c2e2-4306-8e86-9f57001f8c53",
      "name": "get_topic_research_context"
    },
    {
      "parameters": {
        "contextWindowLength": 2
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -2992,
        704
      ],
      "id": "74806070-ecb0-4de9-8c3f-6bed59afcb75",
      "name": "Simple Memory2"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=You are the main orchestrator agent responsible for coordinating content creation and revision.\n\nYou do not write final content yourself.  \nYour role is to:\n- Interpret user intent\n- Gather required inputs\n- Ask clarifying questions only when strictly necessary\n- Decide which tools to call and in what order\n- Coordinate workflow state transitions\n- Pass clean, complete inputs to downstream tools\n\nYour goal is to produce high-quality content efficiently, without unnecessary steps, using explicit user intent and specialised tools.\n\n---\n\n## Tools You Have Access To\n\n1. **Get Syntag Content Ideas (MCP)**  \n   Retrieves unpublished content ideas from the content database (Notion).\n\n2. **Get Topic Research Context**  \n   Returns factual background and contextual depth.  \n   Produces research only, not finished content.\n\n3. **Write Platform Content**  \n   Generates final, ready-to-publish content.  \n   Internally retrieves and applies the correct platform-specific writing prompt.\n\n4. **Revise Platform Content**  \n   Applies targeted revisions to existing content based on user feedback.  \n   Does not perform research or restart content workflows.\n\n5. **Get Current In-Progress Work Item**  \n   Read-only tool to determine whether a content workflow item is currently in progress.\n\n6. **Sync Content Workflow State**  \n   Synchronises workflow state across Supabase and Notion.  \n   Handles start, cancel, and complete lifecycle actions.\n\n---\n\n## Definition: Notion Content Idea (Critical)\n\nA **Notion-derived content idea** is any object returned from  \n**Get Syntag Content Ideas (MCP)** that includes:\n\n- `id` â€” Notion page ID (unique, stable identifier)  \n- `name` â€” Content title  \n- `url` â€” Notion page URL  \n\nExample (simplified):\n\n```json\n{\n  \"id\": \"2b9785c0-cfab-8144-a4c3-f8f635398751\",\n  \"name\": \"Protect Your Business with New Countervailing Duties on US HVO Biodiesel\",\n  \"url\": \"https://www.notion.so/...\"\n}\n```\n\nIf an idea matches this shape, it MUST be treated as a Notion-derived idea and MUST follow the workflow state rules below.\n\n---\n\n## Core Intent Classification\n\nBefore taking any action, determine whether the userâ€™s request is for:\n\n### A) Content Creation\n- No existing content is provided, OR\n- The user asks to write, generate, or create new content from an idea\n\n### B) Content Revision\n- Existing content is provided, AND\n- The user asks to edit, tweak, rephrase, shorten, expand, or refine it\n\nThese paths are mutually exclusive.\n\n---\n\n## Creation Workflow Rules\n\n### 1. Content Idea Resolution\n\nFor content creation, determine the content idea by:\n- Using a user-provided idea, OR\n- Retrieving an idea from the Notion database via **Get Syntag Content Ideas (MCP)**\n\nDo not alter the core intent of the idea.\n\n---\n\n### 2. Mandatory State Handling for Notion Ideas (Strict)\n\nIf the selected content idea is **Notion-derived**:\n\n1. Call **Get Current In-Progress Work Item**\n2. If an in-progress item exists:\n   - Compare `notion_page_id` or `notion_url`\n   - If they MATCH:\n     - Inform the user that this idea is already in progress\n     - Continue working on it\n   - If they DO NOT match:\n     - Automatically start a new workflow state\n     - Do NOT ask a follow-up question\n3. If no in-progress item exists:\n   - Automatically start a new workflow state\n\nTo start a new workflow state:\n- Call **Sync Content Workflow State** with action = `start`\n- Pass:\n  - notion_page_id\n  - notion_url\n  - title\n\nState creation must occur BEFORE any research or writing.\n\n---\n\n### 3. Workflow State Management (Creation Only)\n\n- When the user explicitly chooses to cancel:\n  - Call **Get Current In-Progress Work Item**\n  - Then call **Sync Content Workflow State** with action = `cancel`\n\n- When the user explicitly confirms they are happy with the content:\n  - Call **Get Current In-Progress Work Item**\n  - Then call **Sync Content Workflow State** with action = `complete`\n\n- When the user explicitly chooses to cancel:\n  - Call Get Current In-Progress Work Item\n  - Extract the Supabase workflow record ID from the response\n  - Use ONLY this Supabase record ID when calling Sync Content Workflow State\n  - Then call Sync Content Workflow State with action = cancel\n\n- When the user explicitly confirms they are happy with the content:\n  - Call Get Current In-Progress Work Item\n  - Extract the Supabase workflow record ID from the response\n  - Use ONLY this Supabase record ID when calling Sync Content Workflow State\n  - Then call Sync Content Workflow State with action = complete\n\nDo not assume state.  \nDo not mutate state without explicit user intent, except when automatically starting state for Notion-derived ideas.\n\n---\n\n### 4. Research Confirmation (Creation Only)\n\nBefore generating long-form or analytical content, explicitly ask:\n\nâ€œWould you like me to do deep research for this piece before writing?â€\n\n- If **yes**:\n  - Call **Get Topic Research Context**\n- If **no**:\n  - Proceed using only the content idea\n\nWhen research is performed:\n- Do NOT display or summarise it by default\n- Treat it as internal background context\n- Immediately proceed to writing\n\nOnly surface research if the user explicitly asks to see it.\n\n---\n\n### 5. Writing Execution (Creation Only)\n\nYou may call **Write Platform Content** only after:\n- A content idea is finalised\n- Workflow state is IN_PROGRESS\n- Platform or format is clearly identified\n- Research preference is confirmed\n- Any requested research is gathered\n\nPass only:\n- Content idea\n- Platform\n- Research context (if any)\n- Optional modifiers explicitly provided by the user\n\n---\n\n## Revision Workflow Rules\n\nIf the user provides existing content and requests changes:\n\n- Treat this as **revision mode**\n- Do NOT:\n  - Perform research\n  - Modify workflow state\n  - Retrieve new content ideas\n  - Call Write Platform Content\n\nInstead:\n- Call **Revise Platform Content**\n- Pass:\n  - Existing content\n  - Revision instructions\n  - Any optional constraints\n\nRevision is a lightweight, non-lifecycle operation.\n\n---\n\n## Clarifying Questions (Strict & Sparse)\n\nAsk follow-up questions only when required to resolve:\n- Topic ambiguity\n- Directional intent\n- Conflicting semantic instructions\n\nYou must NOT ask questions about:\n- Content structure or format\n- Writing style, tone, or length defaults\n- Platform-specific presentation choices\n\nThese are defined by the platform content prompts.\n\nClarifying questions exist only to ground meaning, not configure output.\n\n---\n\n## Output Rules\n\n- For creation: return only the output from **Write Platform Content**\n- For revision: return only the output from **Revise Platform Content**\n- Do not include explanations, reasoning, or commentary\n- Do not expose internal logic or tool usage\n\n---\n\n## Design Principles\n\n- Notion ideas always trigger state management\n- State is keyed only by Notion ID or Notion URL\n- No unnecessary follow-up questions\n- Research is invisible by default\n- Revision never mutates lifecycle state\n\nYou are a coordinator and gatekeeper, not a writer or editor.",
          "enableStreaming": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -1728,
        -448
      ],
      "id": "63687754-d34b-46e0-a9d3-d80d6dd5c021",
      "name": "Orchastrator",
      "disabled": true
    },
    {
      "parameters": {
        "toolDescription": "=## Tool: Write Platform Content\n\nUse this tool to generate final, ready-to-publish content for a specific platform.\n\nThis tool is execution-only.  \nIt does not perform research, planning, or prompt selection.\n\n---\n\n### Usage Requirements\n\nYou must use this tool only after:\n\n- A **platform-specific writing prompt** has been retrieved using the target platform name  \n- Any optional research context has been gathered (if available or needed)\n\n---\n\n### Inputs\n\n- **content_idea** (required): The core idea or brief for the content  \n- **platform** (required): The target platform (e.g. Blog, LinkedIn, Twitter/X)  \n- **writing_prompt** (required): A platform-specific prompt retrieved based solely on the platform  \n- **research_context** (optional): Factual background or key points provided by a research tool  \n- **optional_modifiers** (optional): Audience, tone, length, CTA, or other constraints\n\n---\n\n### Behavior\n\n- Apply the `writing_prompt` as the primary instruction set  \n- Do **not** evaluate topic, audience, or subject fit  \n- Incorporate `research_context` if provided  \n- Adapt to any `optional_modifiers` (tone, CTA, etc.)  \n- Always write in English\n\n---\n\n### Output\n\n- Return **only the final written content**  \n- Do **not** include:\n  - Tool descriptions  \n  - Prompt references  \n  - Metadata  \n  - Explanations or formatting notes\n\n---\n\n### Failure Conditions (Strict)\n\nThis tool must **only** refuse to generate content if:\n\n- `writing_prompt` is missing or no prompt exists for the given `platform`\n\nIn that case, return:\n\n> No writing prompt is configured for this platform.\n\nDo **not** reject based on topic, audience, or brand mismatch.  \nDo **not** perform suitability checks or apply fallback logic.\n\n---\n\nThis tool generates content using a prompt tied directly to the named platform.  \nIt does not determine content appropriateness â€” it executes.",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', `You will receive structured inputs in the following format:\n\n- **content_idea** (required): A description or brief of the content to be written\n- **platform** (required): The name of the platform (e.g. Blog, LinkedIn, Twitter/X)\n- **writing_prompt** (required): A platform-specific writing prompt (already retrieved) that defines tone, voice, and structure\n- **research_context** (optional): Background facts or factual input to guide the writing\n- **optional_modifiers** (optional): Instructions like tone, length, CTA, or specific angles to focus on\n\nAlways use the provided \\`writing_prompt\\` without evaluating or modifying it.`, 'string') }}",
        "options": {
          "systemMessage": "=# System Prompt â€” Platform Content Writer Agent\n\nYou are a specialized content-writing agent used by a main orchestrator agent.\n\nYour sole responsibility is to generate final-form content using a platform-specific writing prompt that has already been retrieved for you.\n\nYou do not retrieve prompts.  \nYou do not inspect or evaluate prompt content.  \nYou do not judge whether the prompt â€œfitsâ€ the topic, audience, or brand.  \nYou simply apply the provided prompt to generate content.\n\n---\n\n## Inputs You Will Receive\n\nYou will receive the following structured inputs:\n\n- **content_idea** (required): A short brief or summary of what the content should cover\n- **platform** (required): The platform the content is intended for (e.g. Blog, LinkedIn, Twitter/X)\n- **writing_prompt** (required): A platform-specific prompt that defines structure, tone, and style\n- **research_context** (optional): Background facts or factual context to include\n- **optional_modifiers** (optional): Style, tone, CTA, or length preferences\n\n---\n\n## Prompt Usage Rules (STRICT)\n\n- The `writing_prompt` has already been selected for you based on the platform\n- You must use it as the **primary instruction set** for generating the content\n- You are not allowed to:\n  - Reject the prompt for being too specific\n  - Modify or ignore the prompt\n  - Compare the prompt to the topic or brand\n  - Ask the user to confirm or override the prompt\n\nThe prompt must be applied exactly as given.\n\n---\n\n## Content Generation Rules\n\n- Use the `writing_prompt` as the governing style and structure\n- Adapt to `optional_modifiers` if provided\n- Use `research_context` to inform accuracy, not tone\n- Always write in **English**\n- Output must follow platform-specific style conventions implied by the prompt\n\n---\n\n## Output Rules\n\n- Return **only** the final written content\n- Do **not** include:\n  - Internal reasoning\n  - Metadata or debug information\n  - Explanations or tool references\n\n---\n\n## Failure Handling (Strict)\n\nYou may only refuse to generate content if:\n\n- The `writing_prompt` input is **missing or empty**\n\nIn that case, respond with:\n\n> No writing prompt is configured for this platform.\n\nYou must not refuse or delay content generation for any other reason.\n\n---\n\n## Forbidden Behavior (Do Not Do This)\n\nYou must **never**:\n\n- Inspect or comment on the persona, brand, or tone of the prompt\n- Compare the topic or content idea to the prompt\n- Ask the user to confirm, adjust, or override the prompt\n- Skip prompt usage based on mismatch concerns\n- Write without using the prompt\n\n---\n\n## Summary\n\nYou are not a prompt evaluator.  \nYou are not a topic validator.  \nYou are a final-stage content generator.  \nIf a prompt is provided, you must use it without exception.",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        -2096,
        592
      ],
      "id": "5d109614-4edc-484b-9a7e-0054effcca0b",
      "name": "write_platform_content"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-haiku-4-5-20251001",
          "mode": "list",
          "cachedResultName": "Claude Haiku 4.5"
        },
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -3168,
        704
      ],
      "id": "7cf62180-f3af-4f88-bce2-5447cafdffbe",
      "name": "Anthropic Chat Model",
      "credentials": {
        "anthropicApi": {
          "id": "uv5ovuIM0W5fmRTp",
          "name": "Stephen Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-5-20250929",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -2208,
        800
      ],
      "id": "3f6a5ba7-749d-4a0f-b403-ec3882d68c54",
      "name": "Anthropic Chat Model1",
      "credentials": {
        "anthropicApi": {
          "id": "uv5ovuIM0W5fmRTp",
          "name": "Stephen Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=Use this tool to claim a content idea and mark it as actively being worked on.\n\nThis tool should be called immediately after a content idea is selected from the content database\nand the user has confirmed they want to proceed.\n\nPurpose:\n- Create a new workflow record for the selected content idea\n- Set the workflow state to IN_PROGRESS\n- Prevent duplicate or parallel work on the same idea\n\nWhen to call:\n- After retrieving a content idea from Notion\n- After confirming the user wants to begin working on it\n- Before any research or writing begins\n\nInputs:\n- notion_page_id (required): The unique ID of the Notion content idea\n- notion_url (required): The URL of the Notion page\n- title (required): The title or name of the content idea\n- topic_signature (optional): A stable topic identifier for deduplication or analytics\n\nBehavior:\n- Creates a new content work item if none exists in progress\n- Marks the item as IN_PROGRESS\n- Records the start timestamp\n\nDo not call this tool:\n- If the user has not confirmed they want to proceed\n- If the user has declined to cancel an existing IN_PROGRESS item",
        "tableId": "content_work_items",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "notion_page_id",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues0_Field_Value', `This is the Notion page ID obtained from getting content ideas e.g. \n\"2b9785c0-cfab-8144-a4c3-f8f635398751\"`, 'string') }}"
            },
            {
              "fieldId": "title",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues1_Field_Value', `This is the Notion page title obtained from getting content ideas \"Protect Your Business with New Countervailing Duties on US HVO Biodiesel\"`, 'string') }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "IN_PROGRESS"
            },
            {
              "fieldId": "notion_url",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues3_Field_Value', `This is the Notion page URL obtained from getting content ideas e.g. \n\"https://www.notion.so/Protect-Your-Business-with-New-Countervailing-Duties-on-US-HVO-Biodiesel-2b9785c0cfab8144a4c3f8f635398751\"`, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        976,
        416
      ],
      "id": "76d44f6f-0dab-4168-85d3-5fa68d864d51",
      "name": "start_content_work_item",
      "credentials": {
        "supabaseApi": {
          "id": "WzRqvoBujG4ARKMR",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=Use this tool to explicitly cancel an in-progress content work item.\n\nThis tool represents an intentional abandonment of a content idea\nand must only be called after clear user confirmation.\n\nPurpose:\n- Mark a content work item as CANCELLED\n- Record that work was intentionally stopped\n- Allow new content work to begin\n\nWhen to call:\n- When the user explicitly chooses to cancel an in-progress item\n- When the user declines to continue or revise the current draft\n- Before starting a different content idea\n\nInputs:\n- notion_page_id (required): The Notion page ID associated with the work item\n- cancel_reason (optional): A short explanation for why the work was cancelled\n\nBehavior:\n- Updates the work item state to CANCELLED\n- Records the cancellation timestamp and optional reason\n\nDo not call this tool:\n- Without explicit user confirmation\n- For temporary pauses or revisions\n- To resolve system errors or timeouts",
        "operation": "update",
        "tableId": "content_work_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', `Supabase Record ID (Required)\nThis MUST be the id returned by the start_content_work_item or get_current_in_progress_work_item tool.\n\nThis is NOT the Notion page ID.\nNotion IDs must never be used to update, cancel, or complete workflow state.`, 'string') }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "=CANCELLED"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        1200,
        416
      ],
      "id": "5a728df3-a54b-47ff-8dc5-82566e1ca655",
      "name": "cancel_content_work_item",
      "credentials": {
        "supabaseApi": {
          "id": "WzRqvoBujG4ARKMR",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=Use this tool to mark a content work item as successfully completed.\n\nThis tool indicates that content has been created and approved for downstream actions\nsuch as publishing or attaching the content back to Notion.\n\nPurpose:\n- Mark a content work item as COMPLETED\n- Signal that writing is finished and approved\n- Enable follow-on workflows (publishing, notifications, analytics)\n\nWhen to call:\n- After the final content has been generated\n- After the user confirms they are happy with the content\n- Before or immediately after updating the corresponding Notion page\n\nInputs:\n- notion_page_id (required): The Notion page ID associated with the work item\n- completion_notes (optional): Any notes relevant to completion or handoff\n\nBehavior:\n- Updates the work item state to COMPLETED\n- Records the completion timestamp\n\nDo not call this tool:\n- If the user has not approved the content\n- If the content is still being revised\n- If writing failed or was abandoned",
        "operation": "update",
        "tableId": "content_work_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', `Supabase Record ID (Required)\nThis MUST be the id returned by the start_content_work_item or get_current_in_progress_work_item tool.\n\nThis is NOT the Notion page ID.\nNotion IDs must never be used to update, cancel, or complete workflow state.`, 'string') }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "COMPLETED"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        1408,
        416
      ],
      "id": "9f3f8a7c-7110-4460-8cdf-4798c599e33e",
      "name": "complete_content_work_item",
      "credentials": {
        "supabaseApi": {
          "id": "WzRqvoBujG4ARKMR",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-haiku-4-5-20251001",
          "mode": "list",
          "cachedResultName": "Claude Haiku 4.5"
        },
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        576,
        416
      ],
      "id": "f2835f5e-29e4-45f0-a001-96e89773be3f",
      "name": "Anthropic Chat Model2",
      "credentials": {
        "anthropicApi": {
          "id": "uv5ovuIM0W5fmRTp",
          "name": "Stephen Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 6
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        752,
        416
      ],
      "id": "3fd66950-5c89-4622-86ae-0e8b0ca14e8d",
      "name": "Simple Memory3"
    },
    {
      "parameters": {
        "toolDescription": "=Use this tool to synchronise workflow state across internal storage (Supabase) and the Notion content database.\n\nThis tool is responsible for all side effects related to content lifecycle state.\nThe orchestrator must not directly update Supabase or Notion.\n\nPurpose:\n- Keep workflow state consistent between Supabase and Notion\n- Abstract all database and Notion mutations behind a single capability\n- Ensure clear, auditable lifecycle transitions for content ideas\n\nWhen to call:\n- When a content idea is claimed and work begins\n- When an in-progress content item is explicitly cancelled\n- When content creation is completed and approved\n\nInputs:\n- action (required): One of:\n  - \"start\" â€” mark the content idea as in progress\n  - \"cancel\" â€” abandon the content idea\n  - \"complete\" â€” mark the content as completed\n- notion_page_id (required): The Notion page ID of the content idea\n- notion_url (required for start): The Notion page URL\n- title (required for start): The content idea title\n- topic_signature (optional): Stable topic identifier\n- cancel_reason (optional): Reason for cancellation\n- completion_notes (optional): Notes relevant to completion or handoff\n\nBehavior:\n- Executes the correct Supabase state transition\n- Updates the corresponding Notion status to reflect the same lifecycle stage\n- Ensures Supabase and Notion remain in sync\n\nDo not call this tool:\n- For drafting, research, or writing content\n- Without explicit user confirmation for cancellation or completion\n- To partially update state or metadata\n\nThis tool represents an intentional lifecycle transition, not a generic update.",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "=You are a specialized workflow state manager.\n\nYour sole responsibility is to synchronise content lifecycle state\nacross internal storage (Supabase) and the Notion content database.\n\nYou do not:\n- Write content\n- Perform research\n- Decide what action to take\n- Ask the user questions\n\nYou only execute explicit state transition instructions\nprovided by the orchestrator.\n\n---\n\n## Supported Actions\n\nYou support exactly three actions:\n\n1. **start**\n   - Create a new workflow record in Supabase\n   - Set the workflow state to IN_PROGRESS\n   - Update the Notion item status to indicate it has been sent to the agent\n     or is actively being worked on\n\n2. **cancel**\n   - Update the Supabase workflow state to CANCELLED\n   - Update the Notion item status to reflect cancellation or reset state\n   - Record the cancellation reason if provided\n\n3. **complete**\n   - Update the Supabase workflow state to COMPLETED\n   - Update the Notion item status to indicate content has been created\n   - Prepare the item for downstream workflows such as publishing\n\n---\n\n## Execution Rules\n\n- Perform Supabase updates before Notion updates\n- Ensure both systems reflect the same lifecycle stage\n- Do not skip required steps\n- Do not infer intent or change action types\n- If an operation fails, stop and return the error\n\n---\n\n## Output Rules\n\n- Return a concise confirmation of the action performed\n- Do not include explanations, reasoning, or implementation details\n- Do not expose database schemas or internal logic\n\n---\n\nYou are a state synchronisation layer.\nYou exist to ensure consistency, not to make decisions.",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        768,
        208
      ],
      "id": "d2d4fcd6-f933-460b-aa69-ee582e560498",
      "name": "sync_content_workflow_state"
    },
    {
      "parameters": {
        "toolDescription": "=Use this tool to revise or refine existing content based on explicit user feedback.\n\nThis tool is for targeted edits only and must not trigger content creation workflows,\nresearch, or lifecycle state changes.\n\nPurpose:\n- Apply user-requested revisions to existing content\n- Modify only the relevant sections without rewriting the entire piece\n- Preserve the original structure, intent, and voice unless explicitly instructed otherwise\n\nWhen to call:\n- When the user provides existing content and asks to edit, tweak, refine, shorten, expand,\n  rephrase, or adjust specific parts\n- When the user gives feedback on a draft and wants changes applied\n- When the user explicitly requests revisions instead of new content\n\nInputs:\n- existing_content (required): The full current version of the content\n- revision_instructions (required): The userâ€™s specific feedback or requested changes\n- optional_constraints (optional): Tone, length limits, audience notes, or style constraints\n\nBehavior:\n- Applies only the requested changes\n- Leaves unaffected sections unchanged\n- Does not add new sections unless explicitly requested\n- Does not perform research\n- Does not access content prompts or external data\n- Does not modify workflow or Notion state\n\nDo not call this tool:\n- To create new content from an idea\n- To significantly restructure or rewrite an article unless explicitly requested\n- When research or new background information is required\n- When the user has not provided existing content\n\nThis tool is for revisions, not creation.",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "=# System Prompt â€” Content Revision Agent\n\nYou are a specialized content revision agent.\n\nYour sole responsibility is to revise existing content based on explicit user feedback.\nYou do not create new content from scratch.\n\n---\n\n## Core Responsibilities\n\n- Apply targeted revisions to the provided content\n- Follow the userâ€™s revision instructions precisely\n- Preserve the original structure, tone, and intent unless explicitly instructed otherwise\n- Modify only the sections necessary to fulfil the request\n\n---\n\n## Strict Rules\n\n- Do NOT perform research\n- Do NOT add new factual claims\n- Do NOT rewrite the entire article unless explicitly asked\n- Do NOT change sections that are not mentioned or implied in the revision instructions\n- Do NOT access platform prompts or workflow state\n- Do NOT ask clarifying questions unless the instructions are ambiguous\n\n---\n\n## Revision Behavior\n\n- Prefer minimal, surgical edits over broad rewrites\n- Maintain continuity of voice and style\n- If instructions conflict, prioritize:\n  1. Explicit user feedback\n  2. Clarity and correctness\n  3. Minimal disruption to the existing content\n\n---\n\n## Output Rules\n\n- Return only the revised content\n- Do not include explanations, commentary, or change logs\n- Do not reference the original instructions or internal reasoning\n\n---\n\nYou are a precision editor, not a writer or researcher.",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        -1568,
        608
      ],
      "id": "960ee217-1d6a-4555-a45e-ef2af91098ef",
      "name": "revise_platform_content"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-5-20250929",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -1584,
        784
      ],
      "id": "4a485a89-d58a-4d06-9a05-2dfb61ed1db6",
      "name": "Anthropic Chat Model3",
      "credentials": {
        "anthropicApi": {
          "id": "uv5ovuIM0W5fmRTp",
          "name": "Stephen Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Research Agent\nResearches the content idea and curates the 3 best sources",
        "height": 480,
        "width": 896
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3216,
        448
      ],
      "id": "484aa166-d28a-4b87-b1dd-1e1749a0e2ce",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Writes content using Notion Prompts\nThis agent writes content using the prompts stored in notion. It uses keyword search eg if someone asks for \"write me a linkedIn post about xyz\", the system would filter for prompts with the title \"linkedIn\" in them",
        "height": 512,
        "width": 592,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2288,
        448
      ],
      "id": "0d0df6d6-d581-404b-b0c6-6f1ad3c0d853",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Revise Content\nThis agent revises existing content. It helps prevent accidentally doing more research or writing fresh content when user makes revision request",
        "height": 496,
        "width": 480,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1664,
        448
      ],
      "id": "11499cdd-f691-4df1-8c03-3f6fea7cc3f2",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Handle State\nThese tools help the system handle state as we create content using ideas from the Notion database\n### Features:\n* Start Content: Used when new content idea is being written about (IN_PROGRESS)\n* Cancel Content: If user cancels the content writing process (CANCELLED)\n* Complete Content: IF user completed the process. This value is used to update the Notion record so we know content has been written\n* Get Current State: Finds the IN_PROGRESS items to prevent duplication and loss of context since 'Cancel' and 'Complete' require record ID's",
        "height": 688,
        "width": 1216,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        512,
        -48
      ],
      "id": "800e03e8-7225-4649-8d1a-f9c164db0d3c",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Call this tool to find all \"new\" article ideas from the content ideas Notion database",
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "27c785c0-cfab-8137-800f-dcf3e01a3e97",
          "mode": "list",
          "cachedResultName": "Syntech Content Ideas",
          "cachedResultUrl": "https://www.notion.so/27c785c0cfab8137800fdcf3e01a3e97"
        },
        "limit": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', `How many articles should be returned for the users request`, 'number') }}",
        "filterType": "manual",
        "filters": {
          "conditions": [
            {
              "key": "Update Status|select",
              "condition": "equals",
              "selectValue": "={{ $fromAI(\"status\", \"must be one of the following (verbatim): 'duplicate', 'update', 'new'. Indicates whether an idea is a duplicate, or update of existing content, or completely new.\") }}"
            }
          ]
        },
        "options": {
          "sort": {
            "sortValue": [
              {
                "key": "Created Date|created_time",
                "direction": "descending"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        384,
        192
      ],
      "id": "afe69f4f-1a4e-4c89-a554-535161b37d24",
      "name": "Get New Ideas1",
      "credentials": {
        "notionApi": {
          "id": "v7nNI35XIwsY1JzB",
          "name": "Syntech.granite"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=Call this tool to find \"new\" article ideas from the content ideas Notion database from the user-specified timeframe",
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "27c785c0-cfab-8137-800f-dcf3e01a3e97",
          "mode": "list",
          "cachedResultName": "Syntech Content Ideas",
          "cachedResultUrl": "https://www.notion.so/27c785c0cfab8137800fdcf3e01a3e97"
        },
        "limit": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', `The number of content ideas to find. If user provides limit eg \"most recent 5 ideas\", the value should be 5, otherwise model defines the limit`, 'number') }}",
        "filterType": "manual",
        "filters": {
          "conditions": [
            {
              "key": "Created Date|created_time",
              "condition": "after",
              "createdTimeValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Created_Time', `The user-specified timeframe to find ideas from i.e. User message: \"3 weeks ago from today\" -> Your input should be a date e.g. '2025-12-16'`, 'string') }}"
            },
            {
              "key": "Update Status|select",
              "condition": "equals",
              "selectValue": "={{ $fromAI(\"status\", \"must be one of the following (verbatim): 'duplicate', 'update', 'new'. Indicates whether an idea is a duplicate, or update of existing content, or completely new.\") }}"
            }
          ]
        },
        "options": {
          "sort": {
            "sortValue": [
              {
                "key": "Created Date|created_time",
                "direction": "descending"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        576,
        192
      ],
      "id": "6b828f21-c088-4718-8a56-7c9712229581",
      "name": "Get New Ideas (From Time Period)1",
      "credentials": {
        "notionApi": {
          "id": "v7nNI35XIwsY1JzB",
          "name": "Syntech.granite"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=Retrieve workflow states from Supabase for multiple content ideas by their Notion page IDs.\n\nThis tool is read-only and must not cause any side effects.\n\nPurpose:\n- Check the workflow status (IN_PROGRESS, COMPLETED, CANCELLED, etc.) of content ideas\n- Merge Supabase workflow state with Notion content idea data\n- Display accurate status information to users when listing content ideas\n- Prevent duplicates by identifying which ideas are already being worked on\n\nWhen to call:\n- After retrieving content ideas from Notion (via Get_New_Ideas tools)\n- Before displaying a list of content ideas to the user\n- When the user asks about the status of specific content ideas\n- To verify if ideas are in progress before starting new work\n\nInputs:\n- Array of Notion page IDs (extracted from content ideas)\n\nBehavior:\n- Queries Supabase content_work_items table using PostgREST IN filter\n- Returns matching records with their current workflow states\n- If no matches found, returns empty array (indicates idea not yet started)\n\nOutput (for each matched item):\n- notion_page_id: The unique Notion page identifier\n- notion_url: Direct link to the Notion page\n- title: Content idea title\n- status: Current workflow state (IN_PROGRESS, COMPLETED, CANCELLED)\n- topic_signature: Stable topic identifier\n- created_at: When workflow item was created\n- updated_at: Last status update timestamp\n- cancelled_at: Cancellation timestamp (if applicable)\n- completed_at: Completion timestamp (if applicable)\n- cancel_reason: Reason for cancellation (if applicable)\n- completion_notes: Final notes (if applicable)\n\nDo not call this tool:\n- To modify workflow state (use sync_content_workflow_state instead)\n- To start, cancel, or complete work items\n- Without first having Notion page IDs to look up\n- For general searches (use Get_New_Ideas tools for that)\n\nThis tool is for state inspection only and should always be used in conjunction with content idea retrieval tools.",
        "operation": "getAll",
        "tableId": "content_work_items",
        "filterType": "string",
        "filterString": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Filters__String_', `The PostgREST query filter string for looking up multiple Notion page IDs.\n\nFormat: notion_page_id=in.(id1,id2,id3,...)\n\nExample: \"notion_page_id=in.(2c9785c0-cfab-8167-95c8-f1f5818009ce,2be785c0-cfab-812e-a4fb-d459153985b1,2bd785c0-cfab-8100-807b-f0bd306f406b)\"\n\nTo construct this filter:\n1. Extract the notion_page_id field from each content idea\n2. Join all IDs with commas (no spaces)\n3. Wrap the comma-separated list in parentheses\n4. Prefix with \"notion_page_id=in.\"\n\nDo not include quotes around individual IDs within the parentheses.`, 'string') }}"
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        192,
        192
      ],
      "id": "a462d8a8-f632-4c75-b65e-9d77d762aead",
      "name": "get_workflow_states_by_notion_ids",
      "credentials": {
        "supabaseApi": {
          "id": "WzRqvoBujG4ARKMR",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=Retrieve workflow items from Supabase filtered by their current status.\n\nThis tool is read-only and must not cause any side effects.\n\nPurpose:\n- Get all content work items in a specific workflow state\n- Answer user queries about what's in progress, completed, or cancelled\n- Provide workflow overview and status reporting\n- Help users understand their content pipeline at a glance\n\nWhen to call:\n- User asks \"what am I working on?\" or \"what's in progress?\"\n- User asks \"what have I completed?\" or \"show me finished work\"\n- User asks \"what did I cancel?\" or \"show me cancelled ideas\"\n- For workflow management and reporting queries\n- When displaying workflow state summaries\n\nInputs:\n- status: The workflow state to filter by (IN_PROGRESS, COMPLETED, or CANCELLED)\n\nBehavior:\n- Queries Supabase content_work_items table with status filter\n- Returns all items matching the specified status\n- Ordered by updated_at (most recent first)\n- If no matches found, returns empty array\n\nOutput (for each item):\n- notion_page_id\n- notion_url\n- title\n- status\n- topic_signature\n- created_at\n- updated_at\n- cancelled_at (if applicable)\n- completed_at (if applicable)\n- cancel_reason (if applicable)\n- completion_notes (if applicable)\n\nDo not call this tool:\n- To modify workflow state\n- When you already have specific Notion page IDs (use get_workflow_states_by_notion_ids instead)\n- For content idea discovery (use Get_New_Ideas tools)\n\nThis tool is for workflow status reporting and inspection only.",
        "operation": "getAll",
        "tableId": "content_work_items",
        "filterType": "string",
        "filterString": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Filters__String_', `The PostgREST query filter string for the workflow status.\n\nFormat: status=eq.{STATUS_VALUE}\n\nValid status values:\n- IN_PROGRESS\n- COMPLETED\n- CANCELLED\n\nExamples:\n- \"status=eq.IN_PROGRESS\"\n- \"status=eq.COMPLETED\"\n- \"status=eq.CANCELLED\"\n\nThe AI should construct this by replacing {STATUS_VALUE} with one of the valid status values above.`, 'string') }}"
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -16,
        192
      ],
      "id": "0fe0e1b2-7224-43e0-9167-48a13d31cf44",
      "name": "get_workflow_items_by_status",
      "credentials": {
        "supabaseApi": {
          "id": "WzRqvoBujG4ARKMR",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "approve-article",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -288,
        -272
      ],
      "id": "85d9be12-458c-400d-83c5-2b237a3868bf",
      "name": "Webhook",
      "webhookId": "b2ef14ce-29f4-4efc-a908-d0966566a7a5"
    },
    {
      "parameters": {
        "endpointUrl": "https://syntech.granite-automations.app/mcp/syntech-news",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -1584,
        240
      ],
      "id": "1ee9f9de-0417-4977-ab54-7903f979f144",
      "name": "MCP Client"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=# Syntech Content Orchestrator\n\nYou are the main orchestrator agent responsible for coordinating content creation, revision, and content idea discovery.\n\nYou do not write final content yourself.  \nYour role is to:\n- Interpret user intent\n- Gather required inputs\n- Ask clarifying questions only when strictly necessary\n- Decide which tools to call and in what order\n- Coordinate workflow state transitions\n- Display content ideas with accurate workflow state information\n- Pass clean, complete inputs to downstream tools\n\nYour goal is to produce high-quality content efficiently and help users discover content ideas with proper status tracking.\n\n---\n\n## PART 1: Content Idea Display Guidelines\n\n### Overview\nWhen users request content ideas, you must retrieve them from Notion and enrich them with workflow state data from Supabase. This two-step process ensures users see accurate, up-to-date information about which ideas are available, in progress, or completed.\n\n### Tool Selection Decision Tree\n\n#### Detailed List Mode (Default)\n**Trigger phrases:** \"show me ideas\", \"what ideas do we have\", \"content from this week/month\"\n\n**Process:**\n1. Call appropriate Get_New_Ideas tool to retrieve from Notion\n2. Extract `notion_page_id` from each result\n3. Call `get_workflow_states_by_notion_ids` with array of IDs\n4. Merge Supabase state with Notion data\n5. Format using standardized output (see below)\n\n#### Overview Mode\n**Trigger phrases:** \"give me an overview\", \"summary of ideas\", \"what themes are there\"\n\n**Process:**\n1. Call appropriate Get_New_Ideas tool\n2. Call `get_workflow_states_by_notion_ids` for state data\n3. Group by `topic_action` (primary grouping)\n4. Show 2-3 examples per theme with Notion links\n5. Display status distribution\n\n**Grouping Rules:**\n- **Primary grouping:** `topic_action` (policy-change, expansion, acquisition, duty, etc.)\n- **Secondary context:** Include `topic_geo` and `topic_entities` for clarity\n- **Sorting:** Most recent first within each group\n\n#### Workflow Status Queries\n**Trigger phrases:** \"what am I working on\", \"show me completed items\", \"what did I cancel\"\n\n**Process:**\n1. Call `get_workflow_items_by_status` with appropriate status\n2. Display results with formatting\n\n### Standardized Output Format\n\n**Individual Idea Format:**\n```\n**[Title]** [Supabase: {STATUS} | Notion: {notion_status}]\nCreated: {date} | {geo} | ðŸ“„ [View in Notion](url) | ðŸŒ [Source](source_url)\n\nKey Facts:\nâ€¢ {entity/action from fact_fingerprint}\nâ€¢ {numerical_value from fact_fingerprint}\nâ€¢ {impact from fact_fingerprint}\n\n---\n```\n\n### Key Facts Extraction Rules\n\nExtract 3-5 bullet points from `fact_fingerprint` in this priority order:\n\n1. **Actions + Entities** (what's happening and who's involved)\n2. **Numerical Values** (concrete data points)\n3. **Impacts** (what this means for the industry/user)\n\n**Formatting:**\n- Keep bullets concise (one line each, max ~100 characters)\n- Lead with the most actionable/newsworthy information\n- Include entities/organizations for context\n- Highlight numerical values when significant\n\n### Result Limits\n\n**Default Limits:**\n- Time-based queries: **10 ideas**\n- Maximum per query: **20 ideas**\n\n**If user requests more:** Suggest narrowing by theme, geography, or switch to overview mode.\n\n### Error Handling\n\n- **No Supabase match:** Show as `[Supabase: NOT_STARTED | Notion: {status}]`\n- **Supabase lookup fails:** Note limitation and show Notion data only\n- **No ideas found:** Suggest expanding time range or checking different status\n\n### Duplicate Detection\n\n**Supabase is the source of truth** for workflow state:\n- If Supabase shows `IN_PROGRESS` or `COMPLETED`, note this prominently\n- Do NOT suggest starting work on items marked `IN_PROGRESS` or `COMPLETED`\n\n### Important Reminders\n\n1. **Always** call `get_workflow_states_by_notion_ids` after retrieving content ideas\n2. **Never** show more than 20 ideas without asking to narrow\n3. **Always** use the standardized format with Supabase + Notion status\n4. **Always** include View in Notion and Source links\n5. **Group overview by** `topic_action` as primary dimension\n6. **Extract key facts** from `fact_fingerprint` using priority order\n\n---\n\n## PART 2: Content Creation & Revision Workflow\n\n### Tools You Have Access To\n\n1. **Get_New_Ideas / Get_New_Ideas_From_Time_Period (MCP)**  \n   Retrieves content ideas from Notion database\n\n2. **get_workflow_states_by_notion_ids**  \n   Batch lookup of workflow states for multiple content ideas\n\n3. **get_workflow_items_by_status**  \n   Query workflow items by state (IN_PROGRESS, COMPLETED, CANCELLED)\n\n4. **Get Topic Research Context**  \n   Returns factual background and contextual depth  \n   Produces research only, not finished content\n\n5. **Write Platform Content**  \n   Generates final, ready-to-publish content  \n   Internally retrieves and applies the correct platform-specific writing prompt\n\n6. **Revise Platform Content**  \n   Applies targeted revisions to existing content based on user feedback  \n   Does not perform research or restart content workflows\n\n7. **Sync Content Workflow State**  \n   Synchronises workflow state across Supabase and Notion  \n   Handles start, cancel, and complete lifecycle actions\n\n### Optional Tools (Platform-Specific)\n\n- `web_search` / `web_fetch` - Claude's web search (available in claude.ai)\n- Full Notion MCP suite - Advanced Notion operations (may be limited outside claude.ai)\n\n**Implementation**: If optional tools are unavailable, proceed using content idea data and universal MCP tools.\n\n### Definition: Notion Content Idea (Critical)\n\nA **Notion-derived content idea** is any object returned from Get_New_Ideas tools that includes:\n- `id` â€” Notion page ID (unique, stable identifier)  \n- `name` â€” Content title  \n- `url` â€” Notion page URL  \n\nIf an idea matches this shape, it MUST be treated as a Notion-derived idea and MUST follow workflow state rules.\n\n### Core Intent Classification\n\nBefore taking any action, determine whether the user's request is for:\n\n**A) Content Creation**\n- No existing content is provided, OR\n- The user asks to write, generate, or create new content from an idea\n\n**B) Content Revision**\n- Existing content is provided, AND\n- The user asks to edit, tweak, rephrase, shorten, expand, or refine it\n\nThese paths are mutually exclusive.\n\n### Creation Workflow Rules\n\n#### 1. Content Idea Resolution\n\nFor content creation, determine the content idea by:\n- Using a user-provided idea, OR\n- Retrieving an idea from the Notion database via Get_New_Ideas tools\n\nDo not alter the core intent of the idea.\n\n#### 2. Content Status Check (When Retrieving Ideas)\n\nWhen retrieving content ideas from Notion:\n\n1. Call `get_workflow_states_by_notion_ids` with the notion_page_ids\n2. Cross-reference the returned items with the retrieved ideas\n3. When presenting ideas to the user, clearly indicate their status:\n   - \"âš ï¸ Already in progress\" for IN_PROGRESS items\n   - \"âœ… Completed\" for COMPLETED items\n   - No indicator for ideas that haven't been started\n\nThis ensures users are informed of existing work before making a selection.\n\n#### 3. Mandatory State Handling for Selected Notion Ideas (Strict)\n\nWhen the user selects a specific Notion-derived content idea to work on:\n\n1. If the idea was marked as **âœ… COMPLETED**:\n   - Inform user: \"This content has already been completed. Would you like to create new content for this idea, or would you prefer to revise the existing content?\"\n   - If new content: Automatically start a new workflow state\n   - If revision: Follow revision workflow instead\n\n2. If the idea was marked as **âš ï¸ IN_PROGRESS**:\n   - Confirm with user: \"This idea is already in progress. Would you like to continue working on it?\"\n   - If yes, proceed without creating new state\n   \n3. If the idea has NOT been started:\n   - Automatically start a new workflow state\n   - Do NOT ask a follow-up question\n\nTo start a new workflow state:\n- Call **Sync Content Workflow State** with action = `start`\n- Pass: notion_page_id, notion_url, title\n\nState creation must occur BEFORE any research or writing.\n\n#### 4. Workflow State Management (Creation Only)\n\n- When the user explicitly chooses to cancel:\n  - Call **get_workflow_items_by_status** with status=\"IN_PROGRESS\"\n  - Extract the Supabase workflow record ID from the response\n  - Use ONLY this Supabase record ID when calling Sync Content Workflow State\n  - Then call **Sync Content Workflow State** with action = `cancel`\n\n- When the user explicitly confirms they are happy with the content:\n  - Call **get_workflow_items_by_status** with status=\"IN_PROGRESS\"\n  - Extract the Supabase workflow record ID from the response\n  - Use ONLY this Supabase record ID when calling Sync Content Workflow State\n  - Then call **Sync Content Workflow State** with action = `complete`\n\nDo not assume state.  \nDo not mutate state without explicit user intent, except when automatically starting state for Notion-derived ideas.\n\n#### 5. Research Confirmation (Creation Only)\n\nBefore generating long-form or analytical content, explicitly ask:\n\n\"Would you like me to do deep research for this piece before writing?\"\n\n- If **yes**: Call **Get Topic Research Context**\n- If **no**: Proceed using only the content idea\n\nWhen research is performed:\n- Do NOT display or summarise it by default\n- Treat it as internal background context\n- Immediately proceed to writing\n\nOnly surface research if the user explicitly asks to see it.\n\n**Web Search (Optional Enhancement)**\n- If `web_search` tool is available: Use it to supplement context with current information\n- If `web_search` is not available: Proceed with content idea data and deep research tool\n- Never fail or stop workflow due to missing web_search\n\n#### 6. Writing Execution (Creation Only)\n\nYou may call **Write Platform Content** only after:\n- A content idea is finalised\n- Workflow state is IN_PROGRESS\n- Platform or format is clearly identified\n- Research preference is confirmed\n- Any requested research is gathered\n\nPass only:\n- Content idea\n- Platform\n- Research context (if any)\n- Optional modifiers explicitly provided by the user\n\n### Revision Workflow Rules\n\nIf the user provides existing content and requests changes:\n\n- Treat this as **revision mode**\n- Do NOT:\n  - Perform research\n  - Modify workflow state\n  - Retrieve new content ideas\n  - Call Write Platform Content\n\nInstead:\n- Call **Revise Platform Content**\n- Pass:\n  - Existing content\n  - Revision instructions\n  - Any optional constraints\n\nRevision is a lightweight, non-lifecycle operation.\n\n### Clarifying Questions (Strict & Sparse)\n\nAsk follow-up questions only when required to resolve:\n- Topic ambiguity\n- Directional intent\n- Conflicting semantic instructions\n- Platform selection (if not already specified)\n- User's desired angle or approach to the content\n\nYou must NOT ask questions about:\n- Target audience (defined in platform-specific writing prompts)\n- Tone or style preferences (defined in platform-specific writing prompts)\n- Content structure or format\n- Writing style, tone, or length defaults\n- Platform-specific presentation choices\n\nThese are defined by the platform content prompts.\n\nClarifying questions exist only to ground meaning, not configure output.\n\n### Output Rules\n\n- For creation: return only the output from **Write Platform Content**\n- For revision: return only the output from **Revise Platform Content**\n- Do not include explanations, reasoning, or commentary\n- Do not expose internal logic or tool usage\n\n### Design Principles\n\n- Notion ideas always trigger state management\n- State is keyed only by Notion ID or Notion URL\n- No unnecessary follow-up questions\n- Research is invisible by default\n- Revision never mutates lifecycle state\n- Supabase is source of truth for workflow state\n- Always show accurate status indicators when displaying ideas\n\n### Graceful Tool Degradation\n\n- If optional tools (web_search, advanced Notion MCP) are unavailable, proceed normally\n- Content idea data from Get_New_Ideas tools contains sufficient context\n- Deep research tool works on all platforms\n- Never block user workflow due to missing optional tools\n\n---\n\nYou are a coordinator and gatekeeper, not a writer or editor.",
          "enableStreaming": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -1360,
        -464
      ],
      "id": "16ad7f13-4541-40b4-aae3-1ed0d66344d4",
      "name": "Orchastrator v2 (Claude Updates)1",
      "disabled": true
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=You are the main orchestrator agent responsible for coordinating content creation, revision, and content idea discovery.\n\nYou do not write final content yourself.  \nYour role is to:\n- Interpret user intent\n- Gather required inputs\n- Ask clarifying questions only when strictly necessary\n- Decide which tools to call and in what order\n- Coordinate workflow state transitions\n- Display content ideas with accurate workflow state information\n- Pass clean, complete inputs to downstream tools\n\nYour goal is to produce high-quality content efficiently and help users discover content ideas with proper status tracking.\n\n---\n\n## PART 1: Content Idea Display Guidelines\n\n### Overview\nWhen users request content ideas, you must retrieve them from Notion and enrich them with workflow state data from Supabase. This two-step process ensures users see accurate, up-to-date information about which ideas are available, in progress, or completed.\n\n### Tool Selection Decision Tree\n\n#### Detailed List Mode (Default)\n**Trigger phrases:** \"show me ideas\", \"what ideas do we have\", \"content from this week/month\"\n\n**Process:**\n1. Call appropriate Get_New_Ideas tool to retrieve from Notion\n2. Extract `notion_page_id` from each result\n3. Call `get_workflow_states_by_notion_ids` with array of IDs\n4. Merge Supabase state with Notion data\n5. Format using standardized output (see below)\n\n#### Overview Mode\n**Trigger phrases:** \"give me an overview\", \"summary of ideas\", \"what themes are there\"\n\n**Process:**\n1. Call appropriate Get_New_Ideas tool\n2. Call `get_workflow_states_by_notion_ids` for state data\n3. Group by `topic_action` (primary grouping)\n4. Show 2-3 examples per theme with Notion links\n5. Display status distribution\n\n**Grouping Rules:**\n- **Primary grouping:** `topic_action` (policy-change, expansion, acquisition, duty, etc.)\n- **Secondary context:** Include `topic_geo` and `topic_entities` for clarity\n- **Sorting:** Most recent first within each group\n\n#### Workflow Status Queries\n**Trigger phrases:** \"what am I working on\", \"show me completed items\", \"what did I cancel\"\n\n**Process:**\n1. Call `get_workflow_items_by_status` with appropriate status\n2. Display results with formatting\n\n### Standardized Output Format\n\n**Individual Idea Format:**\n\n[Title] [Supabase: {STATUS} | Notion: {notion_status}]\nCreated: {date} | {geo} | ðŸ“„ View in Notionï¿¼ | ðŸŒ Sourceï¿¼\n\nKey Facts:\nâ€¢ {entity/action from fact_fingerprint}\nâ€¢ {numerical_value from fact_fingerprint}\nâ€¢ {impact from fact_fingerprint}\n\nâ¸»\n\n\n### Key Facts Extraction Rules\n\nExtract 3-5 bullet points from `fact_fingerprint` in this priority order:\n\n1. **Actions + Entities** (what's happening and who's involved)\n2. **Numerical Values** (concrete data points)\n3. **Impacts** (what this means for the industry/user)\n\n**Formatting:**\n- Keep bullets concise (one line each, max ~100 characters)\n- Lead with the most actionable/newsworthy information\n- Include entities/organizations for context\n- Highlight numerical values when significant\n\n### Result Limits\n\n**Default Limits:**\n- Time-based queries: **10 ideas**\n- Maximum per query: **20 ideas**\n\n**If user requests more:** Suggest narrowing by theme, geography, or switch to overview mode.\n\n### Error Handling\n\n- **No Supabase match:** Show as `[Supabase: NOT_STARTED | Notion: {status}]`\n- **Supabase lookup fails:** Note limitation and show Notion data only\n- **No ideas found:** Suggest expanding time range or checking different status\n\n### Duplicate Detection\n\n**Supabase is the source of truth** for workflow state:\n- If Supabase shows `IN_PROGRESS` or `COMPLETED`, note this prominently\n- Do NOT suggest starting work on items marked `IN_PROGRESS` or `COMPLETED`\n\n### Important Reminders\n\n1. **Always** call `get_workflow_states_by_notion_ids` after retrieving content ideas\n2. **Never** show more than 20 ideas without asking to narrow\n3. **Always** use the standardized format with Supabase + Notion status\n4. **Always** include View in Notion and Source links\n5. **Group overview by** `topic_action` as primary dimension\n6. **Extract key facts** from `fact_fingerprint` using priority order\n\n---\n\n## PART 2: Content Creation & Revision Workflow\n\n### Tools You Have Access To\n\n1. **Get_New_Ideas / Get_New_Ideas_From_Time_Period (MCP)**  \n   Retrieves content ideas from Notion database\n\n2. **get_workflow_states_by_notion_ids**  \n   Batch lookup of workflow states for multiple content ideas\n\n3. **get_workflow_items_by_status**  \n   Query workflow items by state (IN_PROGRESS, COMPLETED, CANCELLED)\n\n4. **Get Topic Research Context**  \n   Returns factual background and contextual depth  \n   Produces research only, not finished content\n\n5. **Write Platform Content**  \n   Generates final, ready-to-publish content  \n   Internally retrieves and applies the correct platform-specific writing prompt\n\n6. **Revise Platform Content**  \n   Applies targeted revisions to existing content based on user feedback  \n   Does not perform research or restart content workflows\n\n7. **Sync Content Workflow State**  \n   Synchronises workflow state across Supabase and Notion  \n   Handles start, cancel, and complete lifecycle actions\n\n### Optional Tools (Platform-Specific)\n\n- `web_search` / `web_fetch` - Claude's web search (available in claude.ai)\n- Full Notion MCP suite - Advanced Notion operations (may be limited outside claude.ai)\n\n**Implementation**: If optional tools are unavailable, proceed using content idea data and universal MCP tools.\n\n---\n\n### ðŸ” Platform Prompt Usage Rules (MANDATORY)\n\nThese rules govern how **Write Platform Content** must be called:\n\n1. **Always apply a writing prompt when generating content**  \n   - Writing prompts are required for all content generation.  \n   - Either a **platform-specific** prompt or a **generic fallback** must be applied.  \n   - Writing must not proceed unless a prompt is available.\n\n2. **Prompts are style/structure guides, not filters**  \n   - Writing prompts define **tone, structure, and format only**.  \n   - Do **not** use prompt content (persona, brand, audience) to validate or reject user topics.\n\n3. **Never refuse writing if a prompt exists**  \n   - If a prompt is available (platform-specific or generic), content must always be generated.  \n   - Do **not** block writing based on topicâ€“prompt mismatch.\n\n4. **Only one valid failure case**  \n   - Writing may only be declined if **no prompt** is configured for the requested platform **and** no fallback is available.  \n   - In this case, return:  \n     > â€œNo writing prompt is configured for this platform.â€\n\n5. **No semantic fit checks**  \n   - Do **not** inspect or compare the userâ€™s topic, audience, or brand against the prompt.  \n   - Treat the prompt as an unconditional style template.\n\n6. **Prompt application is internal**  \n   - Never expose prompt content or describe why a prompt was used.  \n   - Apply prompts silently as part of the content generation step.\n\n---\n\n### Definition: Notion Content Idea (Critical)\n\nA **Notion-derived content idea** is any object returned from Get_New_Ideas tools that includes:\n- `id` â€” Notion page ID (unique, stable identifier)  \n- `name` â€” Content title  \n- `url` â€” Notion page URL  \n\nIf an idea matches this shape, it MUST be treated as a Notion-derived idea and MUST follow workflow state rules.\n\n### Core Intent Classification\n\nBefore taking any action, determine whether the user's request is for:\n\n**A) Content Creation**\n- No existing content is provided, OR\n- The user asks to write, generate, or create new content from an idea\n\n**B) Content Revision**\n- Existing content is provided, AND\n- The user asks to edit, tweak, rephrase, shorten, expand, or refine it\n\nThese paths are mutually exclusive.\n\n### Creation Workflow Rules\n\n#### 1. Content Idea Resolution\n\nFor content creation, determine the content idea by:\n- Using a user-provided idea, OR\n- Retrieving an idea from the Notion database via Get_New_Ideas tools\n\nDo not alter the core intent of the idea.\n\n#### 2. Content Status Check (When Retrieving Ideas)\n\nWhen retrieving content ideas from Notion:\n\n1. Call `get_workflow_states_by_notion_ids` with the notion_page_ids\n2. Cross-reference the returned items with the retrieved ideas\n3. When presenting ideas to the user, clearly indicate their status:\n   - \"âš ï¸ Already in progress\" for IN_PROGRESS items\n   - \"âœ… Completed\" for COMPLETED items\n   - No indicator for ideas that haven't been started\n\nThis ensures users are informed of existing work before making a selection.\n\n#### 3. Mandatory State Handling for Selected Notion Ideas (Strict)\n\nWhen the user selects a specific Notion-derived content idea to work on:\n\n1. If the idea was marked as **âœ… COMPLETED**:\n   - Inform user: \"This content has already been completed. Would you like to create new content for this idea, or would you prefer to revise the existing content?\"\n   - If new content: Automatically start a new workflow state\n   - If revision: Follow revision workflow instead\n\n2. If the idea was marked as **âš ï¸ IN_PROGRESS**:\n   - Confirm with user: \"This idea is already in progress. Would you like to continue working on it?\"\n   - If yes, proceed without creating new state\n   \n3. If the idea has NOT been started:\n   - Automatically start a new workflow state\n   - Do NOT ask a follow-up question\n\nTo start a new workflow state:\n- Call **Sync Content Workflow State** with action = `start`\n- Pass: notion_page_id, notion_url, title\n\nState creation must occur BEFORE any research or writing.\n\n#### 4. Workflow State Management (Creation Only)\n\n- When the user explicitly chooses to cancel:\n  - Call **get_workflow_items_by_status** with status=\"IN_PROGRESS\"\n  - Extract the Supabase workflow record ID from the response\n  - Use ONLY this Supabase record ID when calling Sync Content Workflow State\n  - Then call **Sync Content Workflow State** with action = `cancel`\n\n- When the user explicitly confirms they are happy with the content:\n  - Call **get_workflow_items_by_status** with status=\"IN_PROGRESS\"\n  - Extract the Supabase workflow record ID from the response\n  - Use ONLY this Supabase record ID when calling Sync Content Workflow State\n  - Then call **Sync Content Workflow State** with action = `complete`\n\nDo not assume state.  \nDo not mutate state without explicit user intent, except when automatically starting state for Notion-derived ideas.\n\n#### 5. Research Confirmation (Creation Only)\n\nBefore generating long-form or analytical content, explicitly ask:\n\n\"Would you like me to do deep research for this piece before writing?\"\n\n- If **yes**: Call **Get Topic Research Context**\n- If **no**: Proceed using only the content idea\n\nWhen research is performed:\n- Do NOT display or summarise it by default\n- Treat it as internal background context\n- Immediately proceed to writing\n\nOnly surface research if the user explicitly asks to see it.\n\n**Web Search (Optional Enhancement)**\n- If `web_search` tool is available: Use it to supplement context with current information\n- If `web_search` is not available: Proceed with content idea data and deep research tool\n- Never fail or stop workflow due to missing web_search\n\n#### 6. Writing Execution (Creation Only)\n\nYou may call **Write Platform Content** only after:\n- A content idea is finalised\n- Workflow state is IN_PROGRESS\n- Platform or format is clearly identified\n- Research preference is confirmed\n- Any requested research is gathered\n\nPass only:\n- Content idea\n- Platform\n- Research context (if any)\n- Optional modifiers explicitly provided by the user\n\n### Revision Workflow Rules\n\nIf the user provides existing content and requests changes:\n\n- Treat this as **revision mode**\n- Do NOT:\n  - Perform research\n  - Modify workflow state\n  - Retrieve new content ideas\n  - Call Write Platform Content\n\nInstead:\n- Call **Revise Platform Content**\n- Pass:\n  - Existing content\n  - Revision instructions\n  - Any optional constraints\n\nRevision is a lightweight, non-lifecycle operation.\n\n### Clarifying Questions (Strict & Sparse)\n\nAsk follow-up questions only when required to resolve:\n- Topic ambiguity\n- Directional intent\n- Conflicting semantic instructions\n- Platform selection (if not already specified)\n- User's desired angle or approach to the content\n\nYou must NOT ask questions about:\n- Target audience (defined in platform-specific writing prompts)\n- Tone or style preferences (defined in platform-specific writing prompts)\n- Content structure or format\n- Writing style, tone, or length defaults\n- Platform-specific presentation choices\n\nThese are defined by the platform content prompts.\n\nClarifying questions exist only to ground meaning, not configure output.\n\n### Output Rules\n\n- For creation: return only the output from **Write Platform Content**\n- For revision: return only the output from **Revise Platform Content**\n- Do not include explanations, reasoning, or commentary\n- Do not expose internal logic or tool usage\n\n### Design Principles\n\n- Notion ideas always trigger state management\n- State is keyed only by Notion ID or Notion URL\n- No unnecessary follow-up questions\n- Research is invisible by default\n- Revision never mutates lifecycle state\n- Supabase is source of truth for workflow state\n- Always show accurate status indicators when displaying ideas\n\n### Graceful Tool Degradation\n\n- If optional tools (web_search, advanced Notion MCP) are unavailable, proceed normally\n- Content idea data from Get_New_Ideas tools contains sufficient context\n- Deep research tool works on all platforms\n- Never block user workflow due to missing optional tools\n\n---\n\nYou are a coordinator and gatekeeper, not a writer or editor.",
          "returnIntermediateSteps": false,
          "enableStreaming": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -896,
        0
      ],
      "id": "0a472e09-cb9d-4945-bff1-1fa747a94300",
      "name": "Orchastrator v3 (Prompt Engineer)"
    },
    {
      "parameters": {
        "description": "=Retrieves available image prompt options from the Image Prompts database. Each prompt includes a title and aspect ratio to help users choose the right visual style for their content.\n\nCall this tool when:\n- User asks to see available image options\n- User says \"list images\" or \"show me image types\"\n- After content is approved and user is considering adding an image\n\nReturns: Array of image prompts with id, title, and aspect_ratio",
        "workflowId": {
          "__rl": true,
          "value": "KQsEGgxeeRjmXLxdI-rLL",
          "mode": "list",
          "cachedResultUrl": "/workflow/KQsEGgxeeRjmXLxdI-rLL",
          "cachedResultName": "âš™ï¸ Get Available Images"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -1072,
        464
      ],
      "id": "4f9fe853-4ca2-4e16-9d1a-c31d288e5310",
      "name": "get_available_image_prompts"
    },
    {
      "parameters": {
        "description": "=**Tool Description:**\nStores completed content in the Transformed Content database and links it back to the source content idea.\n\nCall this tool when:\n- User approves content and is ready to mark it complete\n- After image prompt selection (or when user skips image)\n- Before updating source content status\n\nThis tool creates a Notion page with the content stored as child blocks and establishes the relationship to the source content idea.\n\nReturns: transformed_content_id and transformed_content_url\n\n**Input:**\n{\n  \"source_content_idea_id\": \"2e6785c0-cfab-81a8-9737-c11c27a31835\",\n  \"platform\": \"Facebook\",\n  \"content_title\": \"Building Britain's Longest Road Tunnel\",\n  \"content_text\": \"Full content text here...\"\n}\n\n**Output:**\n{\n  \"transformed_content_id\": \"2e7785c0-cfab-8165-8e8d-fb68709c0924\",\n  \"transformed_content_url\": \"https://www.notion.so/Content-Facebook-...\"\n}",
        "workflowId": {
          "__rl": true,
          "value": "AARnLgnGGmHjfKWX",
          "mode": "list",
          "cachedResultUrl": "/workflow/AARnLgnGGmHjfKWX",
          "cachedResultName": "âš™ï¸ Store Transformed Content"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "source_content_idea_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('source_content_idea_id', `The Notion page ID of the original content idea that this content was created from. This establishes the relationship between the transformed content and its source. Extract this from the content idea object's 'id' field.`, 'string') }}",
            "platform": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('platform', `The social media platform or content destination this piece was written for (e.g., \"Facebook\", \"LinkedIn\", \"Twitter\", \"Instagram\"). This should match the platform specified during content creation.`, 'string') }}",
            "content_title": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('content_title', `The title of the content piece as approved by the user. This will be displayed as the page title in the Transformed Content database.`, 'string') }}",
            "content_text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('content_text', `The complete text content of the article or post. Include all body text, headlines, hashtags, and any visual ideas mentioned at the end. This will be automatically split into child blocks in Notion.`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "source_content_idea_id",
              "displayName": "source_content_idea_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "platform",
              "displayName": "platform",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "content_title",
              "displayName": "content_title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "content_text",
              "displayName": "content_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -864,
        464
      ],
      "id": "72c88c6e-0344-4048-8a41-32622794c081",
      "name": "store_transformed_content"
    },
    {
      "parameters": {
        "description": "=Updates the status of the original content idea page to \"Content Generated\" after content has been successfully stored.\n\nCall this tool:\n- After store_transformed_content succeeds\n- Before marking workflow as complete in Supabase\n\nReturns: Success confirmation and updated page ID",
        "workflowId": {
          "__rl": true,
          "value": "8MwcYy5ubfhzZj5G",
          "mode": "list",
          "cachedResultUrl": "/workflow/8MwcYy5ubfhzZj5G",
          "cachedResultName": "âš™ï¸ Update Source Content Status"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "notion_page_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('notion_page_id', `The Notion page ID of the original content idea whose status needs to be updated to \"Content Generated\". This should be the same ID used as source_content_idea_id in the store_transformed_content tool.`, 'string') }}"
          },
          "matchingColumns": [
            "notion_page_id"
          ],
          "schema": [
            {
              "id": "notion_page_id",
              "displayName": "notion_page_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -656,
        464
      ],
      "id": "c60cffd6-2169-4865-8298-bd4fd0263ebe",
      "name": "update_source_content_status"
    },
    {
      "parameters": {
        "description": "=**Tool Description:**\n\nStores deep research context in the Research database and links it to the source content idea. This preserves research for future reuse when the same content idea is repurposed for different platforms.\n\nCall this tool when:\n- Research has been gathered via get_topic_research_context\n- Before writing content (so research is available for future use)\n- User explicitly requests research to be saved\n\nThis tool creates a Notion page in the Research database with the research stored as child blocks and establishes the relationship to the source content idea via the Article Research relation field.\n\nReturns: research_page_id and research_page_url\n\n**Input:**\n{\n  \"source_content_idea_id\": \"2e6785c0-cfab-81a8-9737-c11c27a31835\",\n  \"research_text\": \"Full research context here...\",\n  \"research_title\": \"TotalEnergies and Biofuels - Research\"  # optional\n}\n\n**Output:**\n{\n  \"research_page_id\": \"2e7785c0-cfab-8192-bde9-e89ab67b775c\",\n  \"research_page_url\": \"https://www.notion.so/TotalEnergies-and-Biofuels-Research-...\"\n}",
        "workflowId": {
          "__rl": true,
          "value": "D8R3opMPXlbcpknE",
          "mode": "list",
          "cachedResultUrl": "/workflow/D8R3opMPXlbcpknE",
          "cachedResultName": "âš™ï¸ Store Research"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "source_content_idea_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('source_content_idea_id', `The Notion page ID of the content idea this research belongs to. This creates the relation in the Article Research field of the source content idea page.`, 'string') }}",
            "research_text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('research_text', `The complete research context gathered from get_topic_research_context or other research sources. Include all factual background, sources, URLs, and contextual information. This will be automatically split into child blocks in Notion.`, 'string') }}",
            "research_title": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('research_title', `Optional title for the research page. If not provided, will auto-generate as \"[Content Idea Title] - Research\". This appears in the Research database.`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "source_content_idea_id",
              "displayName": "source_content_idea_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "research_text",
              "displayName": "research_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "research_title",
              "displayName": "research_title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -432,
        464
      ],
      "id": "19676033-530b-4787-8fca-a1f66a8c9b89",
      "name": "store_research_context"
    }
  ],
  "pinData": null,
  "repo_name": "syntech-backup-railway",
  "repo_owner": "Granite-Marketing",
  "repo_path": "https://github.com/Granite-Marketing/syntech-n8n-backup/",
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "shared": [
    {
      "updatedAt": "2026-01-28T08:12:44.249Z",
      "createdAt": "2026-01-28T08:12:44.249Z",
      "role": "workflow:owner",
      "workflowId": "4k9HGu87hRmGn5vm",
      "projectId": "U9sMeJya1DaokkjK"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2026-01-28T08:18:52.857Z",
  "versionId": "d2a664fe-088a-423f-b5d4-3c49c9170444"
}